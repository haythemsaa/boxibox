import{C as W,q as b,E as B,_ as N,c as n,o as i,a as e,n as d,u as I,x as w,i as v,d as l,t as g,F as T,j as R,g as A,e as C,w as V,h as H,l as L,W as q,H as O,X as Q,Y as z,r as $,K as j}from"./app-DscnimDf.js";const _=b(!1);function U(){W(()=>{const c=localStorage.getItem("darkMode");c!==null?_.value=c==="true":_.value=window.matchMedia("(prefers-color-scheme: dark)").matches,a()}),B(_,()=>{a(),localStorage.setItem("darkMode",_.value.toString())});function a(){_.value?(document.documentElement.setAttribute("data-bs-theme","dark"),document.body.classList.add("dark-mode")):(document.documentElement.setAttribute("data-bs-theme","light"),document.body.classList.remove("dark-mode"))}function s(){_.value=!_.value}return{isDarkMode:_,toggleDarkMode:s}}const X={name:"DarkModeToggle",setup(){const{isDarkMode:a,toggleDarkMode:s}=U();return{isDarkMode:a,toggleDarkMode:s}}},P={class:"dark-mode-toggle"},K=["title"];function Y(a,s,c,t,p,m){return i(),n("div",P,[e("button",{onClick:s[0]||(s[0]=(...o)=>t.toggleDarkMode&&t.toggleDarkMode(...o)),class:d(["btn btn-sm",t.isDarkMode?"btn-outline-light":"btn-outline-dark"]),title:t.isDarkMode?"Mode clair":"Mode sombre"},[e("i",{class:d(["fas",t.isDarkMode?"fa-sun":"fa-moon"])},null,2)],10,K)])}const G=N(X,[["render",Y],["__scopeId","data-v-6c975f77"]]),J={props:{initialNotifications:{type:Array,default:()=>[]}},setup(a){const s=b(a.initialNotifications||[]),c=I(()=>s.value.filter(u=>!u.lu).length),t=I(()=>c.value>0),p=u=>({facture:"fa-file-invoice text-primary",paiement:"fa-credit-card text-success",relance:"fa-exclamation-circle text-warning",contrat:"fa-file-contract text-info",document:"fa-file-alt text-secondary",systeme:"fa-cog text-dark",message:"fa-envelope text-primary"})[u]||"fa-bell text-secondary",m=u=>{const k=new Date(u),y=new Date-k,M=Math.floor(y/6e4),D=Math.floor(y/36e5),S=Math.floor(y/864e5);return M<1?"À l'instant":M<60?`Il y a ${M} min`:D<24?`Il y a ${D}h`:S<7?`Il y a ${S}j`:k.toLocaleDateString("fr-FR")},o=()=>{},h=u=>{u.lu||w.post(route("client.notifications.mark-read",u.id),{},{preserveScroll:!0,onSuccess:()=>{u.lu=!0}}),u.lien&&(window.location.href=u.lien)};return W(()=>{setInterval(()=>{w.reload({only:["notifications"],preserveScroll:!0})},3e4)}),{notifications:s,unreadCount:c,hasUnread:t,getNotificationIcon:p,formatRelativeTime:m,markAsViewed:o,handleNotificationClick:h}}},Z={class:"notification-bell"},ee={class:"dropdown"},se={key:0,class:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"},te={class:"dropdown-menu dropdown-menu-end notification-dropdown shadow","aria-labelledby":"notificationDropdown"},ae={class:"dropdown-header d-flex justify-content-between align-items-center"},oe={class:"badge bg-primary"},ne={class:"notification-list",style:{"max-height":"400px","overflow-y":"auto"}},ie=["onClick"],le={class:"d-flex"},re={class:"notification-icon me-3"},de={class:"flex-grow-1"},ce={class:"notification-title"},ue={class:"notification-message"},fe={class:"notification-time"},me={key:0,class:"unread-indicator"},ve={key:1},ge={key:0},pe={key:1},he=["href"];function be(a,s,c,t,p,m){return i(),n("div",Z,[e("div",ee,[e("button",{class:"btn btn-link position-relative p-2",type:"button",id:"notificationDropdown","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:s[0]||(s[0]=(...o)=>t.markAsViewed&&t.markAsViewed(...o))},[e("i",{class:d(["fas fa-bell",t.hasUnread?"text-warning":"text-white"]),style:{"font-size":"1.3rem"}},null,2),t.unreadCount>0?(i(),n("span",se,[l(g(t.unreadCount>99?"99+":t.unreadCount)+" ",1),s[1]||(s[1]=e("span",{class:"visually-hidden"},"notifications non lues",-1))])):v("",!0)]),e("ul",te,[e("li",ae,[s[2]||(s[2]=e("span",null,[e("i",{class:"fas fa-bell me-2"}),l(" Notifications ")],-1)),e("span",oe,g(t.unreadCount),1)]),s[7]||(s[7]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("div",ne,[t.notifications&&t.notifications.length>0?(i(!0),n(T,{key:0},R(t.notifications.slice(0,10),o=>(i(),n("li",{key:o.id},[e("a",{class:d(["dropdown-item notification-item",{unread:!o.lu}]),href:"#",onClick:A(h=>t.handleNotificationClick(o),["prevent"])},[e("div",le,[e("div",re,[e("i",{class:d(["fas",t.getNotificationIcon(o.type)])},null,2)]),e("div",de,[e("div",ce,g(o.titre),1),e("div",ue,g(o.message),1),e("div",fe,[s[3]||(s[3]=e("i",{class:"far fa-clock me-1"},null,-1)),l(" "+g(t.formatRelativeTime(o.created_at)),1)])]),o.lu?v("",!0):(i(),n("div",me))])],10,ie)]))),128)):(i(),n("li",ve,[...s[4]||(s[4]=[e("div",{class:"dropdown-item text-center text-muted py-4"},[e("i",{class:"fas fa-inbox fa-2x mb-2"}),e("p",{class:"mb-0"},"Aucune notification")],-1)])]))]),t.notifications&&t.notifications.length>0?(i(),n("li",ge,[...s[5]||(s[5]=[e("hr",{class:"dropdown-divider"},null,-1)])])):v("",!0),t.notifications&&t.notifications.length>0?(i(),n("li",pe,[e("a",{class:"dropdown-item text-center text-primary fw-bold",href:a.route("client.notifications")},[...s[6]||(s[6]=[l(" Voir toutes les notifications ",-1),e("i",{class:"fas fa-arrow-right ms-2"},null,-1)])],8,he)])):v("",!0)])])])}const ke=N(J,[["render",be],["__scopeId","data-v-c449e378"]]),ye={props:{initialMessages:{type:Array,default:()=>[]}},setup(a){const s=b(!1),c=b(a.initialMessages||[]),t=b(""),p=b(!1),m=b(!1),o=b(null),h=b(!0),u=["Mes codes d'accès","État de ma facture","Modifier mon contrat","Contacter un conseiller"],k=I(()=>c.value.filter(r=>!r.from_client&&!r.lu).length),x=()=>{s.value=!s.value,s.value&&(y(),F())},y=async()=>{p.value=!0;try{w.reload({only:["messages"],preserveScroll:!0,onSuccess:r=>{r.props.messages&&(c.value=r.props.messages),E()},onFinish:()=>{p.value=!1}})}catch(r){console.error("Erreur lors du chargement des messages:",r),p.value=!1}},M=async()=>{if(!t.value.trim()||m.value)return;m.value=!0;const r=t.value.trim();t.value="";try{w.post(route("client.chat.send"),{message:r},{preserveScroll:!0,onSuccess:f=>{f.props.messages&&(c.value=f.props.messages),E()},onFinish:()=>{m.value=!1}})}catch(f){console.error("Erreur lors de l'envoi du message:",f),m.value=!1,t.value=r}},D=r=>{t.value=r,M(),h.value=!1},S=r=>{const f=new Date(r);return Math.floor((new Date-f)/36e5)<24?f.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):f.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})+" "+f.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})},E=()=>{O(()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)})},F=()=>{k.value>0&&w.post(route("client.chat.mark-all-read"),{},{preserveScroll:!0,onSuccess:r=>{c.value.forEach(f=>{f.from_client||(f.lu=!0)})}})};return B(s,r=>{if(r){const f=setInterval(()=>{s.value?y():clearInterval(f)},5e3)}}),W(()=>{setInterval(()=>{s.value||w.reload({only:["messages"],preserveScroll:!0,onSuccess:r=>{r.props.messages&&(c.value=r.props.messages)}})},15e3)}),{isOpen:s,messages:c,newMessage:t,loading:p,sending:m,messagesContainer:o,showQuickReplies:h,quickReplies:u,unreadMessagesCount:k,toggleChat:x,sendMessage:M,sendQuickReply:D,formatTime:S}}},_e={class:"chat-widget"},we={key:0,class:"unread-badge"},Me={key:0,class:"chat-window shadow-lg"},Ce={class:"chat-header"},$e={class:"chat-messages",ref:"messagesContainer"},xe={key:0,class:"text-center py-4"},De={key:0,class:"empty-chat"},Se={class:"message-bubble"},Te={class:"message-text"},Ne={class:"message-time"},Ie={key:0,class:"fas fa-check-double ms-1 text-primary"},Re={key:1,class:"fas fa-check ms-1"},We={key:0,class:"quick-replies"},Ae=["onClick"],Ee={class:"chat-input"},Be=["disabled"],Fe=["disabled"];function Ve(a,s,c,t,p,m){return i(),n("div",_e,[t.isOpen?v("",!0):(i(),n("button",{key:0,onClick:s[0]||(s[0]=(...o)=>t.toggleChat&&t.toggleChat(...o)),class:d(["chat-toggle-btn",{"has-unread":t.unreadMessagesCount>0}])},[s[4]||(s[4]=e("i",{class:"fas fa-comments"},null,-1)),t.unreadMessagesCount>0?(i(),n("span",we,g(t.unreadMessagesCount),1)):v("",!0)],2)),C(q,{name:"chat-slide"},{default:V(()=>[t.isOpen?(i(),n("div",Me,[e("div",Ce,[s[5]||(s[5]=e("div",{class:"d-flex align-items-center"},[e("div",{class:"chat-avatar me-3"},[e("i",{class:"fas fa-headset"})]),e("div",null,[e("h6",{class:"mb-0"},"Support Boxibox"),e("small",{class:"text-white-50"},[e("span",{class:"status-indicator"}),l(" En ligne ")])])],-1)),e("button",{onClick:s[1]||(s[1]=(...o)=>t.toggleChat&&t.toggleChat(...o)),class:"btn-close btn-close-white"})]),e("div",$e,[t.loading?(i(),n("div",xe,[...s[6]||(s[6]=[e("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Chargement...")],-1)])])):(i(),n(T,{key:1},[t.messages.length===0?(i(),n("div",De,[...s[7]||(s[7]=[e("i",{class:"fas fa-comments fa-3x text-muted mb-3"},null,-1),e("p",{class:"text-muted"},"Commencez une conversation avec notre support",-1)])])):v("",!0),(i(!0),n(T,null,R(t.messages,o=>(i(),n("div",{key:o.id,class:d(["message",{"message-sent":o.from_client,"message-received":!o.from_client}])},[e("div",Se,[e("div",Te,g(o.message),1),e("div",Ne,[l(g(t.formatTime(o.created_at))+" ",1),o.from_client&&o.lu?(i(),n("i",Ie)):o.from_client?(i(),n("i",Re)):v("",!0)])])],2))),128))],64))],512),t.showQuickReplies&&t.messages.length===0?(i(),n("div",We,[s[8]||(s[8]=e("small",{class:"text-muted d-block mb-2"},"Questions fréquentes :",-1)),(i(!0),n(T,null,R(t.quickReplies,(o,h)=>(i(),n("button",{key:h,onClick:u=>t.sendQuickReply(o),class:"btn btn-sm btn-outline-primary me-2 mb-2"},g(o),9,Ae))),128))])):v("",!0),e("div",Ee,[e("form",{onSubmit:s[3]||(s[3]=A((...o)=>t.sendMessage&&t.sendMessage(...o),["prevent"])),class:"d-flex"},[H(e("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>t.newMessage=o),type:"text",class:"form-control",placeholder:"Écrivez votre message...",disabled:t.sending},null,8,Be),[[L,t.newMessage]]),e("button",{type:"submit",class:"btn btn-primary ms-2",disabled:!t.newMessage.trim()||t.sending},[e("i",{class:d(["fas",t.sending?"fa-spinner fa-spin":"fa-paper-plane"])},null,2)],8,Fe)],32)])])):v("",!0)]),_:1})])}const He=N(ye,[["render",Ve],["__scopeId","data-v-c3c368c1"]]),Le={components:{Head:z,Toast:Q,DarkModeToggle:G,NotificationBell:ke,ChatWidget:He},props:{title:{type:String,default:"Espace Client"}},methods:{logout(){w.post(route("logout"))}}},qe={class:"navbar navbar-expand-lg navbar-dark bg-primary sticky-top"},Oe={class:"container-fluid"},Qe=["href"],ze={class:"collapse navbar-collapse",id:"navbarNav"},je={class:"navbar-nav ms-auto align-items-center"},Ue={class:"nav-item me-2"},Xe={class:"nav-item me-2"},Pe={class:"nav-item dropdown"},Ke={class:"nav-link dropdown-toggle text-white",href:"#",role:"button","data-bs-toggle":"dropdown"},Ye={class:"dropdown-menu dropdown-menu-end"},Ge=["href"],Je={class:"container-fluid"},Ze={class:"row"},es={class:"col-md-2 p-0 sidebar"},ss={class:"nav flex-column py-3"},ts=["href"],as=["href"],os=["href"],ns=["href"],is=["href"],ls=["href"],rs=["href"],ds=["href"],cs=["href"],us=["href"],fs={class:"col-md-10"},ms={class:"main-content"},vs={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},gs={key:1,class:"alert alert-danger alert-dismissible fade show",role:"alert"};function ps(a,s,c,t,p,m){const o=$("Head"),h=$("DarkModeToggle"),u=$("NotificationBell"),k=$("Toast"),x=$("ChatWidget");return i(),n("div",null,[C(o,{title:c.title},null,8,["title"]),e("nav",qe,[e("div",Oe,[e("a",{href:a.route("client.dashboard"),class:"navbar-brand"},[...s[1]||(s[1]=[e("i",{class:"fas fa-box-open me-2"},null,-1),l("BOXIBOX ",-1)])],8,Qe),s[6]||(s[6]=e("span",{class:"navbar-text text-white me-3"}," Espace Client ",-1)),s[7]||(s[7]=e("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[e("span",{class:"navbar-toggler-icon"})],-1)),e("div",ze,[e("ul",je,[e("li",Ue,[C(h)]),e("li",Xe,[C(u,{initialNotifications:a.$page.props.notifications||[]},null,8,["initialNotifications"])]),e("li",Pe,[e("a",Ke,[s[2]||(s[2]=e("i",{class:"fas fa-user-circle me-1"},null,-1)),l(" "+g(a.$page.props.auth?.user?.name||"Client"),1)]),e("ul",Ye,[e("li",null,[e("a",{href:a.route("client.profil"),class:"dropdown-item"},[...s[3]||(s[3]=[e("i",{class:"fas fa-user me-2"},null,-1),l("Mon profil ",-1)])],8,Ge)]),s[5]||(s[5]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[e("form",{onSubmit:s[0]||(s[0]=A((...y)=>m.logout&&m.logout(...y),["prevent"]))},[...s[4]||(s[4]=[e("button",{type:"submit",class:"dropdown-item"},[e("i",{class:"fas fa-sign-out-alt me-2"}),l("Déconnexion ")],-1)])],32)])])])])])])]),e("div",Je,[e("div",Ze,[e("div",es,[e("nav",ss,[e("a",{href:a.route("client.dashboard"),class:d(["nav-link",{active:a.$page.url==="/client/dashboard"}])},[...s[8]||(s[8]=[e("i",{class:"fas fa-home"},null,-1),l("Tableau de bord ",-1)])],10,ts),s[18]||(s[18]=e("div",{class:"nav-section-title"},"Mes Services",-1)),e("a",{href:a.route("client.contrats"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/contrats")}])},[...s[9]||(s[9]=[e("i",{class:"fas fa-file-contract"},null,-1),l("Mes contrats ",-1)])],10,as),e("a",{href:a.route("client.boxplan"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/box-plan")}])},[...s[10]||(s[10]=[e("i",{class:"fas fa-map"},null,-1),l("Plan des boxes ",-1)])],10,os),s[19]||(s[19]=e("div",{class:"nav-section-title"},"Finances",-1)),e("a",{href:a.route("client.factures"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/factures")}])},[...s[11]||(s[11]=[e("i",{class:"fas fa-file-invoice-dollar"},null,-1),l("Mes factures ",-1)])],10,ns),e("a",{href:a.route("client.reglements"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/reglements")}])},[...s[12]||(s[12]=[e("i",{class:"fas fa-money-bill-wave"},null,-1),l("Mes règlements ",-1)])],10,is),e("a",{href:a.route("client.relances"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/relances")}])},[...s[13]||(s[13]=[e("i",{class:"fas fa-bell"},null,-1),l("Mes relances ",-1)])],10,ls),e("a",{href:a.route("client.sepa"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/sepa")}])},[...s[14]||(s[14]=[e("i",{class:"fas fa-university"},null,-1),l("Mandats SEPA ",-1)])],10,rs),s[20]||(s[20]=e("div",{class:"nav-section-title"},"Documents",-1)),e("a",{href:a.route("client.documents"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/documents")}])},[...s[15]||(s[15]=[e("i",{class:"fas fa-folder-open"},null,-1),l("Mes fichiers ",-1)])],10,ds),e("a",{href:a.route("client.suivi"),class:d(["nav-link",{active:a.$page.url.startsWith("/client/suivi")}])},[...s[16]||(s[16]=[e("i",{class:"fas fa-history"},null,-1),l("Suivi d'activité ",-1)])],10,cs),s[21]||(s[21]=e("div",{class:"nav-section-title"},"Compte",-1)),e("a",{href:a.route("client.profil"),class:d(["nav-link",{active:a.$page.url==="/client/profil"}])},[...s[17]||(s[17]=[e("i",{class:"fas fa-user"},null,-1),l("Mon profil ",-1)])],10,us)])]),e("div",fs,[e("div",ms,[a.$page.props.flash?.success?(i(),n("div",vs,[s[22]||(s[22]=e("i",{class:"fas fa-check-circle me-2"},null,-1)),l(g(a.$page.props.flash.success)+" ",1),s[23]||(s[23]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert"},null,-1))])):v("",!0),a.$page.props.flash?.error?(i(),n("div",gs,[s[24]||(s[24]=e("i",{class:"fas fa-exclamation-circle me-2"},null,-1)),l(g(a.$page.props.flash.error)+" ",1),s[25]||(s[25]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert"},null,-1))])):v("",!0),j(a.$slots,"default",{},void 0)])])])]),C(k),C(x,{initialMessages:a.$page.props.chatMessages||[]},null,8,["initialMessages"])])}const ys=N(Le,[["render",ps],["__scopeId","data-v-70547b7c"]]);export{ys as C};
