import{q as M,u as b,E as B,c,a as e,i as w,h as q,l as I,K as T,F as A,j as F,n as _,d as $,t as d,g as P,o as u,e as L,w as x,x as K}from"./app-D3-luHWI.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const U={class:"datatable-wrapper"},O={class:"row mb-3"},Q={class:"col-md-6"},G={class:"input-group"},H=["placeholder"],J={class:"col-md-6 text-end"},W={class:"table-responsive"},X={class:"table table-hover table-striped"},Y=["onClick"],Z={key:1,class:"fas fa-sort ms-1 text-muted"},ee={key:0},te={key:0},se={key:0},ae=["colspan"],le={key:0,class:"row align-items-center mt-3"},ne={class:"col-md-6"},re={class:"text-muted"},oe={class:"col-md-6"},ie={class:"pagination justify-content-end mb-0"},ce=["onClick"],ue={__name:"DataTable",props:{columns:{type:Array,required:!0},data:{type:Array,required:!0},itemKey:{type:String,default:"id"},perPage:{type:Number,default:10},searchable:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Rechercher..."},emptyMessage:{type:String,default:"Aucune donnée disponible"},hasActions:{type:Boolean,default:!1}},emits:["search","sort"],setup(f,{emit:C}){const v=f,D=C,k=M(""),g=M(""),m=M("asc"),o=M(1),y=b(()=>{if(!k.value)return v.data;const r=k.value.toLowerCase();return v.data.filter(a=>v.columns.some(t=>{const i=n(a,t.key);return String(i).toLowerCase().includes(r)}))}),S=b(()=>g.value?[...y.value].sort((r,a)=>{const t=n(r,g.value),i=n(a,g.value);let p=0;return t>i&&(p=1),t<i&&(p=-1),m.value==="asc"?p:-p}):y.value),h=b(()=>Math.ceil(y.value.length/v.perPage)),V=b(()=>{const r=(o.value-1)*v.perPage,a=r+v.perPage;return S.value.slice(r,a)}),N=b(()=>(o.value-1)*v.perPage+1),l=b(()=>Math.min(o.value*v.perPage,y.value.length)),s=b(()=>{const r=[];let t=Math.max(1,o.value-Math.floor(2.5)),i=Math.min(h.value,t+5-1);i-t<4&&(t=Math.max(1,i-5+1));for(let p=t;p<=i;p++)r.push(p);return r}),n=(r,a)=>a.split(".").reduce((t,i)=>t&&t[i],r),j=(r,a)=>{const t=n(r,a.key);return a.formatter&&typeof a.formatter=="function"?a.formatter(t,r):t},E=r=>{g.value===r?m.value=m.value==="asc"?"desc":"asc":(g.value=r,m.value="asc"),D("sort",{key:g.value,order:m.value})},R=()=>{o.value=1,D("search",k.value)};return B(()=>v.data,()=>{o.value=1}),(r,a)=>(u(),c("div",U,[e("div",O,[e("div",Q,[e("div",G,[a[5]||(a[5]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-search"})],-1)),q(e("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=t=>k.value=t),placeholder:f.searchPlaceholder,onInput:R},null,40,H),[[I,k.value]])])]),e("div",J,[T(r.$slots,"actions",{},void 0)])]),e("div",W,[e("table",X,[e("thead",null,[e("tr",null,[(u(!0),c(A,null,F(f.columns,t=>(u(),c("th",{key:t.key,onClick:i=>t.sortable!==!1&&E(t.key),class:_({sortable:t.sortable!==!1})},[$(d(t.label)+" ",1),t.sortable!==!1&&g.value===t.key?(u(),c("i",{key:0,class:_(["fas ms-1",m.value==="asc"?"fa-sort-up":"fa-sort-down"])},null,2)):t.sortable!==!1?(u(),c("i",Z)):w("",!0)],10,Y))),128)),f.hasActions?(u(),c("th",ee,"Actions")):w("",!0)])]),e("tbody",null,[(u(!0),c(A,null,F(V.value,t=>(u(),c("tr",{key:t[f.itemKey]},[(u(!0),c(A,null,F(f.columns,i=>(u(),c("td",{key:i.key},[T(r.$slots,`cell-${i.key}`,{item:t,value:n(t,i.key)},()=>[$(d(j(t,i)),1)])]))),128)),f.hasActions?(u(),c("td",te,[T(r.$slots,"actions",{item:t},void 0)])):w("",!0)]))),128)),V.value.length===0?(u(),c("tr",se,[e("td",{colspan:f.columns.length+(f.hasActions?1:0),class:"text-center text-muted"},d(f.emptyMessage),9,ae)])):w("",!0)])])]),y.value.length>f.perPage?(u(),c("div",le,[e("div",ne,[e("div",re," Affichage de "+d(N.value)+" à "+d(l.value)+" sur "+d(y.value.length)+" résultats ",1)]),e("div",oe,[e("nav",null,[e("ul",ie,[e("li",{class:_(["page-item",{disabled:o.value===1}])},[e("a",{class:"page-link",href:"#",onClick:a[1]||(a[1]=P(t=>o.value=1,["prevent"]))},[...a[6]||(a[6]=[e("i",{class:"fas fa-angle-double-left"},null,-1)])])],2),e("li",{class:_(["page-item",{disabled:o.value===1}])},[e("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=P(t=>o.value--,["prevent"]))},[...a[7]||(a[7]=[e("i",{class:"fas fa-angle-left"},null,-1)])])],2),(u(!0),c(A,null,F(s.value,t=>(u(),c("li",{key:t,class:_(["page-item",{active:o.value===t}])},[e("a",{class:"page-link",href:"#",onClick:P(i=>o.value=t,["prevent"])},d(t),9,ce)],2))),128)),e("li",{class:_(["page-item",{disabled:o.value===h.value}])},[e("a",{class:"page-link",href:"#",onClick:a[3]||(a[3]=P(t=>o.value++,["prevent"]))},[...a[8]||(a[8]=[e("i",{class:"fas fa-angle-right"},null,-1)])])],2),e("li",{class:_(["page-item",{disabled:o.value===h.value}])},[e("a",{class:"page-link",href:"#",onClick:a[4]||(a[4]=P(t=>o.value=h.value,["prevent"]))},[...a[9]||(a[9]=[e("i",{class:"fas fa-angle-double-right"},null,-1)])])],2)])])])])):w("",!0)]))}},de=z(ue,[["__scopeId","data-v-1ce3205d"]]),fe={class:"container-fluid"},ve={class:"row mb-4"},me={class:"col-md-3"},be={class:"card bg-light"},ge={class:"card-body"},ye={class:"d-flex justify-content-between align-items-center"},he={class:"mb-0"},pe={class:"col-md-3"},_e={class:"card bg-light"},ke={class:"card-body"},xe={class:"d-flex justify-content-between align-items-center"},$e={class:"mb-0 text-success"},we={class:"col-md-3"},Ce={class:"card bg-light"},Pe={class:"card-body"},De={class:"d-flex justify-content-between align-items-center"},Ve={class:"mb-0 text-danger"},Me={class:"col-md-3"},Ae={class:"card bg-light"},Fe={class:"card-body"},Se={class:"d-flex justify-content-between align-items-center"},Ne={class:"mb-0 text-warning"},Te={class:"card shadow"},je={class:"card-body"},Ee={class:"badge bg-primary"},Re={class:"btn-group btn-group-sm"},Be=["href"],qe=["href"],Ie=["onClick"],Ue={__name:"Factures",props:{factures:{type:Array,required:!0}},setup(f){const C=f,v=[{key:"numero_facture",label:"N° Facture",sortable:!0},{key:"date_emission",label:"Date Émission",sortable:!0},{key:"date_echeance",label:"Date Échéance",sortable:!0},{key:"montant_ttc",label:"Montant TTC",sortable:!0},{key:"montant_regle",label:"Montant Réglé",sortable:!0},{key:"statut",label:"Statut",sortable:!0}],D=b(()=>C.factures.filter(l=>l.statut==="payee").length),k=b(()=>C.factures.filter(l=>l.statut==="en_retard").length),g=b(()=>C.factures.filter(l=>l.statut!=="payee").reduce((l,s)=>l+parseFloat(s.montant_ttc-s.montant_regle),0)),m=l=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(l||0),o=l=>l?new Date(l).toLocaleDateString("fr-FR"):"-",y=l=>({brouillon:"bg-secondary",envoyee:"bg-info",payee:"bg-success",en_retard:"bg-danger",annulee:"bg-dark"})[l]||"bg-secondary",S=l=>({brouillon:"Brouillon",envoyee:"Envoyée",payee:"Payée",en_retard:"En retard",annulee:"Annulée"})[l]||l,h=(l,s={})=>window.route(l,s),V=()=>{K.reload({only:["factures"]})},N=l=>{confirm(`Voulez-vous payer la facture ${l.numero_facture} ?`)&&(window.location.href=h("client.factures.payer",l.id))};return(l,s)=>(u(),c("div",fe,[e("div",{class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},[s[1]||(s[1]=e("h1",{class:"h2"},[e("i",{class:"fas fa-file-invoice me-2"}),$(" Mes Factures ")],-1)),e("div",{class:"btn-toolbar mb-2 mb-md-0"},[e("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:V},[...s[0]||(s[0]=[e("i",{class:"fas fa-sync-alt me-1"},null,-1),$(" Actualiser ",-1)])])])]),e("div",ve,[e("div",me,[e("div",be,[e("div",ge,[e("div",ye,[e("div",null,[s[2]||(s[2]=e("h6",{class:"text-muted mb-1"},"Total Factures",-1)),e("h3",he,d(f.factures.length),1)]),s[3]||(s[3]=e("i",{class:"fas fa-file-invoice fa-2x text-primary"},null,-1))])])])]),e("div",pe,[e("div",_e,[e("div",ke,[e("div",xe,[e("div",null,[s[4]||(s[4]=e("h6",{class:"text-muted mb-1"},"Payées",-1)),e("h3",$e,d(D.value),1)]),s[5]||(s[5]=e("i",{class:"fas fa-check-circle fa-2x text-success"},null,-1))])])])]),e("div",we,[e("div",Ce,[e("div",Pe,[e("div",De,[e("div",null,[s[6]||(s[6]=e("h6",{class:"text-muted mb-1"},"En retard",-1)),e("h3",Ve,d(k.value),1)]),s[7]||(s[7]=e("i",{class:"fas fa-exclamation-triangle fa-2x text-danger"},null,-1))])])])]),e("div",Me,[e("div",Ae,[e("div",Fe,[e("div",Se,[e("div",null,[s[8]||(s[8]=e("h6",{class:"text-muted mb-1"},"Montant Dû",-1)),e("h3",Ne,d(m(g.value)),1)]),s[9]||(s[9]=e("i",{class:"fas fa-euro-sign fa-2x text-warning"},null,-1))])])])])]),e("div",Te,[e("div",je,[L(de,{columns:v,data:f.factures,"per-page":10,"search-placeholder":"Rechercher par numéro, montant...","has-actions":!0},{"cell-numero_facture":x(({value:n})=>[e("span",Ee,d(n),1)]),"cell-date_emission":x(({value:n})=>[$(d(o(n)),1)]),"cell-date_echeance":x(({value:n})=>[$(d(o(n)),1)]),"cell-montant_ttc":x(({value:n})=>[e("strong",null,d(m(n)),1)]),"cell-montant_regle":x(({value:n})=>[$(d(m(n)),1)]),"cell-statut":x(({value:n})=>[e("span",{class:_(["badge",y(n)])},d(S(n)),3)]),actions:x(({item:n})=>[e("div",Re,[e("a",{href:h("client.factures.show",n.id),class:"btn btn-outline-primary",title:"Voir"},[...s[10]||(s[10]=[e("i",{class:"fas fa-eye"},null,-1)])],8,Be),e("a",{href:h("client.factures.pdf",n.id),class:"btn btn-outline-secondary",title:"Télécharger PDF"},[...s[11]||(s[11]=[e("i",{class:"fas fa-download"},null,-1)])],8,qe),n.statut!=="payee"?(u(),c("button",{key:0,onClick:j=>N(n),class:"btn btn-outline-success",title:"Payer"},[...s[12]||(s[12]=[e("i",{class:"fas fa-credit-card"},null,-1)])],8,Ie)):w("",!0)])]),_:1},8,["data"])])])]))}};export{Ue as default};
