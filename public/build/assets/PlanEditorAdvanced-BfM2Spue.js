import{c as a,o as d,a as e,d as m,i as x,h as c,N as y,l as p,F as f,j as g,n as w,p as S,t as h,r as T,v as _,e as z,m as v,g as k,b as M,x as I}from"./app-BhQbKMjd.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const U={data(){return{currentTool:"select",boxWidth:100,boxHeight:80,roomName:"",roomColor:"#e3f2fd",wallThickness:4,wallColor:"#333333",textContent:"",textSize:14,textColor:"#000000",arrowThickness:2,arrowColor:"#dc3545",layers:[{id:1,name:"Fond de plan",visible:!0,locked:!0},{id:2,name:"Zones/Salles",visible:!0,locked:!1},{id:3,name:"Boxes",visible:!0,locked:!1},{id:4,name:"Annotations",visible:!0,locked:!1}],activeLayer:3,nextLayerId:5}},watch:{currentTool(l){this.$emit("tool-changed",{tool:l,options:this.getToolOptions()})}},methods:{getToolOptions(){switch(this.currentTool){case"box":return{width:this.boxWidth,height:this.boxHeight};case"room":return{name:this.roomName,color:this.roomColor};case"wall":return{thickness:this.wallThickness,color:this.wallColor};case"text":return{content:this.textContent,size:this.textSize,color:this.textColor};case"arrow":return{thickness:this.arrowThickness,color:this.arrowColor};default:return{}}},setActiveLayer(l){this.activeLayer=l,this.$emit("layer-changed",l)},addLayer(){const l={id:this.nextLayerId++,name:`Calque ${this.layers.length+1}`,visible:!0,locked:!1};this.layers.push(l),this.activeLayer=l.id}}},Y={class:"drawing-tools"},X={class:"card"},V={class:"card-body p-2"},D={class:"btn-group-vertical w-100 mb-3",role:"group"},O={key:0,class:"tool-options"},L={class:"mb-2"},E={class:"mb-2"},R={key:1,class:"tool-options"},H={class:"mb-2"},N={class:"mb-2"},W={key:2,class:"tool-options"},P={class:"mb-2"},A={class:"mb-2"},G={key:3,class:"tool-options"},Z={class:"mb-2"},j={class:"mb-2"},F={class:"mb-2"},q={key:4,class:"tool-options"},K={class:"mb-2"},J={class:"mb-2"},Q={class:"card mt-3"},$={class:"card-body p-2"},tt={class:"list-group list-group-flush"},et={class:"form-check"},st=["onUpdate:modelValue","id"],lt=["for"],ot=["onClick"];function nt(l,t,r,u,o,n){return d(),a("div",Y,[e("div",X,[t[44]||(t[44]=e("div",{class:"card-header bg-dark text-white py-2"},[e("h6",{class:"mb-0"},[e("i",{class:"fas fa-pencil-ruler me-1"}),m("Outils de Dessin ")])],-1)),e("div",V,[e("div",D,[c(e("input",{type:"radio",class:"btn-check",id:"tool-select","onUpdate:modelValue":t[0]||(t[0]=i=>o.currentTool=i),value:"select",autocomplete:"off"},null,512),[[y,o.currentTool]]),t[19]||(t[19]=e("label",{class:"btn btn-outline-primary btn-sm",for:"tool-select"},[e("i",{class:"fas fa-mouse-pointer me-1"}),m("Sélection ")],-1)),c(e("input",{type:"radio",class:"btn-check",id:"tool-box","onUpdate:modelValue":t[1]||(t[1]=i=>o.currentTool=i),value:"box",autocomplete:"off"},null,512),[[y,o.currentTool]]),t[20]||(t[20]=e("label",{class:"btn btn-outline-success btn-sm",for:"tool-box"},[e("i",{class:"fas fa-vector-square me-1"}),m("Créer Box ")],-1)),c(e("input",{type:"radio",class:"btn-check",id:"tool-room","onUpdate:modelValue":t[2]||(t[2]=i=>o.currentTool=i),value:"room",autocomplete:"off"},null,512),[[y,o.currentTool]]),t[21]||(t[21]=e("label",{class:"btn btn-outline-info btn-sm",for:"tool-room"},[e("i",{class:"fas fa-draw-polygon me-1"}),m("Zone/Salle ")],-1)),c(e("input",{type:"radio",class:"btn-check",id:"tool-wall","onUpdate:modelValue":t[3]||(t[3]=i=>o.currentTool=i),value:"wall",autocomplete:"off"},null,512),[[y,o.currentTool]]),t[22]||(t[22]=e("label",{class:"btn btn-outline-secondary btn-sm",for:"tool-wall"},[e("i",{class:"fas fa-grip-lines me-1"}),m("Mur ")],-1)),c(e("input",{type:"radio",class:"btn-check",id:"tool-door","onUpdate:modelValue":t[4]||(t[4]=i=>o.currentTool=i),value:"door",autocomplete:"off"},null,512),[[y,o.currentTool]]),t[23]||(t[23]=e("label",{class:"btn btn-outline-warning btn-sm",for:"tool-door"},[e("i",{class:"fas fa-door-open me-1"}),m("Porte ")],-1)),c(e("input",{type:"radio",class:"btn-check",id:"tool-text","onUpdate:modelValue":t[5]||(t[5]=i=>o.currentTool=i),value:"text",autocomplete:"off"},null,512),[[y,o.currentTool]]),t[24]||(t[24]=e("label",{class:"btn btn-outline-dark btn-sm",for:"tool-text"},[e("i",{class:"fas fa-font me-1"}),m("Texte ")],-1)),c(e("input",{type:"radio",class:"btn-check",id:"tool-arrow","onUpdate:modelValue":t[6]||(t[6]=i=>o.currentTool=i),value:"arrow",autocomplete:"off"},null,512),[[y,o.currentTool]]),t[25]||(t[25]=e("label",{class:"btn btn-outline-danger btn-sm",for:"tool-arrow"},[e("i",{class:"fas fa-arrow-right me-1"}),m("Flèche ")],-1))]),o.currentTool==="box"?(d(),a("div",O,[t[28]||(t[28]=e("h6",{class:"small text-muted mb-2"},"Options Box:",-1)),e("div",L,[t[26]||(t[26]=e("label",{class:"form-label small mb-1"},"Largeur (px)",-1)),c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>o.boxWidth=i),type:"number",class:"form-control form-control-sm",min:"50"},null,512),[[p,o.boxWidth,void 0,{number:!0}]])]),e("div",E,[t[27]||(t[27]=e("label",{class:"form-label small mb-1"},"Hauteur (px)",-1)),c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=i=>o.boxHeight=i),type:"number",class:"form-control form-control-sm",min:"40"},null,512),[[p,o.boxHeight,void 0,{number:!0}]])]),t[29]||(t[29]=e("div",{class:"alert alert-info small p-2 mb-0"},[e("i",{class:"fas fa-info-circle me-1"}),m(" Cliquez sur le plan pour placer une nouvelle box ")],-1))])):o.currentTool==="room"?(d(),a("div",R,[t[32]||(t[32]=e("h6",{class:"small text-muted mb-2"},"Options Zone:",-1)),e("div",H,[t[30]||(t[30]=e("label",{class:"form-label small mb-1"},"Nom de la zone",-1)),c(e("input",{"onUpdate:modelValue":t[9]||(t[9]=i=>o.roomName=i),type:"text",class:"form-control form-control-sm",placeholder:"Ex: Salle A"},null,512),[[p,o.roomName]])]),e("div",N,[t[31]||(t[31]=e("label",{class:"form-label small mb-1"},"Couleur",-1)),c(e("input",{"onUpdate:modelValue":t[10]||(t[10]=i=>o.roomColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.roomColor]])]),t[33]||(t[33]=e("div",{class:"alert alert-info small p-2 mb-0"},[e("i",{class:"fas fa-info-circle me-1"}),m(" Dessinez en maintenant le clic ")],-1))])):o.currentTool==="wall"?(d(),a("div",W,[t[36]||(t[36]=e("h6",{class:"small text-muted mb-2"},"Options Mur:",-1)),e("div",P,[t[34]||(t[34]=e("label",{class:"form-label small mb-1"},"Épaisseur (px)",-1)),c(e("input",{"onUpdate:modelValue":t[11]||(t[11]=i=>o.wallThickness=i),type:"number",class:"form-control form-control-sm",min:"1",max:"20"},null,512),[[p,o.wallThickness,void 0,{number:!0}]])]),e("div",A,[t[35]||(t[35]=e("label",{class:"form-label small mb-1"},"Couleur",-1)),c(e("input",{"onUpdate:modelValue":t[12]||(t[12]=i=>o.wallColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.wallColor]])])])):o.currentTool==="text"?(d(),a("div",G,[t[40]||(t[40]=e("h6",{class:"small text-muted mb-2"},"Options Texte:",-1)),e("div",Z,[t[37]||(t[37]=e("label",{class:"form-label small mb-1"},"Texte",-1)),c(e("input",{"onUpdate:modelValue":t[13]||(t[13]=i=>o.textContent=i),type:"text",class:"form-control form-control-sm",placeholder:"Saisir le texte"},null,512),[[p,o.textContent]])]),e("div",j,[t[38]||(t[38]=e("label",{class:"form-label small mb-1"},"Taille",-1)),c(e("input",{"onUpdate:modelValue":t[14]||(t[14]=i=>o.textSize=i),type:"number",class:"form-control form-control-sm",min:"8",max:"72"},null,512),[[p,o.textSize,void 0,{number:!0}]])]),e("div",F,[t[39]||(t[39]=e("label",{class:"form-label small mb-1"},"Couleur",-1)),c(e("input",{"onUpdate:modelValue":t[15]||(t[15]=i=>o.textColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.textColor]])])])):o.currentTool==="arrow"?(d(),a("div",q,[t[43]||(t[43]=e("h6",{class:"small text-muted mb-2"},"Options Flèche:",-1)),e("div",K,[t[41]||(t[41]=e("label",{class:"form-label small mb-1"},"Épaisseur (px)",-1)),c(e("input",{"onUpdate:modelValue":t[16]||(t[16]=i=>o.arrowThickness=i),type:"number",class:"form-control form-control-sm",min:"1",max:"10"},null,512),[[p,o.arrowThickness,void 0,{number:!0}]])]),e("div",J,[t[42]||(t[42]=e("label",{class:"form-label small mb-1"},"Couleur",-1)),c(e("input",{"onUpdate:modelValue":t[17]||(t[17]=i=>o.arrowColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.arrowColor]])])])):x("",!0)])]),e("div",Q,[t[47]||(t[47]=e("div",{class:"card-header bg-secondary text-white py-2"},[e("h6",{class:"mb-0"},[e("i",{class:"fas fa-layer-group me-1"}),m("Calques ")])],-1)),e("div",$,[e("div",tt,[(d(!0),a(f,null,g(o.layers,i=>(d(),a("div",{key:i.id,class:w(["list-group-item p-2 d-flex align-items-center justify-content-between",{active:i.id===o.activeLayer}])},[e("div",et,[c(e("input",{"onUpdate:modelValue":s=>i.visible=s,type:"checkbox",class:"form-check-input",id:"layer-"+i.id},null,8,st),[[S,i.visible]]),e("label",{class:"form-check-label small",for:"layer-"+i.id},h(i.name),9,lt)]),e("button",{onClick:s=>n.setActiveLayer(i.id),class:w(["btn btn-sm btn-outline-primary",{active:i.id===o.activeLayer}])},[...t[45]||(t[45]=[e("i",{class:"fas fa-edit"},null,-1)])],10,ot)],2))),128))]),e("button",{onClick:t[18]||(t[18]=(...i)=>n.addLayer&&n.addLayer(...i)),class:"btn btn-sm btn-outline-success w-100 mt-2"},[...t[46]||(t[46]=[e("i",{class:"fas fa-plus me-1"},null,-1),m("Nouveau calque ",-1)])])])])])}const it=C(U,[["render",nt],["__scopeId","data-v-642762ec"]]),rt={components:{DrawingTools:it},props:{boxes:{type:Array,required:!0},emplacements:{type:Array,required:!0},planLayouts:{type:Object,default:()=>({})}},data(){return{selectedEmplacementId:this.emplacements[0]?.id||null,localBoxes:[],backgroundImage:null,zoom:100,showGrid:!0,gridSize:20,snapToGrid:!0,canvasWidth:1200,canvasHeight:800,selectedBoxes:[],currentTool:"select",toolOptions:{},rooms:[],walls:[],doors:[],texts:[],arrows:[],isDrawing:!1,currentShape:null,mouseX:0,mouseY:0,dragging:!1,resizing:!1,rotating:!1,dragStartX:0,dragStartY:0,currentBox:null,resizeHandles:["nw","ne","sw","se","n","s","e","w"],history:[],historyIndex:-1,maxHistory:50,showSuccess:!1,nextBoxId:1e3,nextRoomId:1,nextWallId:1,nextDoorId:1,nextTextId:1,nextArrowId:1}},computed:{availableBoxes(){return this.localBoxes.filter(l=>l.emplacement_id===this.selectedEmplacementId)},canUndo(){return this.historyIndex>0},canRedo(){return this.historyIndex<this.history.length-1}},mounted(){this.initializeBoxes(),this.loadEmplacementPlan(),this.saveState(),document.addEventListener("keydown",this.handleKeyDown)},beforeUnmount(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{initializeBoxes(){this.localBoxes=this.boxes.map(l=>({...l,plan_x:l.plan_x||null,plan_y:l.plan_y||null,plan_width:l.plan_width||100,plan_height:l.plan_height||80,rotation:l.rotation||0}))},loadEmplacementPlan(){const l=this.planLayouts[this.selectedEmplacementId];this.backgroundImage=l?.background_image||null},handleBackgroundUpload(l){const t=l.target.files[0];if(t){const r=new FileReader;r.onload=u=>{this.backgroundImage=u.target.result,this.saveState()},r.readAsDataURL(t)}},handleToolChange(l){this.currentTool=l.tool,this.toolOptions=l.options,this.selectedBoxes=[]},handleLayerChange(l){console.log("Layer changed:",l)},getCursor(){switch(this.currentTool){case"box":case"room":return"crosshair";case"wall":case"arrow":return"crosshair";case"text":return"text";case"door":return"pointer";default:return"default"}},getToolName(){return{select:"Sélection",box:"Créer Box",room:"Zone/Salle",wall:"Mur",door:"Porte",text:"Texte",arrow:"Flèche"}[this.currentTool]||"Inconnu"},handleCanvasMouseDown(l){if(l.target!==this.$refs.canvas&&!l.target.classList.contains("grid-overlay"))return;const t=this.$refs.canvas.getBoundingClientRect(),r=Math.round((l.clientX-t.left)/(this.zoom/100)),u=Math.round((l.clientY-t.top)/(this.zoom/100));(this.currentTool==="room"||this.currentTool==="wall"||this.currentTool==="arrow")&&(this.isDrawing=!0,this.currentShape={startX:r,startY:u,endX:r,endY:u})},handleCanvasMouseMove(l){const t=this.$refs.canvas.getBoundingClientRect();if(this.mouseX=Math.round((l.clientX-t.left)/(this.zoom/100)),this.mouseY=Math.round((l.clientY-t.top)/(this.zoom/100)),this.isDrawing&&this.currentShape&&(this.currentShape.endX=this.mouseX,this.currentShape.endY=this.mouseY),this.dragging&&this.selectedBoxes.length>0){const r=(l.clientX-this.dragStartX)/(this.zoom/100),u=(l.clientY-this.dragStartY)/(this.zoom/100);this.selectedBoxes.forEach(o=>{let n=o.dragStartX+r,i=o.dragStartY+u;this.snapToGrid&&(n=Math.round(n/this.gridSize)*this.gridSize,i=Math.round(i/this.gridSize)*this.gridSize),o.plan_x=Math.max(0,Math.min(this.canvasWidth-o.plan_width,n)),o.plan_y=Math.max(0,Math.min(this.canvasHeight-o.plan_height,i))})}},handleCanvasMouseUp(){this.isDrawing&&this.currentShape&&this.finalizeShape(),this.isDrawing=!1,(this.dragging||this.resizing||this.rotating)&&this.saveState(),this.dragging=!1,this.resizing=!1,this.rotating=!1},handleCanvasClick(l){if(l.target!==this.$refs.canvas&&!l.target.classList.contains("grid-overlay"))return;const t=this.$refs.canvas.getBoundingClientRect(),r=Math.round((l.clientX-t.left)/(this.zoom/100)),u=Math.round((l.clientY-t.top)/(this.zoom/100));this.currentTool==="box"?this.createBox(r,u):this.currentTool==="door"?this.createDoor(r,u):this.currentTool==="text"?this.createText(r,u):this.currentTool==="select"&&(this.selectedBoxes=[])},createBox(l,t){const r=this.toolOptions.width||100,u=this.toolOptions.height||80;let o=l,n=t;this.snapToGrid&&(o=Math.round(l/this.gridSize)*this.gridSize,n=Math.round(t/this.gridSize)*this.gridSize);const i={id:this.nextBoxId++,numero:`BOX-${this.nextBoxId}`,statut:"libre",surface:(r/20*(u/20)).toFixed(2),prix_mensuel:50,plan_x:o,plan_y:n,plan_width:r,plan_height:u,rotation:0,emplacement_id:this.selectedEmplacementId,famille:{nom:"Nouvelle",couleur:"#6c757d"},emplacement:{nom:this.emplacements.find(s=>s.id===this.selectedEmplacementId)?.nom}};this.localBoxes.push(i),this.selectedBoxes=[i],this.saveState()},createDoor(l,t){this.doors.push({id:this.nextDoorId++,x:l,y:t}),this.saveState()},createText(l,t){if(!this.toolOptions.content){alert("Veuillez saisir un texte dans les options");return}this.texts.push({id:this.nextTextId++,x:l,y:t,content:this.toolOptions.content,size:this.toolOptions.size||14,color:this.toolOptions.color||"#000000"}),this.saveState()},finalizeShape(){const l=this.currentShape,t=Math.min(l.startX,l.endX),r=Math.min(l.startY,l.endY),u=Math.abs(l.endX-l.startX),o=Math.abs(l.endY-l.startY);if(u<10||o<10){this.currentShape=null;return}this.currentTool==="room"?this.rooms.push({id:this.nextRoomId++,x:t,y:r,width:u,height:o,name:this.toolOptions.name||`Zone ${this.nextRoomId}`,color:this.toolOptions.color||"#e3f2fd"}):this.currentTool==="wall"?this.walls.push({id:this.nextWallId++,x1:l.startX,y1:l.startY,x2:l.endX,y2:l.endY,thickness:this.toolOptions.thickness||4,color:this.toolOptions.color||"#333333"}):this.currentTool==="arrow"&&this.arrows.push({id:this.nextArrowId++,x1:l.startX,y1:l.startY,x2:l.endX,y2:l.endY,thickness:this.toolOptions.thickness||2,color:this.toolOptions.color||"#dc3545"}),this.currentShape=null,this.saveState()},getCurrentShapeStyle(){if(!this.currentShape)return{};const l=Math.min(this.currentShape.startX,this.currentShape.endX),t=Math.min(this.currentShape.startY,this.currentShape.endY),r=Math.abs(this.currentShape.endX-this.currentShape.startX),u=Math.abs(this.currentShape.endY-this.currentShape.startY);return{position:"absolute",left:l+"px",top:t+"px",width:r+"px",height:u+"px",border:"2px dashed #0d6efd",backgroundColor:"rgba(13, 110, 253, 0.1)",pointerEvents:"none"}},getArrowHead(l){const t=Math.atan2(l.y2-l.y1,l.x2-l.x1),r=15,u=Math.PI/6,o=l.x2-r*Math.cos(t-u),n=l.y2-r*Math.sin(t-u),i=l.x2-r*Math.cos(t+u),s=l.y2-r*Math.sin(t+u);return`${l.x2},${l.y2} ${o},${n} ${i},${s}`},selectBox(l,t=null){if(this.currentTool==="select")if(t&&t.ctrlKey){const r=this.selectedBoxes.findIndex(u=>u.id===l.id);r>-1?this.selectedBoxes.splice(r,1):this.selectedBoxes.push(l)}else this.selectedBoxes=[l]},isSelected(l){return this.selectedBoxes.some(t=>t.id===l.id)},startDrag(l,t){this.currentTool==="select"&&(this.isSelected(l)||this.selectBox(l,t),this.dragging=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.selectedBoxes.forEach(r=>{r.dragStartX=r.plan_x,r.dragStartY=r.plan_y}))},startResize(l,t,r){this.resizing=!0,this.currentBox=l,this.currentHandle=t,this.dragStartX=r.clientX,this.dragStartY=r.clientY,this.initialWidth=l.plan_width,this.initialHeight=l.plan_height,this.initialX=l.plan_x,this.initialY=l.plan_y},startRotate(l,t){this.rotating=!0,this.currentBox=l;const r=t.target.closest(".box-element").getBoundingClientRect();this.centerX=r.left+r.width/2,this.centerY=r.top+r.height/2},deleteBox(l){if(confirm(`Supprimer la box ${l.numero} ?`)){const t=this.localBoxes.findIndex(r=>r.id===l.id);t>-1&&(this.localBoxes.splice(t,1),this.selectedBoxes=[],this.saveState())}},handleWheel(l){if(l.ctrlKey){l.preventDefault();const t=l.deltaY>0?-25:25;this.zoom=Math.max(25,Math.min(300,this.zoom+t))}},handleKeyDown(l){l.ctrlKey&&l.key==="z"?(l.preventDefault(),this.undo()):l.ctrlKey&&l.key==="y"?(l.preventDefault(),this.redo()):l.key==="Escape"?(this.currentTool="select",this.isDrawing=!1,this.currentShape=null):l.key==="Delete"&&this.selectedBoxes.length>0&&this.selectedBoxes.forEach(t=>this.deleteBox(t))},saveState(){const l=JSON.stringify({boxes:this.localBoxes.map(t=>({id:t.id,plan_x:t.plan_x,plan_y:t.plan_y,plan_width:t.plan_width,plan_height:t.plan_height,rotation:t.rotation})),rooms:this.rooms,walls:this.walls,doors:this.doors,texts:this.texts,arrows:this.arrows});this.history=this.history.slice(0,this.historyIndex+1),this.history.push(l),this.history.length>this.maxHistory?this.history.shift():this.historyIndex++},undo(){this.canUndo&&(this.historyIndex--,this.restoreState(this.history[this.historyIndex]))},redo(){this.canRedo&&(this.historyIndex++,this.restoreState(this.history[this.historyIndex]))},restoreState(l){const t=JSON.parse(l);t.boxes.forEach(r=>{const u=this.localBoxes.find(o=>o.id===r.id);u&&Object.assign(u,r)}),this.rooms=t.rooms||[],this.walls=t.walls||[],this.doors=t.doors||[],this.texts=t.texts||[],this.arrows=t.arrows||[]},savePlan(){const l=this.localBoxes.filter(t=>t.plan_x!==null&&t.plan_y!==null).map(t=>({id:t.id,plan_x:t.plan_x,plan_y:t.plan_y,plan_width:t.plan_width,plan_height:t.plan_height}));I.post(route("boxes.plan.save"),{emplacement_id:this.selectedEmplacementId,background_image:this.backgroundImage,canvas_width:this.canvasWidth,canvas_height:this.canvasHeight,boxes:l,rooms:this.rooms,walls:this.walls,doors:this.doors,texts:this.texts,arrows:this.arrows},{onSuccess:()=>{this.showSuccess=!0,setTimeout(()=>{this.showSuccess=!1},3e3)},onError:t=>{alert("Erreur lors de la sauvegarde: "+JSON.stringify(t))}})},resetPlan(){confirm("Êtes-vous sûr de vouloir réinitialiser le plan ?")&&(this.localBoxes.forEach(l=>{l.plan_x=null,l.plan_y=null}),this.rooms=[],this.walls=[],this.doors=[],this.texts=[],this.arrows=[],this.backgroundImage=null,this.selectedBoxes=[],this.saveState())}}},at={class:"container-fluid py-4"},dt={class:"mb-4"},ut={class:"d-flex justify-content-between align-items-center"},ct=["href"],mt=["href"],ht={class:"card mb-3"},pt={class:"card-body"},ft={class:"row align-items-center"},gt={class:"col-md-3"},bt=["value"],vt={class:"card mb-3"},xt={class:"card-body py-2"},yt={class:"d-flex align-items-center justify-content-between"},wt={class:"d-flex gap-3 align-items-center flex-wrap"},kt={class:"d-flex align-items-center gap-2"},St={class:"badge bg-secondary px-3"},Ct={class:"form-check form-switch"},Bt={class:"form-check form-switch"},Tt={class:"btn-group btn-group-sm"},_t=["disabled"],zt=["disabled"],Mt={class:"d-flex gap-2"},It={class:"row"},Ut={class:"col-md-2"},Yt={class:"col-md-7"},Xt={class:"card"},Vt={class:"card-body p-2"},Dt=["width","height"],Ot=["width","height"],Lt=["d"],Et={class:"room-label"},Rt=["width","height"],Ht=["x1","y1","x2","y2","stroke","stroke-width"],Nt=["x1","y1","x2","y2","stroke","stroke-width"],Wt=["points","fill"],Pt=["onMousedown","onClick"],At={class:"box-label"},Gt={class:"box-dimensions"},Zt={class:"box-status-icon"},jt={key:0,class:"fas fa-check-circle text-success"},Ft={key:1,class:"fas fa-lock text-danger"},qt={key:2,class:"fas fa-clock text-warning"},Kt=["onMousedown"],Jt=["onMousedown"],Qt={class:"bg-light p-2 mt-2 small"},$t={class:"row"},te={class:"col-md-6"},ee={class:"col-md-6 text-end"},se={class:"badge bg-primary"},le={class:"badge bg-info ms-1"},oe={class:"badge bg-secondary ms-1"},ne={class:"badge bg-warning ms-1"},ie={key:0,class:"card mt-2"},re={class:"card-body p-2"},ae={class:"col-md-3"},de={key:0,class:"card mb-3"},ue={class:"card-body"},ce={class:"mb-2"},me={class:"row"},he={class:"col-6 mb-2"},pe={class:"col-6 mb-2"},fe={class:"row"},ge={class:"col-6 mb-2"},be={class:"col-6 mb-2"},ve={class:"mb-2"},xe={class:"d-grid gap-2"},ye={class:"card"},we={class:"card-header bg-success text-white py-2"},ke={class:"mb-0"},Se={class:"card-body p-0",style:{"max-height":"400px","overflow-y":"auto"}},Ce={class:"list-group list-group-flush"},Be=["onClick"],Te={class:"d-flex justify-content-between"},_e={class:"text-muted"},ze={key:0,class:"alert alert-success alert-dismissible fade show mt-3 position-fixed top-0 end-0 m-3",style:{"z-index":"9999"}};function Me(l,t,r,u,o,n){const i=T("DrawingTools");return d(),a("div",at,[e("div",dt,[e("div",ut,[t[32]||(t[32]=e("div",null,[e("h1",{class:"h3 mb-1"},[e("i",{class:"fas fa-drafting-compass me-2"}),m("Éditeur de Plan Avancé ")]),e("p",{class:"text-muted"},"Créez et personnalisez le plan de vos emplacements avec des outils professionnels")],-1)),e("div",null,[e("a",{href:l.route("boxes.plan"),class:"btn btn-outline-secondary"},[...t[30]||(t[30]=[e("i",{class:"fas fa-eye me-1"},null,-1),m("Voir le plan ",-1)])],8,ct),e("a",{href:l.route("boxes.index"),class:"btn btn-outline-primary ms-2"},[...t[31]||(t[31]=[e("i",{class:"fas fa-arrow-left me-1"},null,-1),m("Retour aux boxes ",-1)])],8,mt)])])]),e("div",ht,[e("div",pt,[e("div",ft,[e("div",gt,[t[33]||(t[33]=e("label",{class:"form-label mb-1"},[e("i",{class:"fas fa-map-marker-alt me-1"}),m("Emplacement à éditer ")],-1)),c(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.selectedEmplacementId=s),class:"form-select",onChange:t[1]||(t[1]=(...s)=>n.loadEmplacementPlan&&n.loadEmplacementPlan(...s))},[(d(!0),a(f,null,g(r.emplacements,s=>(d(),a("option",{key:s.id,value:s.id},h(s.nom),9,bt))),128))],544),[[_,o.selectedEmplacementId]])]),t[34]||(t[34]=e("div",{class:"col-md-9"},[e("div",{class:"alert alert-info mb-0"},[e("i",{class:"fas fa-lightbulb me-2"}),e("strong",null,"Nouveautés :"),m(" Dessinez des zones, ajoutez des murs, portes et annotations. Créez de nouvelles boxes directement sur le plan ! ")])],-1))])])]),e("div",vt,[e("div",xt,[e("div",yt,[e("div",wt,[e("div",null,[e("input",{type:"file",ref:"fileInput",onChange:t[2]||(t[2]=(...s)=>n.handleBackgroundUpload&&n.handleBackgroundUpload(...s)),accept:"image/*",class:"d-none"},null,544),e("button",{onClick:t[3]||(t[3]=s=>l.$refs.fileInput.click()),class:"btn btn-sm btn-outline-primary"},[...t[35]||(t[35]=[e("i",{class:"fas fa-image me-1"},null,-1),m("Charger plan ",-1)])])]),e("div",kt,[e("button",{onClick:t[4]||(t[4]=s=>o.zoom=Math.max(25,o.zoom-25)),class:"btn btn-sm btn-outline-secondary"},[...t[36]||(t[36]=[e("i",{class:"fas fa-search-minus"},null,-1)])]),e("span",St,h(o.zoom)+"%",1),e("button",{onClick:t[5]||(t[5]=s=>o.zoom=Math.min(300,o.zoom+25)),class:"btn btn-sm btn-outline-secondary"},[...t[37]||(t[37]=[e("i",{class:"fas fa-search-plus"},null,-1)])])]),e("div",Ct,[c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.showGrid=s),type:"checkbox",class:"form-check-input",id:"gridToggle"},null,512),[[S,o.showGrid]]),t[38]||(t[38]=e("label",{class:"form-check-label",for:"gridToggle"},[e("i",{class:"fas fa-th me-1"}),m("Grille ")],-1))]),e("div",Bt,[c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.snapToGrid=s),type:"checkbox",class:"form-check-input",id:"snapToggle"},null,512),[[S,o.snapToGrid]]),t[39]||(t[39]=e("label",{class:"form-check-label",for:"snapToggle"},[e("i",{class:"fas fa-magnet me-1"}),m("Magnétisme ")],-1))]),e("div",Tt,[e("button",{onClick:t[8]||(t[8]=(...s)=>n.undo&&n.undo(...s)),disabled:!n.canUndo,class:"btn btn-outline-secondary",title:"Annuler (Ctrl+Z)"},[...t[40]||(t[40]=[e("i",{class:"fas fa-undo"},null,-1)])],8,_t),e("button",{onClick:t[9]||(t[9]=(...s)=>n.redo&&n.redo(...s)),disabled:!n.canRedo,class:"btn btn-outline-secondary",title:"Rétablir (Ctrl+Y)"},[...t[41]||(t[41]=[e("i",{class:"fas fa-redo"},null,-1)])],8,zt)])]),e("div",Mt,[e("button",{onClick:t[10]||(t[10]=(...s)=>n.savePlan&&n.savePlan(...s)),class:"btn btn-sm btn-success"},[...t[42]||(t[42]=[e("i",{class:"fas fa-save me-1"},null,-1),m("Enregistrer ",-1)])]),e("button",{onClick:t[11]||(t[11]=(...s)=>n.resetPlan&&n.resetPlan(...s)),class:"btn btn-sm btn-danger"},[...t[43]||(t[43]=[e("i",{class:"fas fa-trash me-1"},null,-1),m("Réinitialiser ",-1)])])])])])]),e("div",It,[e("div",Ut,[z(i,{onToolChanged:n.handleToolChange,onLayerChanged:n.handleLayerChange},null,8,["onToolChanged","onLayerChanged"])]),e("div",Yt,[e("div",Xt,[e("div",Vt,[e("div",{class:"canvas-container",onWheel:t[16]||(t[16]=(...s)=>n.handleWheel&&n.handleWheel(...s))},[e("div",{ref:"canvas",class:"canvas",style:v({backgroundImage:o.backgroundImage?`url(${o.backgroundImage})`:"none",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",width:o.canvasWidth+"px",height:o.canvasHeight+"px",transform:`scale(${o.zoom/100})`,transformOrigin:"top left",cursor:n.getCursor()}),onMousedown:t[12]||(t[12]=(...s)=>n.handleCanvasMouseDown&&n.handleCanvasMouseDown(...s)),onMousemove:t[13]||(t[13]=(...s)=>n.handleCanvasMouseMove&&n.handleCanvasMouseMove(...s)),onMouseup:t[14]||(t[14]=(...s)=>n.handleCanvasMouseUp&&n.handleCanvasMouseUp(...s)),onClick:t[15]||(t[15]=(...s)=>n.handleCanvasClick&&n.handleCanvasClick(...s))},[o.showGrid?(d(),a("svg",{key:0,class:"grid-overlay",width:o.canvasWidth,height:o.canvasHeight},[e("defs",null,[e("pattern",{id:"grid",width:o.gridSize,height:o.gridSize,patternUnits:"userSpaceOnUse"},[e("path",{d:`M ${o.gridSize} 0 L 0 0 0 ${o.gridSize}`,fill:"none",stroke:"#dee2e6","stroke-width":"1"},null,8,Lt)],8,Ot)]),t[44]||(t[44]=e("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1))],8,Dt)):x("",!0),(d(!0),a(f,null,g(o.rooms,s=>(d(),a("div",{key:"room-"+s.id,class:"room-element",style:v({left:s.x+"px",top:s.y+"px",width:s.width+"px",height:s.height+"px",backgroundColor:s.color,border:"2px dashed "+s.color,opacity:.3})},[e("div",Et,h(s.name),1)],4))),128)),(d(),a("svg",{class:"drawing-overlay",width:o.canvasWidth,height:o.canvasHeight},[(d(!0),a(f,null,g(o.walls,s=>(d(),a("line",{key:"wall-"+s.id,x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,stroke:s.color,"stroke-width":s.thickness,"stroke-linecap":"round"},null,8,Ht))),128)),(d(!0),a(f,null,g(o.arrows,s=>(d(),a("g",{key:"arrow-"+s.id},[e("line",{x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,stroke:s.color,"stroke-width":s.thickness,"stroke-linecap":"round"},null,8,Nt),e("polygon",{points:n.getArrowHead(s),fill:s.color},null,8,Wt)]))),128))],8,Rt)),(d(!0),a(f,null,g(o.doors,s=>(d(),a("div",{key:"door-"+s.id,class:"door-element",style:v({left:s.x+"px",top:s.y+"px",width:"60px",height:"10px",backgroundColor:"#8B4513",borderRadius:"2px"})},null,4))),128)),(d(!0),a(f,null,g(o.texts,s=>(d(),a("div",{key:"text-"+s.id,class:"text-element",style:v({left:s.x+"px",top:s.y+"px",fontSize:s.size+"px",color:s.color,fontWeight:"bold"})},h(s.content),5))),128)),o.currentShape?(d(),a("div",{key:1,class:"drawing-shape",style:v(n.getCurrentShapeStyle())},null,4)):x("",!0),(d(!0),a(f,null,g(o.localBoxes,s=>(d(),a("div",{key:"box-"+s.id,class:w(["box-element",{selected:n.isSelected(s),libre:s.statut==="libre",occupe:s.statut==="occupe",reserve:s.statut==="reserve",maintenance:s.statut==="maintenance"}]),style:v({left:s.plan_x+"px",top:s.plan_y+"px",width:s.plan_width+"px",height:s.plan_height+"px",transform:s.rotation?`rotate(${s.rotation}deg)`:"none"}),onMousedown:k(b=>n.startDrag(s,b),["stop"]),onClick:k(b=>n.selectBox(s,b),["stop"])},[e("div",At,[e("strong",null,h(s.numero),1)]),e("div",Gt,[e("small",null,h(s.surface)+"m²",1)]),e("div",Zt,[s.statut==="libre"?(d(),a("i",jt)):s.statut==="occupe"?(d(),a("i",Ft)):s.statut==="reserve"?(d(),a("i",qt)):x("",!0)]),n.isSelected(s)&&o.currentTool==="select"?(d(),a(f,{key:0},[(d(!0),a(f,null,g(o.resizeHandles,b=>(d(),a("div",{key:b,class:w(`resize-handle ${b}`),onMousedown:k(B=>n.startResize(s,b,B),["stop"])},null,42,Kt))),128)),e("div",{class:"rotate-handle",onMousedown:k(b=>n.startRotate(s,b),["stop"])},[...t[45]||(t[45]=[e("i",{class:"fas fa-sync-alt"},null,-1)])],40,Jt)],64)):x("",!0)],46,Pt))),128))],36)],32),e("div",Qt,[e("div",$t,[e("div",te,[t[46]||(t[46]=e("strong",null,"Outil:",-1)),m(" "+h(n.getToolName())+" | ",1),t[47]||(t[47]=e("strong",null,"Position:",-1)),m(" X: "+h(o.mouseX)+", Y: "+h(o.mouseY),1)]),e("div",ee,[e("span",se,h(o.localBoxes.length)+" Boxes",1),e("span",le,h(o.rooms.length)+" Zones",1),e("span",oe,h(o.walls.length)+" Murs",1),e("span",ne,h(o.texts.length)+" Annotations",1)])])])])]),o.backgroundImage?(d(),a("div",ie,[e("div",re,[e("div",{class:"minimap",style:v({backgroundImage:`url(${o.backgroundImage})`})},[(d(!0),a(f,null,g(o.localBoxes,s=>(d(),a("div",{key:"mini-"+s.id,class:w(["minimap-box",s.statut]),style:v({left:s.plan_x/o.canvasWidth*100+"%",top:s.plan_y/o.canvasHeight*100+"%",width:s.plan_width/o.canvasWidth*100+"%",height:s.plan_height/o.canvasHeight*100+"%"})},null,6))),128))],4)])])):x("",!0)]),e("div",ae,[o.selectedBoxes.length===1?(d(),a("div",de,[t[56]||(t[56]=e("div",{class:"card-header bg-primary text-white py-2"},[e("h6",{class:"mb-0"},[e("i",{class:"fas fa-cog me-1"}),m("Propriétés Box ")])],-1)),e("div",ue,[e("div",ce,[t[48]||(t[48]=e("label",{class:"form-label small mb-1"},"Numéro",-1)),c(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>o.selectedBoxes[0].numero=s),type:"text",class:"form-control form-control-sm",disabled:""},null,512),[[p,o.selectedBoxes[0].numero]])]),e("div",me,[e("div",he,[t[49]||(t[49]=e("label",{class:"form-label small mb-1"},"X",-1)),c(e("input",{"onUpdate:modelValue":t[18]||(t[18]=s=>o.selectedBoxes[0].plan_x=s),type:"number",class:"form-control form-control-sm",onChange:t[19]||(t[19]=(...s)=>n.saveState&&n.saveState(...s))},null,544),[[p,o.selectedBoxes[0].plan_x,void 0,{number:!0}]])]),e("div",pe,[t[50]||(t[50]=e("label",{class:"form-label small mb-1"},"Y",-1)),c(e("input",{"onUpdate:modelValue":t[20]||(t[20]=s=>o.selectedBoxes[0].plan_y=s),type:"number",class:"form-control form-control-sm",onChange:t[21]||(t[21]=(...s)=>n.saveState&&n.saveState(...s))},null,544),[[p,o.selectedBoxes[0].plan_y,void 0,{number:!0}]])])]),e("div",fe,[e("div",ge,[t[51]||(t[51]=e("label",{class:"form-label small mb-1"},"Largeur",-1)),c(e("input",{"onUpdate:modelValue":t[22]||(t[22]=s=>o.selectedBoxes[0].plan_width=s),type:"number",class:"form-control form-control-sm",onChange:t[23]||(t[23]=(...s)=>n.saveState&&n.saveState(...s))},null,544),[[p,o.selectedBoxes[0].plan_width,void 0,{number:!0}]])]),e("div",be,[t[52]||(t[52]=e("label",{class:"form-label small mb-1"},"Hauteur",-1)),c(e("input",{"onUpdate:modelValue":t[24]||(t[24]=s=>o.selectedBoxes[0].plan_height=s),type:"number",class:"form-control form-control-sm",onChange:t[25]||(t[25]=(...s)=>n.saveState&&n.saveState(...s))},null,544),[[p,o.selectedBoxes[0].plan_height,void 0,{number:!0}]])])]),e("div",ve,[t[53]||(t[53]=e("label",{class:"form-label small mb-1"},"Rotation (°)",-1)),c(e("input",{"onUpdate:modelValue":t[26]||(t[26]=s=>o.selectedBoxes[0].rotation=s),type:"number",class:"form-control form-control-sm",min:"0",max:"360",onChange:t[27]||(t[27]=(...s)=>n.saveState&&n.saveState(...s))},null,544),[[p,o.selectedBoxes[0].rotation,void 0,{number:!0}]])]),t[55]||(t[55]=e("hr",null,null,-1)),e("div",xe,[e("button",{onClick:t[28]||(t[28]=s=>n.deleteBox(o.selectedBoxes[0])),class:"btn btn-sm btn-outline-danger"},[...t[54]||(t[54]=[e("i",{class:"fas fa-trash me-1"},null,-1),m("Supprimer ",-1)])])])])])):x("",!0),e("div",ye,[e("div",we,[e("h6",ke,[t[57]||(t[57]=e("i",{class:"fas fa-box me-1"},null,-1)),m("Boxes ("+h(n.availableBoxes.length)+") ",1)])]),e("div",Se,[e("div",Ce,[(d(!0),a(f,null,g(n.availableBoxes,s=>(d(),a("div",{key:"list-"+s.id,class:w(["list-group-item list-group-item-action p-2",{active:n.isSelected(s)}]),onClick:b=>n.selectBox(s),style:{cursor:"pointer"}},[e("div",Te,[e("div",null,[e("strong",null,h(s.numero),1),e("span",{class:w(["badge ms-1",{"bg-success":s.statut==="libre","bg-danger":s.statut==="occupe","bg-warning":s.statut==="reserve"}])},h(s.statut),3)]),e("small",_e,h(s.surface)+"m²",1)])],10,Be))),128))])])]),t[58]||(t[58]=M('<div class="card mt-3" data-v-eac05f8e><div class="card-header py-2" data-v-eac05f8e><h6 class="mb-0" data-v-eac05f8e><i class="fas fa-keyboard me-1" data-v-eac05f8e></i>Raccourcis </h6></div><div class="card-body p-2" data-v-eac05f8e><small class="text-muted" data-v-eac05f8e><strong data-v-eac05f8e>Ctrl+Z:</strong> Annuler<br data-v-eac05f8e><strong data-v-eac05f8e>Ctrl+Y:</strong> Rétablir<br data-v-eac05f8e><strong data-v-eac05f8e>Suppr:</strong> Supprimer<br data-v-eac05f8e><strong data-v-eac05f8e>Échap:</strong> Annuler outil<br data-v-eac05f8e><strong data-v-eac05f8e>Ctrl+Scroll:</strong> Zoom </small></div></div>',1))])]),o.showSuccess?(d(),a("div",ze,[t[59]||(t[59]=e("i",{class:"fas fa-check-circle me-2"},null,-1)),t[60]||(t[60]=m(" Plan enregistré avec succès ! ",-1)),e("button",{type:"button",class:"btn-close",onClick:t[29]||(t[29]=s=>o.showSuccess=!1)})])):x("",!0)])}const Xe=C(rt,[["render",Me],["__scopeId","data-v-eac05f8e"]]);export{Xe as default};
