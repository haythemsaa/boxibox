import{C as _,u as D}from"./ClientLayout-DE-sKSWk.js";import{r as w,f as x,o as r,w as k,a as e,c as i,i as u,d as m,g as c,n as p,t as d,h as F,l as P,F as v,j as b,x as h}from"./app-zGlaTtug.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const S={components:{ClientLayout:_},props:{documents:{type:Object,required:!0},errors:{type:Object,default:()=>({})}},setup(){return{toast:D()}},data(){return{selectedFiles:[],isDragOver:!1,uploading:!1,uploadProgress:0,showPreview:!1,previewDocument:null,form:{nom_document:""}}},methods:{handleDragEnter(s){this.isDragOver=!0},handleDragOver(s){this.isDragOver=!0},handleDragLeave(s){s.target===this.$refs.uploadZone&&(this.isDragOver=!1)},handleDrop(s){this.isDragOver=!1;const t=Array.from(s.dataTransfer.files);this.processFiles(t)},handleFileSelect(s){const t=Array.from(s.target.files);this.processFiles(t)},processFiles(s){const t=[],f=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/jpg","image/png"];for(const a of s){if(!f.includes(a.type)){this.toast.warning(`${a.name} : Type de fichier non supporté`);continue}if(a.size>20971520){this.toast.warning(`${a.name} : Fichier trop volumineux (max 20 Mo)`);continue}t.push(a)}t.length>0&&(this.selectedFiles.push(...t),this.toast.success(`${t.length} fichier(s) ajouté(s)`))},removeFile(s){this.selectedFiles.splice(s,1)},getFileIcon(s){return s.type==="application/pdf"?"fas fa-file-pdf text-danger":s.type.startsWith("image/")?"fas fa-file-image text-info":s.type.includes("word")?"fas fa-file-word text-primary":"fas fa-file text-secondary"},uploadDocument(){if(this.selectedFiles.length===0)return;this.uploading=!0,this.uploadProgress=0;const s=new FormData;this.selectedFiles.forEach((t,n)=>{s.append(`files[${n}]`,t)}),this.form.nom_document&&s.append("nom_document",this.form.nom_document),h.post(route("client.documents.upload"),s,{onSuccess:()=>{this.selectedFiles=[],this.form.nom_document="",this.$refs.fileInput.value="",this.uploading=!1,this.uploadProgress=0,this.toast.saveSuccess("Document(s)")},onError:t=>{this.uploading=!1,this.uploadProgress=0,this.toast.error("Erreur lors de l'upload des documents")},onProgress:t=>{this.uploadProgress=Math.round(t.loaded/t.total*100)}})},previewDocument(s){this.previewDocument=s,this.showPreview=!0},closePreview(){this.showPreview=!1,this.previewDocument=null},confirmDelete(s){confirm("Êtes-vous sûr de vouloir supprimer ce document ?")&&h.delete(route("client.documents.delete",s.id),{onSuccess:()=>{this.toast.deleteSuccess("Document")},onError:()=>{this.toast.error("Erreur lors de la suppression")}})},changePage(s){s<1||s>this.documents.last_page||h.get(route("client.documents"),{page:s},{preserveState:!0,preserveScroll:!0})},formatDate(s){return s?new Date(s).toLocaleDateString("fr-FR"):""},formatTime(s){return s?new Date(s).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):""},formatFileSize(s){if(!s)return"0 Octets";const t=1024,n=["Octets","Ko","Mo","Go"],f=Math.floor(Math.log(s)/Math.log(t));return Math.round(s/Math.pow(t,f)*100)/100+" "+n[f]},truncate(s,t){return s?s.length>t?s.substring(0,t)+"...":s:""}}},z={class:"card mb-4"},O={class:"card-body"},E={class:"upload-zone-content"},M={key:0,class:"text-danger mt-2"},T={class:"mb-3 mt-3"},j={key:0,class:"invalid-feedback"},L={key:1,class:"mt-3"},I={class:"list-group"},A={class:"d-flex align-items-center"},B={class:"flex-grow-1"},N={class:"text-muted"},V=["onClick"],G=["disabled"],R={key:0},U={key:1},W={class:"card"},X={class:"card-body p-0"},Z={class:"table-responsive"},q={class:"table table-hover align-middle mb-0"},K={key:0},H={key:1,class:"text-muted"},J={class:"text-muted"},Q={key:0},Y={key:1,class:"text-muted"},$={key:0,class:"badge bg-info"},ee={key:1,class:"badge bg-secondary"},te={class:"text-end"},se={class:"btn-group btn-group-sm"},le=["onClick"],oe=["href"],ne=["onClick"],re={key:0},ie={key:0,class:"card-footer bg-white"},ae={class:"d-flex justify-content-between align-items-center"},de={class:"text-muted small"},ue={class:"pagination pagination-sm mb-0"},me={key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},ce={class:"modal-dialog modal-xl modal-dialog-centered"},fe={class:"modal-content"},pe={class:"modal-header"},ge={class:"modal-title"},he={class:"modal-body p-0",style:{height:"80vh"}},ve=["src"],be={class:"modal-footer"},ye=["href"];function _e(s,t,n,f,a,o){const y=w("ClientLayout");return r(),x(y,{title:"Mes Fichiers"},{default:k(()=>[t[34]||(t[34]=e("div",{class:"mb-4"},[e("h1",{class:"h3"},"Mes Fichiers"),e("p",{class:"text-muted"},"Consultez et téléchargez vos documents")],-1)),e("div",z,[t[20]||(t[20]=e("div",{class:"card-header bg-primary text-white"},[e("h5",{class:"mb-0"},[e("i",{class:"fas fa-cloud-upload-alt me-2"}),m("Envoyer un document")])],-1)),e("div",O,[e("form",{onSubmit:t[6]||(t[6]=c((...l)=>o.uploadDocument&&o.uploadDocument(...l),["prevent"])),enctype:"multipart/form-data"},[e("div",{ref:"uploadZone",class:p(["upload-zone",{dragover:a.isDragOver}]),onDragenter:t[1]||(t[1]=c((...l)=>o.handleDragEnter&&o.handleDragEnter(...l),["prevent"])),onDragover:t[2]||(t[2]=c((...l)=>o.handleDragOver&&o.handleDragOver(...l),["prevent"])),onDragleave:t[3]||(t[3]=c((...l)=>o.handleDragLeave&&o.handleDragLeave(...l),["prevent"])),onDrop:t[4]||(t[4]=c((...l)=>o.handleDrop&&o.handleDrop(...l),["prevent"]))},[e("div",E,[t[11]||(t[11]=e("i",{class:"fas fa-cloud-upload-alt fa-4x text-primary mb-3"},null,-1)),t[12]||(t[12]=e("h5",null,"Glissez-déposez votre fichier ici",-1)),t[13]||(t[13]=e("p",{class:"text-muted mb-3"},"ou",-1)),t[14]||(t[14]=e("label",{for:"document",class:"btn btn-primary"},[e("i",{class:"fas fa-folder-open me-1"}),m("Parcourir les fichiers ")],-1)),e("input",{type:"file",ref:"fileInput",class:"d-none",id:"document",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",multiple:"",onChange:t[0]||(t[0]=(...l)=>o.handleFileSelect&&o.handleFileSelect(...l))},null,544),t[15]||(t[15]=e("p",{class:"text-muted small mt-3 mb-0"},[e("i",{class:"fas fa-info-circle me-1"}),m(" Formats : PDF, Word, Images | Taille max : 20 Mo par fichier | Upload multiple supporté ")],-1))])],34),n.errors.document?(r(),i("div",M,d(n.errors.document),1)):u("",!0),e("div",T,[t[16]||(t[16]=e("label",{for:"nom_document",class:"form-label"},"Nom du document (optionnel)",-1)),F(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=l=>a.form.nom_document=l),class:p(["form-control",{"is-invalid":n.errors.nom_document}]),id:"nom_document",placeholder:"Laissez vide pour utiliser le nom du fichier"},null,2),[[P,a.form.nom_document]]),n.errors.nom_document?(r(),i("div",j,d(n.errors.nom_document),1)):u("",!0)]),a.selectedFiles.length>0?(r(),i("div",L,[e("h6",null,"Fichiers sélectionnés ("+d(a.selectedFiles.length)+")",1),e("div",I,[(r(!0),i(v,null,b(a.selectedFiles,(l,g)=>(r(),i("div",{key:g,class:"list-group-item"},[e("div",A,[e("i",{class:p([o.getFileIcon(l),"fa-2x me-3"])},null,2),e("div",B,[e("strong",null,d(l.name),1),t[17]||(t[17]=e("br",null,null,-1)),e("small",N,d(o.formatFileSize(l.size)),1)]),e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:De=>o.removeFile(g)},[...t[18]||(t[18]=[e("i",{class:"fas fa-times"},null,-1)])],8,V)])]))),128))])])):u("",!0),e("button",{type:"submit",class:"btn btn-primary mt-3",disabled:a.selectedFiles.length===0||a.uploading},[t[19]||(t[19]=e("i",{class:"fas fa-upload me-1"},null,-1)),a.uploading?(r(),i("span",R,"Envoi en cours... ("+d(a.uploadProgress)+"%)",1)):(r(),i("span",U,"Envoyer "+d(a.selectedFiles.length)+" fichier(s)",1))],8,G)],32)])]),e("div",W,[t[31]||(t[31]=e("div",{class:"card-header bg-white"},[e("h5",{class:"mb-0"},[e("i",{class:"fas fa-folder-open me-2"}),m("Mes Documents")])],-1)),e("div",X,[e("div",Z,[e("table",q,[t[30]||(t[30]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{style:{width:"50px"}},[e("i",{class:"fas fa-file"})]),e("th",null,"Nom du document"),e("th",null,"Type"),e("th",null,"Date d'ajout"),e("th",null,"Taille"),e("th",null,"Envoyé par"),e("th",{class:"text-end"},"Actions")])],-1)),e("tbody",null,[(r(!0),i(v,null,b(n.documents.data,l=>(r(),i("tr",{key:l.id},[t[27]||(t[27]=e("td",{class:"text-center"},[e("i",{class:"fas fa-file-pdf fa-2x text-danger"})],-1)),e("td",null,[e("strong",null,d(l.nom_document||l.nom_original),1),l.description?(r(),i("br",K)):u("",!0),l.description?(r(),i("small",H,d(o.truncate(l.description,50)),1)):u("",!0)]),t[28]||(t[28]=e("td",null,[e("span",{class:"badge bg-danger"},"PDF")],-1)),e("td",null,[m(d(o.formatDate(l.created_at))+" ",1),t[21]||(t[21]=e("br",null,null,-1)),e("small",J,d(o.formatTime(l.created_at)),1)]),e("td",null,[l.taille?(r(),i("span",Q,d(o.formatFileSize(l.taille)),1)):(r(),i("span",Y,"N/A"))]),e("td",null,[l.uploaded_by===s.$page.props.auth?.user?.id?(r(),i("span",$,[...t[22]||(t[22]=[e("i",{class:"fas fa-user me-1"},null,-1),m("Vous ",-1)])])):(r(),i("span",ee,[...t[23]||(t[23]=[e("i",{class:"fas fa-building me-1"},null,-1),m("BOXIBOX ",-1)])]))]),e("td",te,[e("div",se,[e("button",{type:"button",onClick:g=>o.previewDocument(l),class:"btn btn-outline-info",title:"Prévisualiser"},[...t[24]||(t[24]=[e("i",{class:"fas fa-eye"},null,-1)])],8,le),e("a",{href:s.route("client.documents.download",l.id),class:"btn btn-outline-primary",title:"Télécharger"},[...t[25]||(t[25]=[e("i",{class:"fas fa-download"},null,-1)])],8,oe),l.uploaded_by===s.$page.props.auth?.user?.id?(r(),i("button",{key:0,type:"button",onClick:g=>o.confirmDelete(l),class:"btn btn-outline-danger",title:"Supprimer"},[...t[26]||(t[26]=[e("i",{class:"fas fa-trash"},null,-1)])],8,ne)):u("",!0)])])]))),128)),!n.documents.data||n.documents.data.length===0?(r(),i("tr",re,[...t[29]||(t[29]=[e("td",{colspan:"7",class:"text-center py-5"},[e("i",{class:"fas fa-folder-open fa-3x text-muted mb-3 d-block"}),e("p",{class:"text-muted mb-1"},"Aucun document"),e("small",{class:"text-muted"},"Envoyez votre premier document en utilisant le formulaire ci-dessus")],-1)])])):u("",!0)])])])]),n.documents.last_page>1?(r(),i("div",ie,[e("div",ae,[e("div",de," Affichage de "+d(n.documents.from)+" à "+d(n.documents.to)+" sur "+d(n.documents.total)+" documents ",1),e("nav",null,[e("ul",ue,[e("li",{class:p(["page-item",{disabled:!n.documents.prev_page_url}])},[e("a",{class:"page-link",onClick:t[7]||(t[7]=c(l=>o.changePage(n.documents.current_page-1),["prevent"]))}," Précédent ")],2),e("li",{class:p(["page-item",{disabled:!n.documents.next_page_url}])},[e("a",{class:"page-link",onClick:t[8]||(t[8]=c(l=>o.changePage(n.documents.current_page+1),["prevent"]))}," Suivant ")],2)])])])])):u("",!0)]),a.showPreview?(r(),i("div",me,[e("div",ce,[e("div",fe,[e("div",pe,[e("h5",ge,[t[32]||(t[32]=e("i",{class:"fas fa-file-pdf text-danger me-2"},null,-1)),m(" "+d(o.previewDocument.nom_document||o.previewDocument.nom_original),1)]),e("button",{type:"button",class:"btn-close",onClick:t[9]||(t[9]=(...l)=>o.closePreview&&o.closePreview(...l))})]),e("div",he,[o.previewDocument?(r(),i("iframe",{key:0,src:s.route("client.documents.download",o.previewDocument.id),class:"w-100 h-100",style:{border:"none"}},null,8,ve)):u("",!0)]),e("div",be,[e("a",{href:s.route("client.documents.download",o.previewDocument.id),class:"btn btn-primary",download:""},[...t[33]||(t[33]=[e("i",{class:"fas fa-download me-1"},null,-1),m("Télécharger ",-1)])],8,ye),e("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=(...l)=>o.closePreview&&o.closePreview(...l))}," Fermer ")])])])])):u("",!0)]),_:1})}const Pe=C(S,[["render",_e],["__scopeId","data-v-6c866b34"]]);export{Pe as default};
