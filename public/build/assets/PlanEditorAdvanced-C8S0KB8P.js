import{_ as C,c as a,o as d,a as s,d as m,i as x,h as c,N as y,l as p,F as f,j as g,n as w,p as S,t as h,r as T,v as _,e as z,m as v,g as k,b as M,x as I}from"./app-CRj_m259.js";/* empty css            */const U={data(){return{currentTool:"select",boxWidth:100,boxHeight:80,roomName:"",roomColor:"#e3f2fd",wallThickness:4,wallColor:"#333333",textContent:"",textSize:14,textColor:"#000000",arrowThickness:2,arrowColor:"#dc3545",layers:[{id:1,name:"Fond de plan",visible:!0,locked:!0},{id:2,name:"Zones/Salles",visible:!0,locked:!1},{id:3,name:"Boxes",visible:!0,locked:!1},{id:4,name:"Annotations",visible:!0,locked:!1}],activeLayer:3,nextLayerId:5}},watch:{currentTool(l){this.$emit("tool-changed",{tool:l,options:this.getToolOptions()})}},methods:{getToolOptions(){switch(this.currentTool){case"box":return{width:this.boxWidth,height:this.boxHeight};case"room":return{name:this.roomName,color:this.roomColor};case"wall":return{thickness:this.wallThickness,color:this.wallColor};case"text":return{content:this.textContent,size:this.textSize,color:this.textColor};case"arrow":return{thickness:this.arrowThickness,color:this.arrowColor};default:return{}}},setActiveLayer(l){this.activeLayer=l,this.$emit("layer-changed",l)},addLayer(){const l={id:this.nextLayerId++,name:`Calque ${this.layers.length+1}`,visible:!0,locked:!1};this.layers.push(l),this.activeLayer=l.id}}},Y={class:"drawing-tools"},X={class:"card"},V={class:"card-body p-2"},D={class:"btn-group-vertical w-100 mb-3",role:"group"},O={key:0,class:"tool-options"},L={class:"mb-2"},E={class:"mb-2"},R={key:1,class:"tool-options"},H={class:"mb-2"},N={class:"mb-2"},W={key:2,class:"tool-options"},P={class:"mb-2"},A={class:"mb-2"},G={key:3,class:"tool-options"},Z={class:"mb-2"},j={class:"mb-2"},F={class:"mb-2"},q={key:4,class:"tool-options"},K={class:"mb-2"},J={class:"mb-2"},Q={class:"card mt-3"},$={class:"card-body p-2"},ee={class:"list-group list-group-flush"},se={class:"form-check"},te=["onUpdate:modelValue","id"],le=["for"],oe=["onClick"];function ne(l,e,r,u,o,n){return d(),a("div",Y,[s("div",X,[e[44]||(e[44]=s("div",{class:"card-header bg-dark text-white py-2"},[s("h6",{class:"mb-0"},[s("i",{class:"fas fa-pencil-ruler me-1"}),m("Outils de Dessin ")])],-1)),s("div",V,[s("div",D,[c(s("input",{type:"radio",class:"btn-check",id:"tool-select","onUpdate:modelValue":e[0]||(e[0]=i=>o.currentTool=i),value:"select",autocomplete:"off"},null,512),[[y,o.currentTool]]),e[19]||(e[19]=s("label",{class:"btn btn-outline-primary btn-sm",for:"tool-select"},[s("i",{class:"fas fa-mouse-pointer me-1"}),m("Sélection ")],-1)),c(s("input",{type:"radio",class:"btn-check",id:"tool-box","onUpdate:modelValue":e[1]||(e[1]=i=>o.currentTool=i),value:"box",autocomplete:"off"},null,512),[[y,o.currentTool]]),e[20]||(e[20]=s("label",{class:"btn btn-outline-success btn-sm",for:"tool-box"},[s("i",{class:"fas fa-vector-square me-1"}),m("Créer Box ")],-1)),c(s("input",{type:"radio",class:"btn-check",id:"tool-room","onUpdate:modelValue":e[2]||(e[2]=i=>o.currentTool=i),value:"room",autocomplete:"off"},null,512),[[y,o.currentTool]]),e[21]||(e[21]=s("label",{class:"btn btn-outline-info btn-sm",for:"tool-room"},[s("i",{class:"fas fa-draw-polygon me-1"}),m("Zone/Salle ")],-1)),c(s("input",{type:"radio",class:"btn-check",id:"tool-wall","onUpdate:modelValue":e[3]||(e[3]=i=>o.currentTool=i),value:"wall",autocomplete:"off"},null,512),[[y,o.currentTool]]),e[22]||(e[22]=s("label",{class:"btn btn-outline-secondary btn-sm",for:"tool-wall"},[s("i",{class:"fas fa-grip-lines me-1"}),m("Mur ")],-1)),c(s("input",{type:"radio",class:"btn-check",id:"tool-door","onUpdate:modelValue":e[4]||(e[4]=i=>o.currentTool=i),value:"door",autocomplete:"off"},null,512),[[y,o.currentTool]]),e[23]||(e[23]=s("label",{class:"btn btn-outline-warning btn-sm",for:"tool-door"},[s("i",{class:"fas fa-door-open me-1"}),m("Porte ")],-1)),c(s("input",{type:"radio",class:"btn-check",id:"tool-text","onUpdate:modelValue":e[5]||(e[5]=i=>o.currentTool=i),value:"text",autocomplete:"off"},null,512),[[y,o.currentTool]]),e[24]||(e[24]=s("label",{class:"btn btn-outline-dark btn-sm",for:"tool-text"},[s("i",{class:"fas fa-font me-1"}),m("Texte ")],-1)),c(s("input",{type:"radio",class:"btn-check",id:"tool-arrow","onUpdate:modelValue":e[6]||(e[6]=i=>o.currentTool=i),value:"arrow",autocomplete:"off"},null,512),[[y,o.currentTool]]),e[25]||(e[25]=s("label",{class:"btn btn-outline-danger btn-sm",for:"tool-arrow"},[s("i",{class:"fas fa-arrow-right me-1"}),m("Flèche ")],-1))]),o.currentTool==="box"?(d(),a("div",O,[e[28]||(e[28]=s("h6",{class:"small text-muted mb-2"},"Options Box:",-1)),s("div",L,[e[26]||(e[26]=s("label",{class:"form-label small mb-1"},"Largeur (px)",-1)),c(s("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>o.boxWidth=i),type:"number",class:"form-control form-control-sm",min:"50"},null,512),[[p,o.boxWidth,void 0,{number:!0}]])]),s("div",E,[e[27]||(e[27]=s("label",{class:"form-label small mb-1"},"Hauteur (px)",-1)),c(s("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>o.boxHeight=i),type:"number",class:"form-control form-control-sm",min:"40"},null,512),[[p,o.boxHeight,void 0,{number:!0}]])]),e[29]||(e[29]=s("div",{class:"alert alert-info small p-2 mb-0"},[s("i",{class:"fas fa-info-circle me-1"}),m(" Cliquez sur le plan pour placer une nouvelle box ")],-1))])):o.currentTool==="room"?(d(),a("div",R,[e[32]||(e[32]=s("h6",{class:"small text-muted mb-2"},"Options Zone:",-1)),s("div",H,[e[30]||(e[30]=s("label",{class:"form-label small mb-1"},"Nom de la zone",-1)),c(s("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>o.roomName=i),type:"text",class:"form-control form-control-sm",placeholder:"Ex: Salle A"},null,512),[[p,o.roomName]])]),s("div",N,[e[31]||(e[31]=s("label",{class:"form-label small mb-1"},"Couleur",-1)),c(s("input",{"onUpdate:modelValue":e[10]||(e[10]=i=>o.roomColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.roomColor]])]),e[33]||(e[33]=s("div",{class:"alert alert-info small p-2 mb-0"},[s("i",{class:"fas fa-info-circle me-1"}),m(" Dessinez en maintenant le clic ")],-1))])):o.currentTool==="wall"?(d(),a("div",W,[e[36]||(e[36]=s("h6",{class:"small text-muted mb-2"},"Options Mur:",-1)),s("div",P,[e[34]||(e[34]=s("label",{class:"form-label small mb-1"},"Épaisseur (px)",-1)),c(s("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>o.wallThickness=i),type:"number",class:"form-control form-control-sm",min:"1",max:"20"},null,512),[[p,o.wallThickness,void 0,{number:!0}]])]),s("div",A,[e[35]||(e[35]=s("label",{class:"form-label small mb-1"},"Couleur",-1)),c(s("input",{"onUpdate:modelValue":e[12]||(e[12]=i=>o.wallColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.wallColor]])])])):o.currentTool==="text"?(d(),a("div",G,[e[40]||(e[40]=s("h6",{class:"small text-muted mb-2"},"Options Texte:",-1)),s("div",Z,[e[37]||(e[37]=s("label",{class:"form-label small mb-1"},"Texte",-1)),c(s("input",{"onUpdate:modelValue":e[13]||(e[13]=i=>o.textContent=i),type:"text",class:"form-control form-control-sm",placeholder:"Saisir le texte"},null,512),[[p,o.textContent]])]),s("div",j,[e[38]||(e[38]=s("label",{class:"form-label small mb-1"},"Taille",-1)),c(s("input",{"onUpdate:modelValue":e[14]||(e[14]=i=>o.textSize=i),type:"number",class:"form-control form-control-sm",min:"8",max:"72"},null,512),[[p,o.textSize,void 0,{number:!0}]])]),s("div",F,[e[39]||(e[39]=s("label",{class:"form-label small mb-1"},"Couleur",-1)),c(s("input",{"onUpdate:modelValue":e[15]||(e[15]=i=>o.textColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.textColor]])])])):o.currentTool==="arrow"?(d(),a("div",q,[e[43]||(e[43]=s("h6",{class:"small text-muted mb-2"},"Options Flèche:",-1)),s("div",K,[e[41]||(e[41]=s("label",{class:"form-label small mb-1"},"Épaisseur (px)",-1)),c(s("input",{"onUpdate:modelValue":e[16]||(e[16]=i=>o.arrowThickness=i),type:"number",class:"form-control form-control-sm",min:"1",max:"10"},null,512),[[p,o.arrowThickness,void 0,{number:!0}]])]),s("div",J,[e[42]||(e[42]=s("label",{class:"form-label small mb-1"},"Couleur",-1)),c(s("input",{"onUpdate:modelValue":e[17]||(e[17]=i=>o.arrowColor=i),type:"color",class:"form-control form-control-sm"},null,512),[[p,o.arrowColor]])])])):x("",!0)])]),s("div",Q,[e[47]||(e[47]=s("div",{class:"card-header bg-secondary text-white py-2"},[s("h6",{class:"mb-0"},[s("i",{class:"fas fa-layer-group me-1"}),m("Calques ")])],-1)),s("div",$,[s("div",ee,[(d(!0),a(f,null,g(o.layers,i=>(d(),a("div",{key:i.id,class:w(["list-group-item p-2 d-flex align-items-center justify-content-between",{active:i.id===o.activeLayer}])},[s("div",se,[c(s("input",{"onUpdate:modelValue":t=>i.visible=t,type:"checkbox",class:"form-check-input",id:"layer-"+i.id},null,8,te),[[S,i.visible]]),s("label",{class:"form-check-label small",for:"layer-"+i.id},h(i.name),9,le)]),s("button",{onClick:t=>n.setActiveLayer(i.id),class:w(["btn btn-sm btn-outline-primary",{active:i.id===o.activeLayer}])},[...e[45]||(e[45]=[s("i",{class:"fas fa-edit"},null,-1)])],10,oe)],2))),128))]),s("button",{onClick:e[18]||(e[18]=(...i)=>n.addLayer&&n.addLayer(...i)),class:"btn btn-sm btn-outline-success w-100 mt-2"},[...e[46]||(e[46]=[s("i",{class:"fas fa-plus me-1"},null,-1),m("Nouveau calque ",-1)])])])])])}const ie=C(U,[["render",ne],["__scopeId","data-v-642762ec"]]),re={components:{DrawingTools:ie},props:{boxes:{type:Array,required:!0},emplacements:{type:Array,required:!0},planLayouts:{type:Object,default:()=>({})}},data(){return{selectedEmplacementId:this.emplacements[0]?.id||null,localBoxes:[],backgroundImage:null,zoom:100,showGrid:!0,gridSize:20,snapToGrid:!0,canvasWidth:1200,canvasHeight:800,selectedBoxes:[],currentTool:"select",toolOptions:{},rooms:[],walls:[],doors:[],texts:[],arrows:[],isDrawing:!1,currentShape:null,mouseX:0,mouseY:0,dragging:!1,resizing:!1,rotating:!1,dragStartX:0,dragStartY:0,currentBox:null,resizeHandles:["nw","ne","sw","se","n","s","e","w"],history:[],historyIndex:-1,maxHistory:50,showSuccess:!1,nextBoxId:1e3,nextRoomId:1,nextWallId:1,nextDoorId:1,nextTextId:1,nextArrowId:1}},computed:{availableBoxes(){return this.localBoxes.filter(l=>l.emplacement_id===this.selectedEmplacementId)},canUndo(){return this.historyIndex>0},canRedo(){return this.historyIndex<this.history.length-1}},mounted(){this.initializeBoxes(),this.loadEmplacementPlan(),this.saveState(),document.addEventListener("keydown",this.handleKeyDown)},beforeUnmount(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{initializeBoxes(){this.localBoxes=this.boxes.map(l=>({...l,plan_x:l.plan_x||null,plan_y:l.plan_y||null,plan_width:l.plan_width||100,plan_height:l.plan_height||80,rotation:l.rotation||0}))},loadEmplacementPlan(){const l=this.planLayouts[this.selectedEmplacementId];this.backgroundImage=l?.background_image||null},handleBackgroundUpload(l){const e=l.target.files[0];if(e){const r=new FileReader;r.onload=u=>{this.backgroundImage=u.target.result,this.saveState()},r.readAsDataURL(e)}},handleToolChange(l){this.currentTool=l.tool,this.toolOptions=l.options,this.selectedBoxes=[]},handleLayerChange(l){console.log("Layer changed:",l)},getCursor(){switch(this.currentTool){case"box":case"room":return"crosshair";case"wall":case"arrow":return"crosshair";case"text":return"text";case"door":return"pointer";default:return"default"}},getToolName(){return{select:"Sélection",box:"Créer Box",room:"Zone/Salle",wall:"Mur",door:"Porte",text:"Texte",arrow:"Flèche"}[this.currentTool]||"Inconnu"},handleCanvasMouseDown(l){if(l.target!==this.$refs.canvas&&!l.target.classList.contains("grid-overlay"))return;const e=this.$refs.canvas.getBoundingClientRect(),r=Math.round((l.clientX-e.left)/(this.zoom/100)),u=Math.round((l.clientY-e.top)/(this.zoom/100));(this.currentTool==="room"||this.currentTool==="wall"||this.currentTool==="arrow")&&(this.isDrawing=!0,this.currentShape={startX:r,startY:u,endX:r,endY:u})},handleCanvasMouseMove(l){const e=this.$refs.canvas.getBoundingClientRect();if(this.mouseX=Math.round((l.clientX-e.left)/(this.zoom/100)),this.mouseY=Math.round((l.clientY-e.top)/(this.zoom/100)),this.isDrawing&&this.currentShape&&(this.currentShape.endX=this.mouseX,this.currentShape.endY=this.mouseY),this.dragging&&this.selectedBoxes.length>0){const r=(l.clientX-this.dragStartX)/(this.zoom/100),u=(l.clientY-this.dragStartY)/(this.zoom/100);this.selectedBoxes.forEach(o=>{let n=o.dragStartX+r,i=o.dragStartY+u;this.snapToGrid&&(n=Math.round(n/this.gridSize)*this.gridSize,i=Math.round(i/this.gridSize)*this.gridSize),o.plan_x=Math.max(0,Math.min(this.canvasWidth-o.plan_width,n)),o.plan_y=Math.max(0,Math.min(this.canvasHeight-o.plan_height,i))})}},handleCanvasMouseUp(){this.isDrawing&&this.currentShape&&this.finalizeShape(),this.isDrawing=!1,(this.dragging||this.resizing||this.rotating)&&this.saveState(),this.dragging=!1,this.resizing=!1,this.rotating=!1},handleCanvasClick(l){if(l.target!==this.$refs.canvas&&!l.target.classList.contains("grid-overlay"))return;const e=this.$refs.canvas.getBoundingClientRect(),r=Math.round((l.clientX-e.left)/(this.zoom/100)),u=Math.round((l.clientY-e.top)/(this.zoom/100));this.currentTool==="box"?this.createBox(r,u):this.currentTool==="door"?this.createDoor(r,u):this.currentTool==="text"?this.createText(r,u):this.currentTool==="select"&&(this.selectedBoxes=[])},createBox(l,e){const r=this.toolOptions.width||100,u=this.toolOptions.height||80;let o=l,n=e;this.snapToGrid&&(o=Math.round(l/this.gridSize)*this.gridSize,n=Math.round(e/this.gridSize)*this.gridSize);const i={id:this.nextBoxId++,numero:`BOX-${this.nextBoxId}`,statut:"libre",surface:(r/20*(u/20)).toFixed(2),prix_mensuel:50,plan_x:o,plan_y:n,plan_width:r,plan_height:u,rotation:0,emplacement_id:this.selectedEmplacementId,famille:{nom:"Nouvelle",couleur:"#6c757d"},emplacement:{nom:this.emplacements.find(t=>t.id===this.selectedEmplacementId)?.nom}};this.localBoxes.push(i),this.selectedBoxes=[i],this.saveState()},createDoor(l,e){this.doors.push({id:this.nextDoorId++,x:l,y:e}),this.saveState()},createText(l,e){if(!this.toolOptions.content){alert("Veuillez saisir un texte dans les options");return}this.texts.push({id:this.nextTextId++,x:l,y:e,content:this.toolOptions.content,size:this.toolOptions.size||14,color:this.toolOptions.color||"#000000"}),this.saveState()},finalizeShape(){const l=this.currentShape,e=Math.min(l.startX,l.endX),r=Math.min(l.startY,l.endY),u=Math.abs(l.endX-l.startX),o=Math.abs(l.endY-l.startY);if(u<10||o<10){this.currentShape=null;return}this.currentTool==="room"?this.rooms.push({id:this.nextRoomId++,x:e,y:r,width:u,height:o,name:this.toolOptions.name||`Zone ${this.nextRoomId}`,color:this.toolOptions.color||"#e3f2fd"}):this.currentTool==="wall"?this.walls.push({id:this.nextWallId++,x1:l.startX,y1:l.startY,x2:l.endX,y2:l.endY,thickness:this.toolOptions.thickness||4,color:this.toolOptions.color||"#333333"}):this.currentTool==="arrow"&&this.arrows.push({id:this.nextArrowId++,x1:l.startX,y1:l.startY,x2:l.endX,y2:l.endY,thickness:this.toolOptions.thickness||2,color:this.toolOptions.color||"#dc3545"}),this.currentShape=null,this.saveState()},getCurrentShapeStyle(){if(!this.currentShape)return{};const l=Math.min(this.currentShape.startX,this.currentShape.endX),e=Math.min(this.currentShape.startY,this.currentShape.endY),r=Math.abs(this.currentShape.endX-this.currentShape.startX),u=Math.abs(this.currentShape.endY-this.currentShape.startY);return{position:"absolute",left:l+"px",top:e+"px",width:r+"px",height:u+"px",border:"2px dashed #0d6efd",backgroundColor:"rgba(13, 110, 253, 0.1)",pointerEvents:"none"}},getArrowHead(l){const e=Math.atan2(l.y2-l.y1,l.x2-l.x1),r=15,u=Math.PI/6,o=l.x2-r*Math.cos(e-u),n=l.y2-r*Math.sin(e-u),i=l.x2-r*Math.cos(e+u),t=l.y2-r*Math.sin(e+u);return`${l.x2},${l.y2} ${o},${n} ${i},${t}`},selectBox(l,e=null){if(this.currentTool==="select")if(e&&e.ctrlKey){const r=this.selectedBoxes.findIndex(u=>u.id===l.id);r>-1?this.selectedBoxes.splice(r,1):this.selectedBoxes.push(l)}else this.selectedBoxes=[l]},isSelected(l){return this.selectedBoxes.some(e=>e.id===l.id)},startDrag(l,e){this.currentTool==="select"&&(this.isSelected(l)||this.selectBox(l,e),this.dragging=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.selectedBoxes.forEach(r=>{r.dragStartX=r.plan_x,r.dragStartY=r.plan_y}))},startResize(l,e,r){this.resizing=!0,this.currentBox=l,this.currentHandle=e,this.dragStartX=r.clientX,this.dragStartY=r.clientY,this.initialWidth=l.plan_width,this.initialHeight=l.plan_height,this.initialX=l.plan_x,this.initialY=l.plan_y},startRotate(l,e){this.rotating=!0,this.currentBox=l;const r=e.target.closest(".box-element").getBoundingClientRect();this.centerX=r.left+r.width/2,this.centerY=r.top+r.height/2},deleteBox(l){if(confirm(`Supprimer la box ${l.numero} ?`)){const e=this.localBoxes.findIndex(r=>r.id===l.id);e>-1&&(this.localBoxes.splice(e,1),this.selectedBoxes=[],this.saveState())}},handleWheel(l){if(l.ctrlKey){l.preventDefault();const e=l.deltaY>0?-25:25;this.zoom=Math.max(25,Math.min(300,this.zoom+e))}},handleKeyDown(l){l.ctrlKey&&l.key==="z"?(l.preventDefault(),this.undo()):l.ctrlKey&&l.key==="y"?(l.preventDefault(),this.redo()):l.key==="Escape"?(this.currentTool="select",this.isDrawing=!1,this.currentShape=null):l.key==="Delete"&&this.selectedBoxes.length>0&&this.selectedBoxes.forEach(e=>this.deleteBox(e))},saveState(){const l=JSON.stringify({boxes:this.localBoxes.map(e=>({id:e.id,plan_x:e.plan_x,plan_y:e.plan_y,plan_width:e.plan_width,plan_height:e.plan_height,rotation:e.rotation})),rooms:this.rooms,walls:this.walls,doors:this.doors,texts:this.texts,arrows:this.arrows});this.history=this.history.slice(0,this.historyIndex+1),this.history.push(l),this.history.length>this.maxHistory?this.history.shift():this.historyIndex++},undo(){this.canUndo&&(this.historyIndex--,this.restoreState(this.history[this.historyIndex]))},redo(){this.canRedo&&(this.historyIndex++,this.restoreState(this.history[this.historyIndex]))},restoreState(l){const e=JSON.parse(l);e.boxes.forEach(r=>{const u=this.localBoxes.find(o=>o.id===r.id);u&&Object.assign(u,r)}),this.rooms=e.rooms||[],this.walls=e.walls||[],this.doors=e.doors||[],this.texts=e.texts||[],this.arrows=e.arrows||[]},savePlan(){const l=this.localBoxes.filter(e=>e.plan_x!==null&&e.plan_y!==null).map(e=>({id:e.id,plan_x:e.plan_x,plan_y:e.plan_y,plan_width:e.plan_width,plan_height:e.plan_height}));I.post(route("boxes.plan.save"),{emplacement_id:this.selectedEmplacementId,background_image:this.backgroundImage,canvas_width:this.canvasWidth,canvas_height:this.canvasHeight,boxes:l,rooms:this.rooms,walls:this.walls,doors:this.doors,texts:this.texts,arrows:this.arrows},{onSuccess:()=>{this.showSuccess=!0,setTimeout(()=>{this.showSuccess=!1},3e3)},onError:e=>{alert("Erreur lors de la sauvegarde: "+JSON.stringify(e))}})},resetPlan(){confirm("Êtes-vous sûr de vouloir réinitialiser le plan ?")&&(this.localBoxes.forEach(l=>{l.plan_x=null,l.plan_y=null}),this.rooms=[],this.walls=[],this.doors=[],this.texts=[],this.arrows=[],this.backgroundImage=null,this.selectedBoxes=[],this.saveState())}}},ae={class:"container-fluid py-4"},de={class:"mb-4"},ue={class:"d-flex justify-content-between align-items-center"},ce=["href"],me=["href"],he={class:"card mb-3"},pe={class:"card-body"},fe={class:"row align-items-center"},ge={class:"col-md-3"},be=["value"],ve={class:"card mb-3"},xe={class:"card-body py-2"},ye={class:"d-flex align-items-center justify-content-between"},we={class:"d-flex gap-3 align-items-center flex-wrap"},ke={class:"d-flex align-items-center gap-2"},Se={class:"badge bg-secondary px-3"},Ce={class:"form-check form-switch"},Be={class:"form-check form-switch"},Te={class:"btn-group btn-group-sm"},_e=["disabled"],ze=["disabled"],Me={class:"d-flex gap-2"},Ie={class:"row"},Ue={class:"col-md-2"},Ye={class:"col-md-7"},Xe={class:"card"},Ve={class:"card-body p-2"},De=["width","height"],Oe=["width","height"],Le=["d"],Ee={class:"room-label"},Re=["width","height"],He=["x1","y1","x2","y2","stroke","stroke-width"],Ne=["x1","y1","x2","y2","stroke","stroke-width"],We=["points","fill"],Pe=["onMousedown","onClick"],Ae={class:"box-label"},Ge={class:"box-dimensions"},Ze={class:"box-status-icon"},je={key:0,class:"fas fa-check-circle text-success"},Fe={key:1,class:"fas fa-lock text-danger"},qe={key:2,class:"fas fa-clock text-warning"},Ke=["onMousedown"],Je=["onMousedown"],Qe={class:"bg-light p-2 mt-2 small"},$e={class:"row"},es={class:"col-md-6"},ss={class:"col-md-6 text-end"},ts={class:"badge bg-primary"},ls={class:"badge bg-info ms-1"},os={class:"badge bg-secondary ms-1"},ns={class:"badge bg-warning ms-1"},is={key:0,class:"card mt-2"},rs={class:"card-body p-2"},as={class:"col-md-3"},ds={key:0,class:"card mb-3"},us={class:"card-body"},cs={class:"mb-2"},ms={class:"row"},hs={class:"col-6 mb-2"},ps={class:"col-6 mb-2"},fs={class:"row"},gs={class:"col-6 mb-2"},bs={class:"col-6 mb-2"},vs={class:"mb-2"},xs={class:"d-grid gap-2"},ys={class:"card"},ws={class:"card-header bg-success text-white py-2"},ks={class:"mb-0"},Ss={class:"card-body p-0",style:{"max-height":"400px","overflow-y":"auto"}},Cs={class:"list-group list-group-flush"},Bs=["onClick"],Ts={class:"d-flex justify-content-between"},_s={class:"text-muted"},zs={key:0,class:"alert alert-success alert-dismissible fade show mt-3 position-fixed top-0 end-0 m-3",style:{"z-index":"9999"}};function Ms(l,e,r,u,o,n){const i=T("DrawingTools");return d(),a("div",ae,[s("div",de,[s("div",ue,[e[32]||(e[32]=s("div",null,[s("h1",{class:"h3 mb-1"},[s("i",{class:"fas fa-drafting-compass me-2"}),m("Éditeur de Plan Avancé ")]),s("p",{class:"text-muted"},"Créez et personnalisez le plan de vos emplacements avec des outils professionnels")],-1)),s("div",null,[s("a",{href:l.route("boxes.plan"),class:"btn btn-outline-secondary"},[...e[30]||(e[30]=[s("i",{class:"fas fa-eye me-1"},null,-1),m("Voir le plan ",-1)])],8,ce),s("a",{href:l.route("boxes.index"),class:"btn btn-outline-primary ms-2"},[...e[31]||(e[31]=[s("i",{class:"fas fa-arrow-left me-1"},null,-1),m("Retour aux boxes ",-1)])],8,me)])])]),s("div",he,[s("div",pe,[s("div",fe,[s("div",ge,[e[33]||(e[33]=s("label",{class:"form-label mb-1"},[s("i",{class:"fas fa-map-marker-alt me-1"}),m("Emplacement à éditer ")],-1)),c(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.selectedEmplacementId=t),class:"form-select",onChange:e[1]||(e[1]=(...t)=>n.loadEmplacementPlan&&n.loadEmplacementPlan(...t))},[(d(!0),a(f,null,g(r.emplacements,t=>(d(),a("option",{key:t.id,value:t.id},h(t.nom),9,be))),128))],544),[[_,o.selectedEmplacementId]])]),e[34]||(e[34]=s("div",{class:"col-md-9"},[s("div",{class:"alert alert-info mb-0"},[s("i",{class:"fas fa-lightbulb me-2"}),s("strong",null,"Nouveautés :"),m(" Dessinez des zones, ajoutez des murs, portes et annotations. Créez de nouvelles boxes directement sur le plan ! ")])],-1))])])]),s("div",ve,[s("div",xe,[s("div",ye,[s("div",we,[s("div",null,[s("input",{type:"file",ref:"fileInput",onChange:e[2]||(e[2]=(...t)=>n.handleBackgroundUpload&&n.handleBackgroundUpload(...t)),accept:"image/*",class:"d-none"},null,544),s("button",{onClick:e[3]||(e[3]=t=>l.$refs.fileInput.click()),class:"btn btn-sm btn-outline-primary"},[...e[35]||(e[35]=[s("i",{class:"fas fa-image me-1"},null,-1),m("Charger plan ",-1)])])]),s("div",ke,[s("button",{onClick:e[4]||(e[4]=t=>o.zoom=Math.max(25,o.zoom-25)),class:"btn btn-sm btn-outline-secondary"},[...e[36]||(e[36]=[s("i",{class:"fas fa-search-minus"},null,-1)])]),s("span",Se,h(o.zoom)+"%",1),s("button",{onClick:e[5]||(e[5]=t=>o.zoom=Math.min(300,o.zoom+25)),class:"btn btn-sm btn-outline-secondary"},[...e[37]||(e[37]=[s("i",{class:"fas fa-search-plus"},null,-1)])])]),s("div",Ce,[c(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.showGrid=t),type:"checkbox",class:"form-check-input",id:"gridToggle"},null,512),[[S,o.showGrid]]),e[38]||(e[38]=s("label",{class:"form-check-label",for:"gridToggle"},[s("i",{class:"fas fa-th me-1"}),m("Grille ")],-1))]),s("div",Be,[c(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.snapToGrid=t),type:"checkbox",class:"form-check-input",id:"snapToggle"},null,512),[[S,o.snapToGrid]]),e[39]||(e[39]=s("label",{class:"form-check-label",for:"snapToggle"},[s("i",{class:"fas fa-magnet me-1"}),m("Magnétisme ")],-1))]),s("div",Te,[s("button",{onClick:e[8]||(e[8]=(...t)=>n.undo&&n.undo(...t)),disabled:!n.canUndo,class:"btn btn-outline-secondary",title:"Annuler (Ctrl+Z)"},[...e[40]||(e[40]=[s("i",{class:"fas fa-undo"},null,-1)])],8,_e),s("button",{onClick:e[9]||(e[9]=(...t)=>n.redo&&n.redo(...t)),disabled:!n.canRedo,class:"btn btn-outline-secondary",title:"Rétablir (Ctrl+Y)"},[...e[41]||(e[41]=[s("i",{class:"fas fa-redo"},null,-1)])],8,ze)])]),s("div",Me,[s("button",{onClick:e[10]||(e[10]=(...t)=>n.savePlan&&n.savePlan(...t)),class:"btn btn-sm btn-success"},[...e[42]||(e[42]=[s("i",{class:"fas fa-save me-1"},null,-1),m("Enregistrer ",-1)])]),s("button",{onClick:e[11]||(e[11]=(...t)=>n.resetPlan&&n.resetPlan(...t)),class:"btn btn-sm btn-danger"},[...e[43]||(e[43]=[s("i",{class:"fas fa-trash me-1"},null,-1),m("Réinitialiser ",-1)])])])])])]),s("div",Ie,[s("div",Ue,[z(i,{onToolChanged:n.handleToolChange,onLayerChanged:n.handleLayerChange},null,8,["onToolChanged","onLayerChanged"])]),s("div",Ye,[s("div",Xe,[s("div",Ve,[s("div",{class:"canvas-container",onWheel:e[16]||(e[16]=(...t)=>n.handleWheel&&n.handleWheel(...t))},[s("div",{ref:"canvas",class:"canvas",style:v({backgroundImage:o.backgroundImage?`url(${o.backgroundImage})`:"none",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",width:o.canvasWidth+"px",height:o.canvasHeight+"px",transform:`scale(${o.zoom/100})`,transformOrigin:"top left",cursor:n.getCursor()}),onMousedown:e[12]||(e[12]=(...t)=>n.handleCanvasMouseDown&&n.handleCanvasMouseDown(...t)),onMousemove:e[13]||(e[13]=(...t)=>n.handleCanvasMouseMove&&n.handleCanvasMouseMove(...t)),onMouseup:e[14]||(e[14]=(...t)=>n.handleCanvasMouseUp&&n.handleCanvasMouseUp(...t)),onClick:e[15]||(e[15]=(...t)=>n.handleCanvasClick&&n.handleCanvasClick(...t))},[o.showGrid?(d(),a("svg",{key:0,class:"grid-overlay",width:o.canvasWidth,height:o.canvasHeight},[s("defs",null,[s("pattern",{id:"grid",width:o.gridSize,height:o.gridSize,patternUnits:"userSpaceOnUse"},[s("path",{d:`M ${o.gridSize} 0 L 0 0 0 ${o.gridSize}`,fill:"none",stroke:"#dee2e6","stroke-width":"1"},null,8,Le)],8,Oe)]),e[44]||(e[44]=s("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1))],8,De)):x("",!0),(d(!0),a(f,null,g(o.rooms,t=>(d(),a("div",{key:"room-"+t.id,class:"room-element",style:v({left:t.x+"px",top:t.y+"px",width:t.width+"px",height:t.height+"px",backgroundColor:t.color,border:"2px dashed "+t.color,opacity:.3})},[s("div",Ee,h(t.name),1)],4))),128)),(d(),a("svg",{class:"drawing-overlay",width:o.canvasWidth,height:o.canvasHeight},[(d(!0),a(f,null,g(o.walls,t=>(d(),a("line",{key:"wall-"+t.id,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stroke:t.color,"stroke-width":t.thickness,"stroke-linecap":"round"},null,8,He))),128)),(d(!0),a(f,null,g(o.arrows,t=>(d(),a("g",{key:"arrow-"+t.id},[s("line",{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stroke:t.color,"stroke-width":t.thickness,"stroke-linecap":"round"},null,8,Ne),s("polygon",{points:n.getArrowHead(t),fill:t.color},null,8,We)]))),128))],8,Re)),(d(!0),a(f,null,g(o.doors,t=>(d(),a("div",{key:"door-"+t.id,class:"door-element",style:v({left:t.x+"px",top:t.y+"px",width:"60px",height:"10px",backgroundColor:"#8B4513",borderRadius:"2px"})},null,4))),128)),(d(!0),a(f,null,g(o.texts,t=>(d(),a("div",{key:"text-"+t.id,class:"text-element",style:v({left:t.x+"px",top:t.y+"px",fontSize:t.size+"px",color:t.color,fontWeight:"bold"})},h(t.content),5))),128)),o.currentShape?(d(),a("div",{key:1,class:"drawing-shape",style:v(n.getCurrentShapeStyle())},null,4)):x("",!0),(d(!0),a(f,null,g(o.localBoxes,t=>(d(),a("div",{key:"box-"+t.id,class:w(["box-element",{selected:n.isSelected(t),libre:t.statut==="libre",occupe:t.statut==="occupe",reserve:t.statut==="reserve",maintenance:t.statut==="maintenance"}]),style:v({left:t.plan_x+"px",top:t.plan_y+"px",width:t.plan_width+"px",height:t.plan_height+"px",transform:t.rotation?`rotate(${t.rotation}deg)`:"none"}),onMousedown:k(b=>n.startDrag(t,b),["stop"]),onClick:k(b=>n.selectBox(t,b),["stop"])},[s("div",Ae,[s("strong",null,h(t.numero),1)]),s("div",Ge,[s("small",null,h(t.surface)+"m²",1)]),s("div",Ze,[t.statut==="libre"?(d(),a("i",je)):t.statut==="occupe"?(d(),a("i",Fe)):t.statut==="reserve"?(d(),a("i",qe)):x("",!0)]),n.isSelected(t)&&o.currentTool==="select"?(d(),a(f,{key:0},[(d(!0),a(f,null,g(o.resizeHandles,b=>(d(),a("div",{key:b,class:w(`resize-handle ${b}`),onMousedown:k(B=>n.startResize(t,b,B),["stop"])},null,42,Ke))),128)),s("div",{class:"rotate-handle",onMousedown:k(b=>n.startRotate(t,b),["stop"])},[...e[45]||(e[45]=[s("i",{class:"fas fa-sync-alt"},null,-1)])],40,Je)],64)):x("",!0)],46,Pe))),128))],36)],32),s("div",Qe,[s("div",$e,[s("div",es,[e[46]||(e[46]=s("strong",null,"Outil:",-1)),m(" "+h(n.getToolName())+" | ",1),e[47]||(e[47]=s("strong",null,"Position:",-1)),m(" X: "+h(o.mouseX)+", Y: "+h(o.mouseY),1)]),s("div",ss,[s("span",ts,h(o.localBoxes.length)+" Boxes",1),s("span",ls,h(o.rooms.length)+" Zones",1),s("span",os,h(o.walls.length)+" Murs",1),s("span",ns,h(o.texts.length)+" Annotations",1)])])])])]),o.backgroundImage?(d(),a("div",is,[s("div",rs,[s("div",{class:"minimap",style:v({backgroundImage:`url(${o.backgroundImage})`})},[(d(!0),a(f,null,g(o.localBoxes,t=>(d(),a("div",{key:"mini-"+t.id,class:w(["minimap-box",t.statut]),style:v({left:t.plan_x/o.canvasWidth*100+"%",top:t.plan_y/o.canvasHeight*100+"%",width:t.plan_width/o.canvasWidth*100+"%",height:t.plan_height/o.canvasHeight*100+"%"})},null,6))),128))],4)])])):x("",!0)]),s("div",as,[o.selectedBoxes.length===1?(d(),a("div",ds,[e[56]||(e[56]=s("div",{class:"card-header bg-primary text-white py-2"},[s("h6",{class:"mb-0"},[s("i",{class:"fas fa-cog me-1"}),m("Propriétés Box ")])],-1)),s("div",us,[s("div",cs,[e[48]||(e[48]=s("label",{class:"form-label small mb-1"},"Numéro",-1)),c(s("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>o.selectedBoxes[0].numero=t),type:"text",class:"form-control form-control-sm",disabled:""},null,512),[[p,o.selectedBoxes[0].numero]])]),s("div",ms,[s("div",hs,[e[49]||(e[49]=s("label",{class:"form-label small mb-1"},"X",-1)),c(s("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>o.selectedBoxes[0].plan_x=t),type:"number",class:"form-control form-control-sm",onChange:e[19]||(e[19]=(...t)=>n.saveState&&n.saveState(...t))},null,544),[[p,o.selectedBoxes[0].plan_x,void 0,{number:!0}]])]),s("div",ps,[e[50]||(e[50]=s("label",{class:"form-label small mb-1"},"Y",-1)),c(s("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>o.selectedBoxes[0].plan_y=t),type:"number",class:"form-control form-control-sm",onChange:e[21]||(e[21]=(...t)=>n.saveState&&n.saveState(...t))},null,544),[[p,o.selectedBoxes[0].plan_y,void 0,{number:!0}]])])]),s("div",fs,[s("div",gs,[e[51]||(e[51]=s("label",{class:"form-label small mb-1"},"Largeur",-1)),c(s("input",{"onUpdate:modelValue":e[22]||(e[22]=t=>o.selectedBoxes[0].plan_width=t),type:"number",class:"form-control form-control-sm",onChange:e[23]||(e[23]=(...t)=>n.saveState&&n.saveState(...t))},null,544),[[p,o.selectedBoxes[0].plan_width,void 0,{number:!0}]])]),s("div",bs,[e[52]||(e[52]=s("label",{class:"form-label small mb-1"},"Hauteur",-1)),c(s("input",{"onUpdate:modelValue":e[24]||(e[24]=t=>o.selectedBoxes[0].plan_height=t),type:"number",class:"form-control form-control-sm",onChange:e[25]||(e[25]=(...t)=>n.saveState&&n.saveState(...t))},null,544),[[p,o.selectedBoxes[0].plan_height,void 0,{number:!0}]])])]),s("div",vs,[e[53]||(e[53]=s("label",{class:"form-label small mb-1"},"Rotation (°)",-1)),c(s("input",{"onUpdate:modelValue":e[26]||(e[26]=t=>o.selectedBoxes[0].rotation=t),type:"number",class:"form-control form-control-sm",min:"0",max:"360",onChange:e[27]||(e[27]=(...t)=>n.saveState&&n.saveState(...t))},null,544),[[p,o.selectedBoxes[0].rotation,void 0,{number:!0}]])]),e[55]||(e[55]=s("hr",null,null,-1)),s("div",xs,[s("button",{onClick:e[28]||(e[28]=t=>n.deleteBox(o.selectedBoxes[0])),class:"btn btn-sm btn-outline-danger"},[...e[54]||(e[54]=[s("i",{class:"fas fa-trash me-1"},null,-1),m("Supprimer ",-1)])])])])])):x("",!0),s("div",ys,[s("div",ws,[s("h6",ks,[e[57]||(e[57]=s("i",{class:"fas fa-box me-1"},null,-1)),m("Boxes ("+h(n.availableBoxes.length)+") ",1)])]),s("div",Ss,[s("div",Cs,[(d(!0),a(f,null,g(n.availableBoxes,t=>(d(),a("div",{key:"list-"+t.id,class:w(["list-group-item list-group-item-action p-2",{active:n.isSelected(t)}]),onClick:b=>n.selectBox(t),style:{cursor:"pointer"}},[s("div",Ts,[s("div",null,[s("strong",null,h(t.numero),1),s("span",{class:w(["badge ms-1",{"bg-success":t.statut==="libre","bg-danger":t.statut==="occupe","bg-warning":t.statut==="reserve"}])},h(t.statut),3)]),s("small",_s,h(t.surface)+"m²",1)])],10,Bs))),128))])])]),e[58]||(e[58]=M('<div class="card mt-3" data-v-eac05f8e><div class="card-header py-2" data-v-eac05f8e><h6 class="mb-0" data-v-eac05f8e><i class="fas fa-keyboard me-1" data-v-eac05f8e></i>Raccourcis </h6></div><div class="card-body p-2" data-v-eac05f8e><small class="text-muted" data-v-eac05f8e><strong data-v-eac05f8e>Ctrl+Z:</strong> Annuler<br data-v-eac05f8e><strong data-v-eac05f8e>Ctrl+Y:</strong> Rétablir<br data-v-eac05f8e><strong data-v-eac05f8e>Suppr:</strong> Supprimer<br data-v-eac05f8e><strong data-v-eac05f8e>Échap:</strong> Annuler outil<br data-v-eac05f8e><strong data-v-eac05f8e>Ctrl+Scroll:</strong> Zoom </small></div></div>',1))])]),o.showSuccess?(d(),a("div",zs,[e[59]||(e[59]=s("i",{class:"fas fa-check-circle me-2"},null,-1)),e[60]||(e[60]=m(" Plan enregistré avec succès ! ",-1)),s("button",{type:"button",class:"btn-close",onClick:e[29]||(e[29]=t=>o.showSuccess=!1)})])):x("",!0)])}const Ys=C(re,[["render",Ms],["__scopeId","data-v-eac05f8e"]]);export{Ys as default};
