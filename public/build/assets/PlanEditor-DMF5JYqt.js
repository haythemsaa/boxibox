import{_ as S,c as d,o as r,a as s,d as c,h,l as f,t as m,p as w,N as B,i as g,m as x,F as b,j as k,g as _,n as v,b as z,r as M,f as C,v as I,x as E}from"./app-CRj_m259.js";/* empty css            */const D={props:{boxes:{type:Array,required:!0},emplacementId:{type:Number,required:!0},initialBackgroundImage:{type:String,default:null}},data(){return{localBoxes:[],backgroundImage:this.initialBackgroundImage,zoom:100,showGrid:!0,gridSize:20,snapToGrid:!0,canvasWidth:1200,canvasHeight:800,selectedBoxes:[],dragging:!1,resizing:!1,rotating:!1,dragStartX:0,dragStartY:0,currentBox:null,currentHandle:null,resizeHandles:["nw","ne","sw","se","n","s","e","w"],editMode:"select",showLabels:!0,showDimensions:!0,selectionBox:null,history:[],historyIndex:-1,maxHistory:50}},computed:{availableBoxes(){return this.localBoxes.filter(t=>t.emplacement_id===this.emplacementId)},canUndo(){return this.historyIndex>0},canRedo(){return this.historyIndex<this.history.length-1}},mounted(){this.initializeBoxes(),this.saveState(),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown)},beforeUnmount(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown)},methods:{initializeBoxes(){this.localBoxes=this.boxes.map(t=>({...t,plan_x:t.plan_x||100,plan_y:t.plan_y||100,plan_width:t.plan_width||100,plan_height:t.plan_height||80,rotation:t.rotation||0}))},handleBackgroundUpload(t){const e=t.target.files[0];if(e){const n=new FileReader;n.onload=o=>{this.backgroundImage=o.target.result,this.saveState()},n.readAsDataURL(e)}},selectBox(t,e=null){if(e&&e.ctrlKey){const n=this.selectedBoxes.findIndex(o=>o.id===t.id);n>-1?this.selectedBoxes.splice(n,1):this.selectedBoxes.push(t)}else this.selectedBoxes=[t]},isSelected(t){return this.selectedBoxes.some(e=>e.id===t.id)},startDrag(t,e){this.editMode==="select"&&(this.isSelected(t)||this.selectBox(t,e),this.dragging=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.selectedBoxes.forEach(n=>{n.dragStartX=n.plan_x,n.dragStartY=n.plan_y}))},startResize(t,e,n){this.resizing=!0,this.currentBox=t,this.currentHandle=e,this.dragStartX=n.clientX,this.dragStartY=n.clientY,this.initialWidth=t.plan_width,this.initialHeight=t.plan_height,this.initialX=t.plan_x,this.initialY=t.plan_y},startRotate(t,e){this.rotating=!0,this.currentBox=t;const n=e.target.closest(".box-element").getBoundingClientRect();this.centerX=n.left+n.width/2,this.centerY=n.top+n.height/2},handleMouseMove(t){if(this.dragging&&this.selectedBoxes.length>0){const e=(t.clientX-this.dragStartX)/(this.zoom/100),n=(t.clientY-this.dragStartY)/(this.zoom/100);this.selectedBoxes.forEach(o=>{let i=o.dragStartX+e,a=o.dragStartY+n;this.snapToGrid&&(i=Math.round(i/this.gridSize)*this.gridSize,a=Math.round(a/this.gridSize)*this.gridSize),o.plan_x=Math.max(0,Math.min(this.canvasWidth-o.plan_width,i)),o.plan_y=Math.max(0,Math.min(this.canvasHeight-o.plan_height,a))})}else if(this.resizing&&this.currentBox){const e=(t.clientX-this.dragStartX)/(this.zoom/100),n=(t.clientY-this.dragStartY)/(this.zoom/100);this.handleResize(e,n)}else if(this.rotating&&this.currentBox){const e=Math.atan2(t.clientY-this.centerY,t.clientX-this.centerX)*180/Math.PI;this.currentBox.rotation=Math.round((e+90)/15)*15}},handleResize(t,e){const n=this.currentBox;switch(this.currentHandle){case"se":n.plan_width=Math.max(50,this.initialWidth+t),n.plan_height=Math.max(40,this.initialHeight+e);break;case"sw":n.plan_width=Math.max(50,this.initialWidth-t),n.plan_height=Math.max(40,this.initialHeight+e),n.plan_x=this.initialX+t;break;case"ne":n.plan_width=Math.max(50,this.initialWidth+t),n.plan_height=Math.max(40,this.initialHeight-e),n.plan_y=this.initialY+e;break;case"nw":n.plan_width=Math.max(50,this.initialWidth-t),n.plan_height=Math.max(40,this.initialHeight-e),n.plan_x=this.initialX+t,n.plan_y=this.initialY+e;break;case"e":n.plan_width=Math.max(50,this.initialWidth+t);break;case"w":n.plan_width=Math.max(50,this.initialWidth-t),n.plan_x=this.initialX+t;break;case"n":n.plan_height=Math.max(40,this.initialHeight-e),n.plan_y=this.initialY+e;break;case"s":n.plan_height=Math.max(40,this.initialHeight+e);break}this.snapToGrid&&(n.plan_width=Math.round(n.plan_width/this.gridSize)*this.gridSize,n.plan_height=Math.round(n.plan_height/this.gridSize)*this.gridSize)},handleMouseUp(){(this.dragging||this.resizing||this.rotating)&&this.saveState(),this.dragging=!1,this.resizing=!1,this.rotating=!1,this.currentBox=null,this.currentHandle=null},handleCanvasClick(t){(t.target===this.$refs.canvas||t.target.tagName==="svg"||t.target.tagName==="rect")&&(this.selectedBoxes=[])},handleCanvasMouseDown(t){if(this.editMode==="select"&&t.target===this.$refs.canvas){const e=this.$refs.canvas.getBoundingClientRect(),n=(t.clientX-e.left)/(this.zoom/100),o=(t.clientY-e.top)/(this.zoom/100);this.selectionBox={x:n,y:o,width:0,height:0}}},handleWheel(t){if(t.ctrlKey){t.preventDefault();const e=t.deltaY>0?-25:25;this.zoom=Math.max(25,Math.min(300,this.zoom+e))}},handleKeyDown(t){t.ctrlKey&&t.key==="z"?(t.preventDefault(),this.undo()):t.ctrlKey&&t.key==="y"?(t.preventDefault(),this.redo()):t.key==="Delete"&&this.selectedBoxes.length>0?this.selectedBoxes.forEach(e=>this.removeFromPlan(e)):t.ctrlKey&&t.key==="d"&&this.selectedBoxes.length===1?(t.preventDefault(),this.duplicateBox(this.selectedBoxes[0])):t.ctrlKey&&t.key==="a"&&(t.preventDefault(),this.selectedBoxes=[...this.availableBoxes])},alignToGrid(t){t.plan_x=Math.round(t.plan_x/this.gridSize)*this.gridSize,t.plan_y=Math.round(t.plan_y/this.gridSize)*this.gridSize,t.plan_width=Math.round(t.plan_width/this.gridSize)*this.gridSize,t.plan_height=Math.round(t.plan_height/this.gridSize)*this.gridSize,this.saveState()},alignSelectedBoxes(t){if(this.selectedBoxes.length<2)return;const e=this.selectedBoxes.map(o=>{switch(t){case"left":return o.plan_x;case"right":return o.plan_x+o.plan_width;case"top":return o.plan_y;case"bottom":return o.plan_y+o.plan_height}}),n=t==="left"||t==="top"?Math.min(...e):Math.max(...e);this.selectedBoxes.forEach(o=>{switch(t){case"left":o.plan_x=n;break;case"right":o.plan_x=n-o.plan_width;break;case"top":o.plan_y=n;break;case"bottom":o.plan_y=n-o.plan_height;break}}),this.saveState()},distributeSelectedBoxes(t){if(this.selectedBoxes.length<3)return;const e=[...this.selectedBoxes].sort((p,y)=>t==="horizontal"?p.plan_x-y.plan_x:p.plan_y-y.plan_y),n=e[0],o=e[e.length-1],i=t==="horizontal"?o.plan_x+o.plan_width-n.plan_x:o.plan_y+o.plan_height-n.plan_y,a=e.reduce((p,y)=>p+(t==="horizontal"?y.plan_width:y.plan_height),0),l=(i-a)/(e.length-1);let u=t==="horizontal"?n.plan_x:n.plan_y;e.forEach(p=>{t==="horizontal"?(p.plan_x=u,u+=p.plan_width+l):(p.plan_y=u,u+=p.plan_height+l)}),this.saveState()},duplicateBox(t){const e={...t,plan_x:t.plan_x+20,plan_y:t.plan_y+20};this.localBoxes.push(e),this.selectedBoxes=[e],this.saveState()},removeFromPlan(t){t.plan_x=null,t.plan_y=null,this.selectedBoxes=this.selectedBoxes.filter(e=>e.id!==t.id),this.saveState()},editBoxProperties(t){this.selectBox(t)},saveState(){const t=JSON.stringify(this.localBoxes.map(e=>({id:e.id,plan_x:e.plan_x,plan_y:e.plan_y,plan_width:e.plan_width,plan_height:e.plan_height,rotation:e.rotation})));this.history=this.history.slice(0,this.historyIndex+1),this.history.push(t),this.history.length>this.maxHistory?this.history.shift():this.historyIndex++},undo(){this.canUndo&&(this.historyIndex--,this.restoreState(this.history[this.historyIndex]))},redo(){this.canRedo&&(this.historyIndex++,this.restoreState(this.history[this.historyIndex]))},restoreState(t){JSON.parse(t).forEach(n=>{const o=this.localBoxes.find(i=>i.id===n.id);o&&Object.assign(o,n)})},saveLayout(){const t=this.localBoxes.filter(e=>e.plan_x!==null&&e.plan_y!==null).map(e=>({id:e.id,plan_x:e.plan_x,plan_y:e.plan_y,plan_width:e.plan_width,plan_height:e.plan_height}));this.$emit("save",{emplacement_id:this.emplacementId,background_image:this.backgroundImage,canvas_width:this.canvasWidth,canvas_height:this.canvasHeight,boxes:t})},resetLayout(){confirm("Êtes-vous sûr de vouloir réinitialiser le plan ?")&&(this.localBoxes.forEach(t=>{t.plan_x=null,t.plan_y=null,t.rotation=0}),this.backgroundImage=null,this.selectedBoxes=[],this.saveState())}}},U={class:"plan-editor-container"},L={class:"toolbar card mb-3"},R={class:"card-body"},P={class:"row align-items-center mb-2"},H={class:"col-md-3"},V={class:"col-md-2"},W={class:"d-flex align-items-center gap-2"},Y={class:"badge bg-secondary"},G={class:"col-md-2"},A={class:"input-group input-group-sm"},X={class:"form-check form-switch me-2"},T=["disabled"],N={class:"col-md-2"},K={class:"form-check form-switch"},q={class:"col-md-3 text-end"},O={class:"btn-group btn-group-sm me-2",role:"group"},F=["disabled"],j=["disabled"],J={class:"row"},Z={class:"col-md-12"},Q={class:"d-flex gap-2 align-items-center"},$={class:"btn-group btn-group-sm",role:"group"},ee={class:"form-check form-check-inline"},se={class:"form-check form-check-inline"},te={class:"ms-3 small"},le={key:0},ie={key:1},ne={key:2},ae={class:"row"},oe={class:"col-md-9"},re={class:"editor-workspace card"},de={class:"card-body p-2"},ce=["width","height"],ue=["width","height"],me=["d"],he=["onMousedown","onClick","onDblclick"],pe={key:0,class:"box-label"},ge={key:1,class:"box-dimensions"},fe={class:"box-status-icon"},ve={key:0,class:"fas fa-check-circle text-success"},be={key:1,class:"fas fa-lock text-danger"},ye={key:2,class:"fas fa-clock text-warning"},xe={key:3,class:"fas fa-wrench text-info"},_e=["onMousedown"],ke=["onMousedown"],we={key:0,class:"minimap card mt-2"},Be={class:"card-body p-2"},Se={class:"col-md-3"},ze={key:0,class:"card mb-3"},Me={class:"card-body"},Ce={class:"mb-2"},Ie=["value"],Ee={class:"row"},De={class:"col-6 mb-2"},Ue={class:"col-6 mb-2"},Le={class:"row"},Re={class:"col-6 mb-2"},Pe={class:"col-6 mb-2"},He={class:"mb-2"},Ve={class:"mb-2"},We={class:"mb-2"},Ye={class:"text-muted"},Ge={class:"d-grid gap-2"},Ae={key:1,class:"card mb-3"},Xe={class:"card-header bg-primary text-white py-2"},Te={class:"mb-0"},Ne={class:"card-body"},Ke={class:"d-grid gap-2"},qe={class:"card"},Oe={class:"card-body p-0",style:{"max-height":"400px","overflow-y":"auto"}},Fe={class:"list-group list-group-flush"},je=["onClick"],Je={class:"d-flex justify-content-between align-items-center"},Ze={class:"text-end"},Qe={class:"text-muted d-block"},$e={class:"text-muted"},es={key:0,class:"text-muted"};function ss(t,e,n,o,i,a){return r(),d("div",U,[s("div",L,[s("div",R,[s("div",P,[s("div",H,[e[35]||(e[35]=s("label",{class:"form-label small mb-1"},[s("i",{class:"fas fa-image me-1"}),c("Image de fond (Plan) ")],-1)),s("input",{type:"file",onChange:e[0]||(e[0]=(...l)=>a.handleBackgroundUpload&&a.handleBackgroundUpload(...l)),accept:"image/*",class:"form-control form-control-sm"},null,32)]),s("div",V,[e[36]||(e[36]=s("label",{class:"form-label small mb-1"},[s("i",{class:"fas fa-search me-1"}),c("Zoom ")],-1)),s("div",W,[h(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>i.zoom=l),type:"range",min:"25",max:"300",step:"25",class:"form-range"},null,512),[[f,i.zoom,void 0,{number:!0}]]),s("span",Y,m(i.zoom)+"%",1)])]),s("div",G,[e[38]||(e[38]=s("label",{class:"form-label small mb-1"},[s("i",{class:"fas fa-th me-1"}),c("Grille ")],-1)),s("div",A,[s("div",X,[h(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>i.showGrid=l),type:"checkbox",class:"form-check-input",id:"showGrid"},null,512),[[w,i.showGrid]])]),h(s("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>i.gridSize=l),type:"number",min:"10",max:"100",step:"10",class:"form-control",disabled:!i.showGrid},null,8,T),[[f,i.gridSize,void 0,{number:!0}]]),e[37]||(e[37]=s("span",{class:"input-group-text"},"px",-1))])]),s("div",N,[e[40]||(e[40]=s("label",{class:"form-label small mb-1"},[s("i",{class:"fas fa-magnet me-1"}),c("Magnétisme ")],-1)),s("div",K,[h(s("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>i.snapToGrid=l),type:"checkbox",class:"form-check-input",id:"snapToGrid"},null,512),[[w,i.snapToGrid]]),e[39]||(e[39]=s("label",{class:"form-check-label",for:"snapToGrid"}," Aimanter à la grille ",-1))])]),s("div",q,[s("div",O,[s("button",{onClick:e[5]||(e[5]=(...l)=>a.undo&&a.undo(...l)),disabled:!a.canUndo,class:"btn btn-outline-secondary",title:"Annuler (Ctrl+Z)"},[...e[41]||(e[41]=[s("i",{class:"fas fa-undo"},null,-1)])],8,F),s("button",{onClick:e[6]||(e[6]=(...l)=>a.redo&&a.redo(...l)),disabled:!a.canRedo,class:"btn btn-outline-secondary",title:"Rétablir (Ctrl+Y)"},[...e[42]||(e[42]=[s("i",{class:"fas fa-redo"},null,-1)])],8,j)]),s("button",{onClick:e[7]||(e[7]=(...l)=>a.saveLayout&&a.saveLayout(...l)),class:"btn btn-success btn-sm me-2"},[...e[43]||(e[43]=[s("i",{class:"fas fa-save me-1"},null,-1),c("Enregistrer ",-1)])]),s("button",{onClick:e[8]||(e[8]=(...l)=>a.resetLayout&&a.resetLayout(...l)),class:"btn btn-danger btn-sm"},[...e[44]||(e[44]=[s("i",{class:"fas fa-trash me-1"},null,-1),c("Réinitialiser ",-1)])])])]),s("div",J,[s("div",Z,[s("div",Q,[e[50]||(e[50]=s("span",{class:"small text-muted"},"Mode:",-1)),s("div",$,[h(s("input",{type:"radio",class:"btn-check",id:"modeSelect","onUpdate:modelValue":e[9]||(e[9]=l=>i.editMode=l),value:"select",autocomplete:"off"},null,512),[[B,i.editMode]]),e[45]||(e[45]=s("label",{class:"btn btn-outline-primary",for:"modeSelect"},[s("i",{class:"fas fa-mouse-pointer"}),c(" Sélection ")],-1)),h(s("input",{type:"radio",class:"btn-check",id:"modePan","onUpdate:modelValue":e[10]||(e[10]=l=>i.editMode=l),value:"pan",autocomplete:"off"},null,512),[[B,i.editMode]]),e[46]||(e[46]=s("label",{class:"btn btn-outline-primary",for:"modePan"},[s("i",{class:"fas fa-hand-paper"}),c(" Déplacer ")],-1))]),e[51]||(e[51]=s("span",{class:"ms-3 small text-muted"},"Affichage:",-1)),s("div",ee,[h(s("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>i.showLabels=l),class:"form-check-input",type:"checkbox",id:"showLabels"},null,512),[[w,i.showLabels]]),e[47]||(e[47]=s("label",{class:"form-check-label small",for:"showLabels"},[s("i",{class:"fas fa-tag"}),c(" Étiquettes ")],-1))]),s("div",se,[h(s("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>i.showDimensions=l),class:"form-check-input",type:"checkbox",id:"showDimensions"},null,512),[[w,i.showDimensions]]),e[48]||(e[48]=s("label",{class:"form-check-label small",for:"showDimensions"},[s("i",{class:"fas fa-ruler-combined"}),c(" Dimensions ")],-1))]),s("span",te,[e[49]||(e[49]=s("i",{class:"fas fa-info-circle text-info me-1"},null,-1)),i.selectedBoxes.length===0?(r(),d("span",le,"Aucune sélection")):i.selectedBoxes.length===1?(r(),d("span",ie,"1 box sélectionnée")):(r(),d("span",ne,m(i.selectedBoxes.length)+" boxes sélectionnées",1))])])])])])]),s("div",ae,[s("div",oe,[s("div",re,[s("div",de,[s("div",{class:"canvas-wrapper",onWheel:e[15]||(e[15]=(...l)=>a.handleWheel&&a.handleWheel(...l))},[s("div",{ref:"canvas",class:"canvas",style:x({backgroundImage:i.backgroundImage?`url(${i.backgroundImage})`:"none",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",width:i.canvasWidth+"px",height:i.canvasHeight+"px",transform:`scale(${i.zoom/100})`,transformOrigin:"top left",cursor:i.editMode==="pan"?"grab":"default"}),onMousedown:e[13]||(e[13]=(...l)=>a.handleCanvasMouseDown&&a.handleCanvasMouseDown(...l)),onClick:e[14]||(e[14]=(...l)=>a.handleCanvasClick&&a.handleCanvasClick(...l))},[i.showGrid?(r(),d("svg",{key:0,class:"grid-overlay",width:i.canvasWidth,height:i.canvasHeight},[s("defs",null,[s("pattern",{id:"grid",width:i.gridSize,height:i.gridSize,patternUnits:"userSpaceOnUse"},[s("path",{d:`M ${i.gridSize} 0 L 0 0 0 ${i.gridSize}`,fill:"none",stroke:"#dee2e6","stroke-width":"1"},null,8,me)],8,ue)]),e[52]||(e[52]=s("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1))],8,ce)):g("",!0),i.selectionBox?(r(),d("div",{key:1,class:"selection-box",style:x({left:i.selectionBox.x+"px",top:i.selectionBox.y+"px",width:i.selectionBox.width+"px",height:i.selectionBox.height+"px"})},null,4)):g("",!0),(r(!0),d(b,null,k(i.localBoxes,l=>(r(),d("div",{key:l.id,class:v(["box-element",{selected:a.isSelected(l),libre:l.statut==="libre",occupe:l.statut==="occupe",reserve:l.statut==="reserve",maintenance:l.statut==="maintenance"}]),style:x({left:l.plan_x+"px",top:l.plan_y+"px",width:l.plan_width+"px",height:l.plan_height+"px",transform:l.rotation?`rotate(${l.rotation}deg)`:"none"}),onMousedown:_(u=>a.startDrag(l,u),["stop"]),onClick:_(u=>a.selectBox(l,u),["stop"]),onDblclick:_(u=>a.editBoxProperties(l),["stop"])},[i.showLabels?(r(),d("div",pe,[s("strong",null,m(l.numero),1)])):g("",!0),i.showDimensions?(r(),d("div",ge,[s("small",null,m(l.surface)+"m² - "+m(l.prix_mensuel)+"€",1)])):g("",!0),s("div",fe,[l.statut==="libre"?(r(),d("i",ve)):l.statut==="occupe"?(r(),d("i",be)):l.statut==="reserve"?(r(),d("i",ye)):l.statut==="maintenance"?(r(),d("i",xe)):g("",!0)]),a.isSelected(l)?(r(),d(b,{key:2},[(r(!0),d(b,null,k(i.resizeHandles,u=>(r(),d("div",{key:u,class:v(`resize-handle ${u}`),onMousedown:_(p=>a.startResize(l,u,p),["stop"])},null,42,_e))),128)),s("div",{class:"rotate-handle",onMousedown:_(u=>a.startRotate(l,u),["stop"]),title:"Rotation"},[...e[53]||(e[53]=[s("i",{class:"fas fa-sync-alt"},null,-1)])],40,ke)],64)):g("",!0)],46,he))),128))],36)],32)])]),i.backgroundImage?(r(),d("div",we,[s("div",Be,[s("div",{class:"minimap-canvas",style:x({backgroundImage:`url(${i.backgroundImage})`})},[(r(!0),d(b,null,k(i.localBoxes,l=>(r(),d("div",{key:"mini-"+l.id,class:v(["minimap-box",l.statut]),style:x({left:l.plan_x/i.canvasWidth*100+"%",top:l.plan_y/i.canvasHeight*100+"%",width:l.plan_width/i.canvasWidth*100+"%",height:l.plan_height/i.canvasHeight*100+"%"})},null,6))),128))],4)])])):g("",!0)]),s("div",Se,[i.selectedBoxes.length===1?(r(),d("div",ze,[e[66]||(e[66]=s("div",{class:"card-header bg-primary text-white py-2"},[s("h6",{class:"mb-0"},[s("i",{class:"fas fa-cog me-1"}),c("Propriétés ")])],-1)),s("div",Me,[s("div",Ce,[e[54]||(e[54]=s("label",{class:"form-label small mb-1"},"Box",-1)),s("input",{type:"text",class:"form-control form-control-sm",value:i.selectedBoxes[0].numero,disabled:""},null,8,Ie)]),s("div",Ee,[s("div",De,[e[55]||(e[55]=s("label",{class:"form-label small mb-1"},"X (px)",-1)),h(s("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>i.selectedBoxes[0].plan_x=l),type:"number",class:"form-control form-control-sm",onChange:e[17]||(e[17]=(...l)=>a.saveState&&a.saveState(...l))},null,544),[[f,i.selectedBoxes[0].plan_x,void 0,{number:!0}]])]),s("div",Ue,[e[56]||(e[56]=s("label",{class:"form-label small mb-1"},"Y (px)",-1)),h(s("input",{"onUpdate:modelValue":e[18]||(e[18]=l=>i.selectedBoxes[0].plan_y=l),type:"number",class:"form-control form-control-sm",onChange:e[19]||(e[19]=(...l)=>a.saveState&&a.saveState(...l))},null,544),[[f,i.selectedBoxes[0].plan_y,void 0,{number:!0}]])])]),s("div",Le,[s("div",Re,[e[57]||(e[57]=s("label",{class:"form-label small mb-1"},"Largeur",-1)),h(s("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>i.selectedBoxes[0].plan_width=l),type:"number",class:"form-control form-control-sm",min:"50",onChange:e[21]||(e[21]=(...l)=>a.saveState&&a.saveState(...l))},null,544),[[f,i.selectedBoxes[0].plan_width,void 0,{number:!0}]])]),s("div",Pe,[e[58]||(e[58]=s("label",{class:"form-label small mb-1"},"Hauteur",-1)),h(s("input",{"onUpdate:modelValue":e[22]||(e[22]=l=>i.selectedBoxes[0].plan_height=l),type:"number",class:"form-control form-control-sm",min:"40",onChange:e[23]||(e[23]=(...l)=>a.saveState&&a.saveState(...l))},null,544),[[f,i.selectedBoxes[0].plan_height,void 0,{number:!0}]])])]),s("div",He,[e[59]||(e[59]=s("label",{class:"form-label small mb-1"},"Rotation (°)",-1)),h(s("input",{"onUpdate:modelValue":e[24]||(e[24]=l=>i.selectedBoxes[0].rotation=l),type:"number",class:"form-control form-control-sm",min:"0",max:"360",step:"15",onChange:e[25]||(e[25]=(...l)=>a.saveState&&a.saveState(...l))},null,544),[[f,i.selectedBoxes[0].rotation,void 0,{number:!0}]])]),s("div",Ve,[e[60]||(e[60]=s("label",{class:"form-label small mb-1"},"Statut",-1)),s("div",{class:v(["badge w-100",{"bg-success":i.selectedBoxes[0].statut==="libre","bg-danger":i.selectedBoxes[0].statut==="occupe","bg-warning":i.selectedBoxes[0].statut==="reserve","bg-info":i.selectedBoxes[0].statut==="maintenance"}])},m(i.selectedBoxes[0].statut),3)]),s("div",We,[s("small",Ye,[c(" Surface: "+m(i.selectedBoxes[0].surface)+"m²",1),e[61]||(e[61]=s("br",null,null,-1)),c(" Prix: "+m(i.selectedBoxes[0].prix_mensuel)+"€/mois ",1)])]),e[65]||(e[65]=s("hr",null,null,-1)),s("div",Ge,[s("button",{onClick:e[26]||(e[26]=l=>a.alignToGrid(i.selectedBoxes[0])),class:"btn btn-sm btn-outline-primary"},[...e[62]||(e[62]=[s("i",{class:"fas fa-border-all me-1"},null,-1),c("Aligner sur grille ",-1)])]),s("button",{onClick:e[27]||(e[27]=l=>a.duplicateBox(i.selectedBoxes[0])),class:"btn btn-sm btn-outline-secondary"},[...e[63]||(e[63]=[s("i",{class:"fas fa-copy me-1"},null,-1),c("Dupliquer ",-1)])]),s("button",{onClick:e[28]||(e[28]=l=>a.removeFromPlan(i.selectedBoxes[0])),class:"btn btn-sm btn-outline-danger"},[...e[64]||(e[64]=[s("i",{class:"fas fa-times me-1"},null,-1),c("Retirer du plan ",-1)])])])])])):i.selectedBoxes.length>1?(r(),d("div",Ae,[s("div",Xe,[s("h6",Te,[e[67]||(e[67]=s("i",{class:"fas fa-layer-group me-1"},null,-1)),c("Sélection multiple ("+m(i.selectedBoxes.length)+") ",1)])]),s("div",Ne,[s("div",Ke,[s("button",{onClick:e[29]||(e[29]=l=>a.alignSelectedBoxes("left")),class:"btn btn-sm btn-outline-primary"},[...e[68]||(e[68]=[s("i",{class:"fas fa-align-left me-1"},null,-1),c("Aligner à gauche ",-1)])]),s("button",{onClick:e[30]||(e[30]=l=>a.alignSelectedBoxes("right")),class:"btn btn-sm btn-outline-primary"},[...e[69]||(e[69]=[s("i",{class:"fas fa-align-right me-1"},null,-1),c("Aligner à droite ",-1)])]),s("button",{onClick:e[31]||(e[31]=l=>a.alignSelectedBoxes("top")),class:"btn btn-sm btn-outline-primary"},[...e[70]||(e[70]=[s("i",{class:"fas fa-align-left me-1",style:{transform:"rotate(90deg)"}},null,-1),c("Aligner en haut ",-1)])]),s("button",{onClick:e[32]||(e[32]=l=>a.alignSelectedBoxes("bottom")),class:"btn btn-sm btn-outline-primary"},[...e[71]||(e[71]=[s("i",{class:"fas fa-align-right me-1",style:{transform:"rotate(90deg)"}},null,-1),c("Aligner en bas ",-1)])]),s("button",{onClick:e[33]||(e[33]=l=>a.distributeSelectedBoxes("horizontal")),class:"btn btn-sm btn-outline-secondary"},[...e[72]||(e[72]=[s("i",{class:"fas fa-arrows-alt-h me-1"},null,-1),c("Distribuer horizontalement ",-1)])]),s("button",{onClick:e[34]||(e[34]=l=>a.distributeSelectedBoxes("vertical")),class:"btn btn-sm btn-outline-secondary"},[...e[73]||(e[73]=[s("i",{class:"fas fa-arrows-alt-v me-1"},null,-1),c("Distribuer verticalement ",-1)])])])])])):g("",!0),s("div",qe,[e[75]||(e[75]=s("div",{class:"card-header bg-secondary text-white py-2"},[s("h6",{class:"mb-0"},[s("i",{class:"fas fa-box me-1"}),c("Boxes disponibles ")])],-1)),s("div",Oe,[s("div",Fe,[(r(!0),d(b,null,k(a.availableBoxes,l=>(r(),d("div",{key:"available-"+l.id,class:v(["list-group-item list-group-item-action p-2",{active:a.isSelected(l)}]),onClick:u=>a.selectBox(l),style:{cursor:"pointer"}},[s("div",Je,[s("div",null,[s("strong",null,m(l.numero),1),s("span",{class:v(["badge ms-2",{"bg-success":l.statut==="libre","bg-danger":l.statut==="occupe","bg-warning":l.statut==="reserve"}])},m(l.statut),3)]),s("div",Ze,[s("small",Qe,m(l.surface)+"m²",1),s("small",$e,m(l.prix_mensuel)+"€",1)])]),l.emplacement?(r(),d("small",es,[e[74]||(e[74]=s("i",{class:"fas fa-map-marker-alt me-1"},null,-1)),c(m(l.emplacement.nom),1)])):g("",!0)],10,je))),128))])])]),e[76]||(e[76]=z('<div class="card mt-3" data-v-b730e08f><div class="card-header py-2" data-v-b730e08f><h6 class="mb-0" data-v-b730e08f><i class="fas fa-info-circle me-1" data-v-b730e08f></i>Légende </h6></div><div class="card-body p-2" data-v-b730e08f><div class="d-flex align-items-center mb-1" data-v-b730e08f><div class="legend-color bg-success" data-v-b730e08f></div><small data-v-b730e08f>Libre</small></div><div class="d-flex align-items-center mb-1" data-v-b730e08f><div class="legend-color bg-danger" data-v-b730e08f></div><small data-v-b730e08f>Occupé</small></div><div class="d-flex align-items-center mb-1" data-v-b730e08f><div class="legend-color bg-warning" data-v-b730e08f></div><small data-v-b730e08f>Réservé</small></div><div class="d-flex align-items-center mb-1" data-v-b730e08f><div class="legend-color bg-info" data-v-b730e08f></div><small data-v-b730e08f>Maintenance</small></div><hr class="my-2" data-v-b730e08f><small class="text-muted" data-v-b730e08f><i class="fas fa-keyboard me-1" data-v-b730e08f></i><strong data-v-b730e08f>Raccourcis:</strong><br data-v-b730e08f> Ctrl+Z: Annuler<br data-v-b730e08f> Ctrl+Y: Rétablir<br data-v-b730e08f> Suppr: Retirer du plan<br data-v-b730e08f> Ctrl+D: Dupliquer<br data-v-b730e08f> Ctrl+A: Tout sélectionner </small></div></div>',1))])])])}const ts=S(D,[["render",ss],["__scopeId","data-v-b730e08f"]]),ls={components:{PlanEditor:ts},props:{boxes:{type:Array,required:!0},emplacements:{type:Array,required:!0},planLayouts:{type:Object,default:()=>({})}},data(){return{selectedEmplacementId:this.emplacements[0]?.id||null,currentBackgroundImage:null,showSuccess:!1}},mounted(){this.selectedEmplacementId&&this.loadEmplacementPlan()},methods:{loadEmplacementPlan(){const t=this.planLayouts[this.selectedEmplacementId];this.currentBackgroundImage=t?.background_image||null},savePlan(t){E.post(route("boxes.plan.save"),t,{onSuccess:()=>{this.showSuccess=!0,setTimeout(()=>{this.showSuccess=!1},3e3)},onError:e=>{alert("Erreur lors de la sauvegarde: "+JSON.stringify(e))}})}}},is={class:"container-fluid py-4"},ns={class:"mb-4"},as={class:"d-flex justify-content-between align-items-center"},os=["href"],rs={class:"card mb-4"},ds={class:"card-body"},cs={class:"row align-items-center"},us={class:"col-md-4"},ms=["value"],hs={key:1,class:"alert alert-success alert-dismissible fade show mt-3",role:"alert"};function ps(t,e,n,o,i,a){const l=M("PlanEditor",!0);return r(),d("div",is,[s("div",ns,[s("div",as,[e[4]||(e[4]=s("div",null,[s("h1",{class:"h3 mb-1"},"Éditeur de Plan"),s("p",{class:"text-muted"},"Créez et personnalisez le plan de vos emplacements")],-1)),s("div",null,[s("a",{href:t.route("boxes.plan"),class:"btn btn-outline-secondary"},[...e[3]||(e[3]=[s("i",{class:"fas fa-arrow-left me-1"},null,-1),c("Retour au plan ",-1)])],8,os)])])]),s("div",rs,[s("div",ds,[s("div",cs,[s("div",us,[e[5]||(e[5]=s("label",{class:"form-label"},"Emplacement à éditer",-1)),h(s("select",{"onUpdate:modelValue":e[0]||(e[0]=u=>i.selectedEmplacementId=u),class:"form-select",onChange:e[1]||(e[1]=(...u)=>a.loadEmplacementPlan&&a.loadEmplacementPlan(...u))},[(r(!0),d(b,null,k(n.emplacements,u=>(r(),d("option",{key:u.id,value:u.id},m(u.nom),9,ms))),128))],544),[[I,i.selectedEmplacementId]])]),e[6]||(e[6]=s("div",{class:"col-md-8"},[s("div",{class:"alert alert-info mb-0"},[s("i",{class:"fas fa-info-circle me-2"}),s("strong",null,"Instructions:"),s("ul",{class:"mb-0 mt-2 small"},[s("li",null,"Uploadez une image de fond (plan de la salle)"),s("li",null,"Glissez-déposez les boxes sur le plan"),s("li",null,"Redimensionnez-les en tirant sur les coins"),s("li",null,'Cliquez sur "Enregistrer" pour sauvegarder')])])],-1))])])]),i.selectedEmplacementId?(r(),C(l,{key:0,boxes:n.boxes,"emplacement-id":i.selectedEmplacementId,"initial-background-image":i.currentBackgroundImage,onSave:a.savePlan},null,8,["boxes","emplacement-id","initial-background-image","onSave"])):g("",!0),i.showSuccess?(r(),d("div",hs,[e[7]||(e[7]=s("i",{class:"fas fa-check-circle me-2"},null,-1)),e[8]||(e[8]=c(" Le plan a été enregistré avec succès ! ",-1)),s("button",{type:"button",class:"btn-close",onClick:e[2]||(e[2]=u=>i.showSuccess=!1)})])):g("",!0)])}const vs=S(ls,[["render",ps]]);export{vs as default};
