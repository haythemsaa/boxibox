import{_ as g}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as d,a as e,i as c,t as n,F as b,j as p,n as f,d as a,m as x}from"./app-zGlaTtug.js";const y={props:{boxes:{type:Array,required:!0},emplacements:{type:Array,default:()=>[]},canCreateContract:{type:Boolean,default:!1},canViewContract:{type:Boolean,default:!0},isAdmin:{type:Boolean,default:!1}},data(){return{selectedEmplacement:null,selectedBox:null,tooltip:{show:!1,box:null,x:0,y:0}}},computed:{filteredBoxes(){return this.selectedEmplacement?this.boxes.filter(s=>s.emplacement_id===this.selectedEmplacement.id):this.boxes},gridCols(){if(this.filteredBoxes.length===0)return 5;const s=Math.max(...this.filteredBoxes.map(t=>t.coordonnees_x||0));return Math.max(5,s+1)},gridRows(){if(this.filteredBoxes.length===0)return 5;const s=Math.max(...this.filteredBoxes.map(t=>t.coordonnees_y||0));return Math.max(5,s+1)},stats(){const s=this.filteredBoxes;return{libres:s.filter(t=>t.statut==="libre").length,occupes:s.filter(t=>t.statut==="occupe").length,reserves:s.filter(t=>t.statut==="reserve").length,maintenance:s.filter(t=>t.statut==="maintenance").length}}},mounted(){this.emplacements.length>0&&(this.selectedEmplacement=this.emplacements[0])},methods:{selectEmplacement(s){this.selectedEmplacement=s},getEmplacementBoxCount(s){return this.boxes.filter(t=>t.emplacement_id===s).length},getBoxClass(s){return{libre:"box-libre",occupe:"box-occupe",reserve:"box-reserve",maintenance:"box-maintenance"}[s.statut]||"box-default"},getBoxStyle(s){return s.coordonnees_x!==null&&s.coordonnees_y!==null?{gridColumn:s.coordonnees_x+1,gridRow:s.coordonnees_y+1}:{}},handleBoxClick(s){this.selectedBox=s,this.hideTooltip()},closeModal(){this.selectedBox=null},showTooltip(s,t){const u=t.target.getBoundingClientRect();this.tooltip={show:!0,box:s,x:u.left+u.width/2,y:u.top-10}},hideTooltip(){this.tooltip.show=!1},formatCurrency(s){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s||0)},formatDate(s){return s?new Date(s).toLocaleDateString("fr-FR"):""},getStatutLabel(s){return{libre:"Libre",occupe:"Occupé",reserve:"Réservé",maintenance:"Maintenance"}[s]||s},getContractUrl(s){return this.isAdmin?route("contrats.show",s):route("client.contrats.show",s)},getNewContractUrl(s){return route("contrats.create",{box_id:s})}}},B={class:"box-plan-container"},v={class:"legend mb-4"},_={class:"d-flex flex-wrap gap-3 justify-content-center"},h={class:"legend-item"},C={class:"legend-item"},k={class:"legend-item"},w={class:"legend-item"},M={key:0,class:"mb-4"},E={class:"btn-group w-100",role:"group"},D=["onClick"],N={class:"badge bg-light text-dark ms-2"},R={class:"plan-grid-wrapper",ref:"planWrapper"},S=["onClick","onMouseenter"],T={class:"box-number"},A={class:"box-surface"},F={class:"tooltip-body"},V={key:0},L={class:"text-danger"},U={class:"small"},O={key:2,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},z={class:"modal-dialog modal-dialog-centered"},I={class:"modal-content"},P={class:"modal-header bg-danger text-white"},j={class:"modal-title"},q={class:"modal-body"},G={key:0},W={class:"table table-borderless table-sm"},X={key:1,class:"alert alert-warning"},Y={class:"modal-footer"},H=["href"],J={key:3,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},K={class:"modal-dialog modal-dialog-centered"},Q={class:"modal-content"},Z={class:"modal-header bg-success text-white"},$={class:"modal-title"},ee={class:"modal-body"},te={class:"table table-borderless table-sm"},le={key:0},se={class:"text-success"},oe={key:1},ne={class:"modal-footer"},re=["href"];function ie(s,t,u,de,l,o){return d(),i("div",B,[e("div",v,[e("div",_,[e("div",h,[t[5]||(t[5]=e("span",{class:"legend-box bg-success"},null,-1)),e("span",null,"Libre ("+n(o.stats.libres)+")",1)]),e("div",C,[t[6]||(t[6]=e("span",{class:"legend-box bg-danger"},null,-1)),e("span",null,"Occupé ("+n(o.stats.occupes)+")",1)]),e("div",k,[t[7]||(t[7]=e("span",{class:"legend-box bg-warning"},null,-1)),e("span",null,"Réservé ("+n(o.stats.reserves)+")",1)]),e("div",w,[t[8]||(t[8]=e("span",{class:"legend-box bg-secondary"},null,-1)),e("span",null,"Maintenance ("+n(o.stats.maintenance)+")",1)])])]),u.emplacements.length>1?(d(),i("div",M,[e("div",E,[(d(!0),i(b,null,p(u.emplacements,r=>(d(),i("button",{key:r.id,type:"button",class:f(["btn",l.selectedEmplacement?.id===r.id?"btn-primary":"btn-outline-primary"]),onClick:m=>o.selectEmplacement(r)},[a(n(r.nom)+" ",1),e("span",N,n(o.getEmplacementBoxCount(r.id)),1)],10,D))),128))])])):c("",!0),e("div",R,[e("div",{class:"plan-grid",style:x({gridTemplateColumns:`repeat(${o.gridCols}, 1fr)`,gridTemplateRows:`repeat(${o.gridRows}, 1fr)`})},[(d(!0),i(b,null,p(o.filteredBoxes,r=>(d(),i("div",{key:r.id,class:f(["box-cell",o.getBoxClass(r)]),style:x(o.getBoxStyle(r)),onClick:m=>o.handleBoxClick(r),onMouseenter:m=>o.showTooltip(r,m),onMouseleave:t[0]||(t[0]=(...m)=>o.hideTooltip&&o.hideTooltip(...m))},[e("div",T,n(r.numero),1),e("div",A,n(r.surface)+"m²",1)],46,S))),128))],4)],512),l.tooltip.show?(d(),i("div",{key:1,class:"box-tooltip",style:x({top:l.tooltip.y+"px",left:l.tooltip.x+"px"})},[e("div",{class:f(["tooltip-header",o.getBoxClass(l.tooltip.box)])},[e("strong",null,"Box "+n(l.tooltip.box.numero),1)],2),e("div",F,[e("div",null,[t[9]||(t[9]=e("strong",null,"Surface:",-1)),a(" "+n(l.tooltip.box.surface)+" m²",1)]),l.tooltip.box.volume?(d(),i("div",V,[t[10]||(t[10]=e("strong",null,"Volume:",-1)),a(" "+n(l.tooltip.box.volume)+" m³",1)])):c("",!0),e("div",null,[t[11]||(t[11]=e("strong",null,"Prix:",-1)),a(" "+n(o.formatCurrency(l.tooltip.box.prix_mensuel))+"/mois",1)]),e("div",null,[t[12]||(t[12]=e("strong",null,"Famille:",-1)),a(" "+n(l.tooltip.box.famille?.nom||"N/A"),1)]),e("div",null,[t[13]||(t[13]=e("strong",null,"Statut:",-1)),a(" "+n(o.getStatutLabel(l.tooltip.box.statut)),1)]),l.tooltip.box.statut==="occupe"&&l.tooltip.box.contrat_actif?(d(),i(b,{key:1},[t[17]||(t[17]=e("hr",{class:"my-2"},null,-1)),e("div",L,[t[14]||(t[14]=e("strong",null,"Occupé par:",-1)),t[15]||(t[15]=e("br",null,null,-1)),a(" "+n(l.tooltip.box.contrat_actif.client?.prenom)+" "+n(l.tooltip.box.contrat_actif.client?.nom),1)]),e("div",U,[a(" Contrat: "+n(l.tooltip.box.contrat_actif.numero_contrat),1),t[16]||(t[16]=e("br",null,null,-1)),a(" Depuis: "+n(o.formatDate(l.tooltip.box.contrat_actif.date_debut)),1)])],64)):l.tooltip.box.statut==="libre"&&u.canCreateContract?(d(),i(b,{key:2},[t[18]||(t[18]=e("hr",{class:"my-2"},null,-1)),t[19]||(t[19]=e("div",{class:"text-success small"},[e("i",{class:"fas fa-hand-pointer me-1"}),a(" Cliquez pour créer un contrat ")],-1))],64)):c("",!0)])],4)):c("",!0),l.selectedBox&&l.selectedBox.statut==="occupe"?(d(),i("div",O,[e("div",z,[e("div",I,[e("div",P,[e("h5",j,[t[20]||(t[20]=e("i",{class:"fas fa-box me-2"},null,-1)),a("Box "+n(l.selectedBox.numero)+" - Occupé ",1)]),e("button",{type:"button",class:"btn-close btn-close-white",onClick:t[1]||(t[1]=(...r)=>o.closeModal&&o.closeModal(...r))})]),e("div",q,[l.selectedBox.contrat_actif?(d(),i("div",G,[t[28]||(t[28]=e("h6",null,"Informations du contrat",-1)),e("table",W,[e("tbody",null,[e("tr",null,[t[21]||(t[21]=e("th",null,"N° Contrat:",-1)),e("td",null,n(l.selectedBox.contrat_actif.numero_contrat),1)]),e("tr",null,[t[22]||(t[22]=e("th",null,"Client:",-1)),e("td",null,n(l.selectedBox.contrat_actif.client?.prenom)+" "+n(l.selectedBox.contrat_actif.client?.nom),1)]),e("tr",null,[t[23]||(t[23]=e("th",null,"Email:",-1)),e("td",null,n(l.selectedBox.contrat_actif.client?.email),1)]),e("tr",null,[t[24]||(t[24]=e("th",null,"Téléphone:",-1)),e("td",null,n(l.selectedBox.contrat_actif.client?.telephone||"N/A"),1)]),e("tr",null,[t[25]||(t[25]=e("th",null,"Date début:",-1)),e("td",null,n(o.formatDate(l.selectedBox.contrat_actif.date_debut)),1)]),e("tr",null,[t[26]||(t[26]=e("th",null,"Date fin:",-1)),e("td",null,n(l.selectedBox.contrat_actif.date_fin?o.formatDate(l.selectedBox.contrat_actif.date_fin):"Indéterminée"),1)]),e("tr",null,[t[27]||(t[27]=e("th",null,"Loyer:",-1)),e("td",null,n(o.formatCurrency(l.selectedBox.contrat_actif.montant_loyer))+"/mois",1)])])])])):(d(),i("div",X," Aucune information de contrat disponible "))]),e("div",Y,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=(...r)=>o.closeModal&&o.closeModal(...r))},"Fermer"),l.selectedBox.contrat_actif&&u.canViewContract?(d(),i("a",{key:0,href:o.getContractUrl(l.selectedBox.contrat_actif.id),class:"btn btn-primary"},[...t[29]||(t[29]=[e("i",{class:"fas fa-eye me-1"},null,-1),a("Voir le contrat ",-1)])],8,H)):c("",!0)])])])])):c("",!0),l.selectedBox&&l.selectedBox.statut==="libre"&&u.canCreateContract?(d(),i("div",J,[e("div",K,[e("div",Q,[e("div",Z,[e("h5",$,[t[30]||(t[30]=e("i",{class:"fas fa-box me-2"},null,-1)),a("Box "+n(l.selectedBox.numero)+" - Disponible ",1)]),e("button",{type:"button",class:"btn-close btn-close-white",onClick:t[3]||(t[3]=(...r)=>o.closeModal&&o.closeModal(...r))})]),e("div",ee,[t[36]||(t[36]=e("div",{class:"alert alert-success"},[e("i",{class:"fas fa-check-circle me-2"}),a(" Ce box est disponible à la location ")],-1)),e("table",te,[e("tbody",null,[e("tr",null,[t[31]||(t[31]=e("th",null,"Surface:",-1)),e("td",null,n(l.selectedBox.surface)+" m²",1)]),l.selectedBox.volume?(d(),i("tr",le,[t[32]||(t[32]=e("th",null,"Volume:",-1)),e("td",null,n(l.selectedBox.volume)+" m³",1)])):c("",!0),e("tr",null,[t[33]||(t[33]=e("th",null,"Prix mensuel:",-1)),e("td",null,[e("strong",se,n(o.formatCurrency(l.selectedBox.prix_mensuel)),1)])]),e("tr",null,[t[34]||(t[34]=e("th",null,"Famille:",-1)),e("td",null,[l.selectedBox.famille?(d(),i("span",{key:0,class:"badge",style:x({backgroundColor:l.selectedBox.famille.couleur})},n(l.selectedBox.famille.nom),5)):(d(),i("span",oe,"N/A"))])]),e("tr",null,[t[35]||(t[35]=e("th",null,"Emplacement:",-1)),e("td",null,n(l.selectedBox.emplacement?.nom||"N/A"),1)])])])]),e("div",ne,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[4]||(t[4]=(...r)=>o.closeModal&&o.closeModal(...r))},"Fermer"),e("a",{href:o.getNewContractUrl(l.selectedBox.id),class:"btn btn-success"},[...t[37]||(t[37]=[e("i",{class:"fas fa-plus me-1"},null,-1),a("Créer un contrat ",-1)])],8,re)])])])])):c("",!0)])}const ce=g(y,[["render",ie],["__scopeId","data-v-506f0191"]]);export{ce as B};
