import{y as V,z as E,A as $,B as W,q as C,C as X,D as Y,E as T,G as L,H as tt,I,u as D,f as q,J as N,o as h,c as y,a as t,h as et,i as O,l as st,d as g,F as at,j as ot,g as nt,K as lt,t as v,L as rt,m as it,e as k,w as ct,n as P,x as dt}from"./app-D3-luHWI.js";import{C as S,B as ut,L as pt,a as F,b as K,P as ft,c as mt,p as M,d as j,e as z,i as ht,f as bt}from"./chart-BRbCGdSi.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const H={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},yt={ariaLabel:{type:String},ariaDescribedby:{type:String}},vt={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...H,...yt},gt=W[0]==="2"?(e,a)=>Object.assign(e,{attrs:a}):(e,a)=>Object.assign(e,a);function w(e){return I(e)?L(e):e}function _t(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e;return I(a)?new Proxy(e,{}):e}function xt(e,a){const l=e.options;l&&a&&Object.assign(l,a)}function Z(e,a){e.labels=a}function G(e,a,l){const i=[];e.datasets=a.map(o=>{const n=e.datasets.find(m=>m[l]===o[l]);return!n||!o.data||i.includes(n)?{...o}:(i.push(n),Object.assign(n,o),n)})}function wt(e,a){const l={labels:[],datasets:[]};return Z(l,e.labels),G(l,e.datasets,a),l}const Ct=V({props:vt,setup(e,a){let{expose:l,slots:i}=a;const o=C(null),n=E(null);l({chart:n});const m=()=>{if(!o.value)return;const{type:p,data:r,options:s,plugins:c,datasetIdKey:d}=e,f=wt(r,d),u=_t(f,r);n.value=new S(o.value,{type:p,data:u,options:{...s},plugins:c})},b=()=>{const p=L(n.value);p&&(e.destroyDelay>0?setTimeout(()=>{p.destroy(),n.value=null},e.destroyDelay):(p.destroy(),n.value=null))},_=p=>{p.update(e.updateMode)};return X(m),Y(b),T([()=>e.options,()=>e.data],(p,r)=>{let[s,c]=p,[d,f]=r;const u=L(n.value);if(!u)return;let R=!1;if(s){const x=w(s),A=w(d);x&&x!==A&&(xt(u,x),R=!0)}if(c){const x=w(c.labels),A=w(f.labels),B=w(c.datasets),Q=w(f.datasets);x!==A&&(Z(u.config.data,x),R=!0),B&&B!==Q&&(G(u.config.data,B,e.datasetIdKey),R=!0)}R&&tt(()=>{_(u)})},{deep:!0}),()=>$("canvas",{role:"img",ariaLabel:e.ariaLabel,ariaDescribedby:e.ariaDescribedby,ref:o},[$("p",{},[i.default?i.default():""])])}});function J(e,a){return S.register(a),V({props:H,setup(l,i){let{expose:o}=i;const n=E(null),m=b=>{n.value=b?.chart};return o({chart:n}),()=>$(Ct,gt({ref:m},{type:e,...l}))}})}const Dt=J("bar",ut),Rt=J("line",pt),St={__name:"LineChart",props:{labels:{type:Array,required:!0},datasets:{type:Array,required:!0},title:{type:String,default:""},height:{type:Number,default:300}},setup(e){S.register(F,K,ft,mt,M,j,z,ht);const a=e,l=D(()=>({labels:a.labels,datasets:a.datasets.map(o=>({...o,tension:.4,borderWidth:2,pointRadius:4,pointHoverRadius:6}))})),i=D(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!!a.title,text:a.title},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(o){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0}).format(o)}}}},interaction:{mode:"nearest",axis:"x",intersect:!1}}));return(o,n)=>(h(),q(N(Rt),{data:l.value,options:i.value},null,8,["data","options"]))}},At={__name:"BarChart",props:{labels:{type:Array,required:!0},datasets:{type:Array,required:!0},title:{type:String,default:""},horizontal:{type:Boolean,default:!1}},setup(e){S.register(F,K,bt,M,j,z);const a=e,l=D(()=>({labels:a.labels,datasets:a.datasets})),i=D(()=>({responsive:!0,maintainAspectRatio:!1,indexAxis:a.horizontal?"y":"x",plugins:{legend:{display:!0,position:"top"},title:{display:!!a.title,text:a.title}},scales:{y:{beginAtZero:!0}}}));return(o,n)=>(h(),q(N(Dt),{data:l.value,options:i.value},null,8,["data","options"]))}},Bt={class:"search-bar-wrapper"},kt={class:"position-relative"},$t=["placeholder"],Lt={key:0,class:"fas fa-spinner fa-spin position-absolute search-icon"},Ot={key:1,class:"search-results dropdown-menu show w-100"},Pt={key:0,class:"text-center p-3"},Vt={key:1,class:"p-3 text-muted"},Et={key:2},Tt=["onMousedown"],It={__name:"SearchBar",props:{placeholder:{type:String,default:"Rechercher..."},endpoint:{type:String,required:!0},itemKey:{type:String,default:"id"},displayKey:{type:String,default:"name"},minChars:{type:Number,default:2},debounce:{type:Number,default:300},modelValue:{type:String,default:""}},emits:["update:modelValue","select","search"],setup(e,{emit:a}){const l=e,i=a,o=C(l.modelValue),n=C([]),m=C(!1),b=C(!1);let _=null;T(()=>l.modelValue,d=>{o.value=d});const p=()=>{if(i("update:modelValue",o.value),o.value.length<l.minChars){n.value=[];return}m.value=!0,clearTimeout(_),_=setTimeout(()=>{r()},l.debounce)},r=async()=>{try{const d=await rt.get(l.endpoint,{params:{q:o.value}});n.value=d.data.data||d.data,i("search",n.value)}catch(d){console.error("Erreur de recherche:",d),n.value=[]}finally{m.value=!1}},s=d=>{o.value=d[l.displayKey],i("update:modelValue",o.value),i("select",d),b.value=!1},c=()=>{setTimeout(()=>{b.value=!1},200)};return(d,f)=>(h(),y("div",Bt,[t("div",kt,[et(t("input",{type:"text",class:"form-control",placeholder:e.placeholder,"onUpdate:modelValue":f[0]||(f[0]=u=>o.value=u),onInput:p,onFocus:f[1]||(f[1]=u=>b.value=!0),onBlur:c},null,40,$t),[[st,o.value]]),f[3]||(f[3]=t("i",{class:"fas fa-search position-absolute search-icon"},null,-1)),m.value?(h(),y("i",Lt)):O("",!0),b.value&&(n.value.length>0||o.value.length>=e.minChars)?(h(),y("div",Ot,[m.value?(h(),y("div",Pt,[...f[2]||(f[2]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),g(" Recherche en cours... ",-1)])])):n.value.length===0&&o.value.length>=e.minChars?(h(),y("div",Vt," Aucun résultat trouvé ")):(h(),y("div",Et,[(h(!0),y(at,null,ot(n.value,u=>(h(),y("a",{key:u[e.itemKey],href:"#",class:"dropdown-item",onMousedown:nt(R=>s(u),["prevent"])},[lt(d.$slots,"result",{result:u},()=>[g(v(u[e.displayKey]),1)])],40,Tt))),128))]))])):O("",!0)])]))}},qt=U(It,[["__scopeId","data-v-dc7b5237"]]),Nt={class:"container-fluid"},Ft={class:"row mb-4"},Kt={class:"col-xl-3 col-md-6 mb-4"},Mt={class:"card border-left-primary shadow h-100 py-2"},jt={class:"card-body"},zt={class:"row no-gutters align-items-center"},Ut={class:"col mr-2"},Ht={class:"h5 mb-0 font-weight-bold text-gray-800"},Zt={class:"col-xl-3 col-md-6 mb-4"},Gt={class:"card border-left-success shadow h-100 py-2"},Jt={class:"card-body"},Qt={class:"row no-gutters align-items-center"},Wt={class:"col mr-2"},Xt={class:"h5 mb-0 font-weight-bold text-gray-800"},Yt={class:"col-xl-3 col-md-6 mb-4"},te={class:"card border-left-info shadow h-100 py-2"},ee={class:"card-body"},se={class:"row no-gutters align-items-center"},ae={class:"col mr-2"},oe={class:"row no-gutters align-items-center"},ne={class:"col-auto"},le={class:"h5 mb-0 mr-3 font-weight-bold text-gray-800"},re={class:"col"},ie={class:"progress progress-sm mr-2"},ce={class:"col-xl-3 col-md-6 mb-4"},de={class:"card border-left-warning shadow h-100 py-2"},ue={class:"card-body"},pe={class:"row no-gutters align-items-center"},fe={class:"col mr-2"},me={class:"h5 mb-0 font-weight-bold text-gray-800"},he={class:"row mb-4"},be={class:"col-lg-8"},ye={class:"card shadow mb-4"},ve={class:"card-body"},ge={style:{height:"300px"}},_e={class:"col-lg-4"},xe={class:"card shadow mb-4"},we={class:"card-body"},Ce={style:{height:"300px"}},De={class:"row mb-4"},Re={class:"col-12"},Se={class:"card shadow"},Ae={class:"card-body"},Be={class:"d-flex justify-content-between align-items-center"},ke={class:"text-muted d-block"},$e={__name:"Dashboard",props:{stats:Object,caEvolutionData:Array,topClientsData:Array},setup(e){const a=e,l=C(""),i=r=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0}).format(r||0),o=D(()=>({labels:a.caEvolutionData?.map(r=>r.month)||[],datasets:[{label:"Chiffre d'Affaires",data:a.caEvolutionData?.map(r=>r.ca)||[],borderColor:"rgb(13, 110, 253)",backgroundColor:"rgba(13, 110, 253, 0.1)",fill:!0}]})),n=D(()=>({labels:a.topClientsData?.map(r=>r.nom)||[],datasets:[{label:"CA Total",data:a.topClientsData?.map(r=>r.factures_sum_montant_ttc)||[],backgroundColor:["rgba(13, 110, 253, 0.8)","rgba(25, 135, 84, 0.8)","rgba(255, 193, 7, 0.8)","rgba(220, 53, 69, 0.8)","rgba(13, 202, 240, 0.8)"]}]})),m=()=>{dt.reload({only:["stats","caEvolutionData","topClientsData"]})},b=r=>{console.log("Résultat sélectionné:",r),r.url&&(window.location.href=r.url)},_=r=>({client:"fas fa-user",facture:"fas fa-file-invoice",contrat:"fas fa-file-contract",box:"fas fa-box"})[r]||"fas fa-circle",p=r=>({client:"bg-primary",facture:"bg-success",contrat:"bg-info",box:"bg-warning"})[r]||"bg-secondary";return(r,s)=>(h(),y("div",Nt,[t("div",{class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},[s[2]||(s[2]=t("h1",{class:"h2"},[t("i",{class:"fas fa-tachometer-alt me-2"}),g(" Tableau de Bord Administrateur ")],-1)),t("div",{class:"btn-toolbar mb-2 mb-md-0"},[t("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:m},[...s[1]||(s[1]=[t("i",{class:"fas fa-sync-alt me-1"},null,-1),g(" Actualiser ",-1)])])])]),t("div",Ft,[t("div",Kt,[t("div",Mt,[t("div",jt,[t("div",zt,[t("div",Ut,[s[3]||(s[3]=t("div",{class:"text-xs font-weight-bold text-primary text-uppercase mb-1"}," Clients Actifs ",-1)),t("div",Ht,v(e.stats.clients_actifs),1)]),s[4]||(s[4]=t("div",{class:"col-auto"},[t("i",{class:"fas fa-users fa-2x text-gray-300"})],-1))])])])]),t("div",Zt,[t("div",Gt,[t("div",Jt,[t("div",Qt,[t("div",Wt,[s[5]||(s[5]=t("div",{class:"text-xs font-weight-bold text-success text-uppercase mb-1"}," CA du Mois ",-1)),t("div",Xt,v(i(e.stats.ca_mois)),1)]),s[6]||(s[6]=t("div",{class:"col-auto"},[t("i",{class:"fas fa-euro-sign fa-2x text-gray-300"})],-1))])])])]),t("div",Yt,[t("div",te,[t("div",ee,[t("div",se,[t("div",ae,[s[7]||(s[7]=t("div",{class:"text-xs font-weight-bold text-info text-uppercase mb-1"}," Taux d'Occupation ",-1)),t("div",oe,[t("div",ne,[t("div",le,v(e.stats.taux_occupation)+"% ",1)]),t("div",re,[t("div",ie,[t("div",{class:"progress-bar bg-info",role:"progressbar",style:it({width:e.stats.taux_occupation+"%"})},null,4)])])])]),s[8]||(s[8]=t("div",{class:"col-auto"},[t("i",{class:"fas fa-clipboard-list fa-2x text-gray-300"})],-1))])])])]),t("div",ce,[t("div",de,[t("div",ue,[t("div",pe,[t("div",fe,[s[9]||(s[9]=t("div",{class:"text-xs font-weight-bold text-warning text-uppercase mb-1"}," Impayés ",-1)),t("div",me,v(i(e.stats.impayes)),1)]),s[10]||(s[10]=t("div",{class:"col-auto"},[t("i",{class:"fas fa-exclamation-triangle fa-2x text-gray-300"})],-1))])])])])]),t("div",he,[t("div",be,[t("div",ye,[s[11]||(s[11]=t("div",{class:"card-header py-3"},[t("h6",{class:"m-0 font-weight-bold text-primary"},[t("i",{class:"fas fa-chart-line me-2"}),g(" Évolution du Chiffre d'Affaires (12 derniers mois) ")])],-1)),t("div",ve,[t("div",ge,[k(St,{labels:o.value.labels,datasets:o.value.datasets},null,8,["labels","datasets"])])])])]),t("div",_e,[t("div",xe,[s[12]||(s[12]=t("div",{class:"card-header py-3"},[t("h6",{class:"m-0 font-weight-bold text-primary"},[t("i",{class:"fas fa-chart-pie me-2"}),g(" Top 5 Clients ")])],-1)),t("div",we,[t("div",Ce,[k(At,{labels:n.value.labels,datasets:n.value.datasets,horizontal:!0},null,8,["labels","datasets"])])])])])]),t("div",De,[t("div",Re,[t("div",Se,[s[13]||(s[13]=t("div",{class:"card-header py-3"},[t("h6",{class:"m-0 font-weight-bold text-primary"},[t("i",{class:"fas fa-search me-2"}),g(" Recherche Rapide ")])],-1)),t("div",Ae,[k(qt,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=c=>l.value=c),placeholder:"Rechercher un client, une facture, un contrat...",endpoint:"/api/search",onSelect:b},{result:ct(({result:c})=>[t("div",Be,[t("div",null,[t("i",{class:P([_(c.type),"me-2"])},null,2),t("strong",null,v(c.title),1),t("small",ke,v(c.subtitle),1)]),t("span",{class:P(["badge",p(c.type)])},v(c.type),3)])]),_:1},8,["modelValue"])])])])])]))}},Ee=U($e,[["__scopeId","data-v-26bd8ff2"]]);export{Ee as default};
