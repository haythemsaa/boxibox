import{r as v,f as x,w as p,a as e,d as c,t as i,g as C,h as m,l as k,v as _,e as F,c as P,i as E,o as h,s as w,x as d}from"./app-D3-luHWI.js";import{C as q}from"./ClientLayout-8AzT50KU.js";import{E as S}from"./EditableTable-ZU3ClCAi.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const U={components:{ClientLayout:q,EditableTable:S},props:{factures:{type:[Object,Array],required:!0},stats:{type:Object,default:()=>({})},queryParams:{type:Object,default:()=>({})}},setup(o){const t=w({search:o.queryParams.search||"",statut:o.queryParams.statut||"",annee:o.queryParams.annee||""}),l=[{key:"numero_facture",label:"N° Facture",type:"text",format:n=>`<strong>${n}</strong>`},{key:"client_nom",label:"Client",type:"text",format:(n,r)=>r.client?`${r.client.prenom} ${r.client.nom}`:"-"},{key:"contrat_numero",label:"Contrat",type:"text",format:(n,r)=>r.contrat?r.contrat.numero_contrat:"-"},{key:"date_emission",label:"Date Émission",type:"date"},{key:"date_echeance",label:"Date Échéance",type:"date"},{key:"montant_ttc",label:"Montant TTC",type:"currency",cellClass:"text-end"},{key:"statut",label:"Statut",type:"select",options:[{value:"payee",label:"Payée"},{value:"en_attente",label:"En attente"},{value:"en_retard",label:"En retard"},{value:"annulee",label:"Annulée"}],badges:{payee:{class:"bg-success",label:"Payée"},en_attente:{class:"bg-warning",label:"En attente"},en_retard:{class:"bg-danger",label:"En retard"},annulee:{class:"bg-secondary",label:"Annulée"}}}],a=n=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(n||0),u=()=>{d.get(route("admin.factures.index"),t,{preserveState:!0,preserveScroll:!0})};return{filters:t,columns:l,formatCurrency:a,applyFilters:u,resetFilters:()=>{t.search="",t.statut="",t.annee="",u()},handleUpdate:({id:n,data:r})=>{d.put(route("admin.factures.update",n),r,{preserveScroll:!0})},handlePageChange:n=>{d.get(route("admin.factures.index"),{...t,page:n},{preserveState:!0,preserveScroll:!0})},marquerPayee:n=>{confirm(`Marquer la facture ${n.numero_facture} comme payée ?`)&&d.put(route("admin.factures.marquer-payee",n.id),{},{preserveScroll:!0})},envoyerRelance:n=>{confirm(`Envoyer une relance pour la facture ${n.numero_facture} ?`)&&d.post(route("admin.factures.relance",n.id),{},{preserveScroll:!0})}}}},N={class:"mb-4"},V={class:"d-flex justify-content-between align-items-center"},M=["href"],R={class:"row mb-4"},A={class:"col-md-3"},D={class:"card border-left-success"},j={class:"card-body"},B={class:"h5 mb-0"},L={class:"col-md-3"},O={class:"card border-left-warning"},G={class:"card-body"},I={class:"h5 mb-0"},z={class:"col-md-3"},H={class:"card border-left-danger"},J={class:"card-body"},K={class:"h5 mb-0"},Q={class:"col-md-3"},W={class:"card border-left-primary"},X={class:"card-body"},Y={class:"h5 mb-0"},Z={class:"card mb-4"},$={class:"card-body"},ee={class:"col-md-3"},te={class:"col-md-2"},ae={class:"col-md-2"},se={class:"col-md-2"},ne={class:"card"},le={class:"card-header"},oe={class:"mb-0"},re={class:"card-body"},ie=["href"],de=["href"],ce=["onClick"],ue=["onClick"];function me(o,t,l,a,u,g){const f=v("EditableTable"),b=v("ClientLayout");return h(),x(b,{title:"Gestion des Factures"},{default:p(()=>[e("div",N,[e("div",V,[t[6]||(t[6]=e("h1",{class:"h3"},[e("i",{class:"fas fa-file-invoice me-2"}),c(" Gestion des Factures ")],-1)),e("a",{href:o.route("admin.factures.create"),class:"btn btn-primary"},[...t[5]||(t[5]=[e("i",{class:"fas fa-plus me-2"},null,-1),c(" Nouvelle Facture ",-1)])],8,M)])]),e("div",R,[e("div",A,[e("div",D,[e("div",j,[t[7]||(t[7]=e("div",{class:"text-xs font-weight-bold text-success text-uppercase mb-1"},"Payées",-1)),e("div",B,i(l.stats.payees||0),1)])])]),e("div",L,[e("div",O,[e("div",G,[t[8]||(t[8]=e("div",{class:"text-xs font-weight-bold text-warning text-uppercase mb-1"},"En Attente",-1)),e("div",I,i(l.stats.en_attente||0),1)])])]),e("div",z,[e("div",H,[e("div",J,[t[9]||(t[9]=e("div",{class:"text-xs font-weight-bold text-danger text-uppercase mb-1"},"En Retard",-1)),e("div",K,i(l.stats.en_retard||0),1)])])]),e("div",Q,[e("div",W,[e("div",X,[t[10]||(t[10]=e("div",{class:"text-xs font-weight-bold text-primary text-uppercase mb-1"},"Total Dû",-1)),e("div",Y,i(a.formatCurrency(l.stats.total_du)),1)])])])]),e("div",Z,[e("div",$,[e("form",{onSubmit:t[4]||(t[4]=C((...s)=>a.applyFilters&&a.applyFilters(...s),["prevent"])),class:"row g-3"},[e("div",ee,[m(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>a.filters.search=s),class:"form-control",placeholder:"N° facture ou client..."},null,512),[[k,a.filters.search]])]),e("div",te,[m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.filters.statut=s),class:"form-select"},[...t[11]||(t[11]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"payee"},"Payée",-1),e("option",{value:"en_attente"},"En attente",-1),e("option",{value:"en_retard"},"En retard",-1),e("option",{value:"annulee"},"Annulée",-1)])],512),[[_,a.filters.statut]])]),e("div",ae,[m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.filters.annee=s),class:"form-select"},[...t[12]||(t[12]=[e("option",{value:""},"Toutes les années",-1),e("option",{value:"2025"},"2025",-1),e("option",{value:"2024"},"2024",-1),e("option",{value:"2023"},"2023",-1)])],512),[[_,a.filters.annee]])]),t[14]||(t[14]=e("div",{class:"col-md-2"},[e("button",{type:"submit",class:"btn btn-primary w-100"},[e("i",{class:"fas fa-filter me-1"}),c("Filtrer ")])],-1)),e("div",se,[e("button",{type:"button",onClick:t[3]||(t[3]=(...s)=>a.resetFilters&&a.resetFilters(...s)),class:"btn btn-secondary w-100"},[...t[13]||(t[13]=[e("i",{class:"fas fa-redo me-1"},null,-1),c("Réinitialiser ",-1)])])])],32)])]),e("div",ne,[e("div",le,[e("h5",oe,"Liste des Factures ("+i(l.factures.total||l.factures.length)+")",1)]),e("div",re,[F(f,{data:l.factures.data||l.factures,columns:a.columns,editable:!0,deletable:!1,pagination:l.factures.meta||null,"update-route":o.route("admin.factures.update",":id"),"empty-message":"Aucune facture trouvée",onUpdate:a.handleUpdate,onPageChange:a.handlePageChange},{"row-actions":p(({row:s})=>[e("a",{href:o.route("admin.factures.show",s.id),class:"btn btn-sm btn-outline-info",title:"Voir détails"},[...t[15]||(t[15]=[e("i",{class:"fas fa-eye"},null,-1)])],8,ie),e("a",{href:o.route("admin.factures.pdf",s.id),class:"btn btn-sm btn-outline-secondary",title:"Télécharger PDF",target:"_blank"},[...t[16]||(t[16]=[e("i",{class:"fas fa-file-pdf"},null,-1)])],8,de),s.statut!=="payee"?(h(),P("button",{key:0,onClick:y=>a.marquerPayee(s),class:"btn btn-sm btn-outline-success",title:"Marquer comme payée"},[...t[17]||(t[17]=[e("i",{class:"fas fa-check-circle"},null,-1)])],8,ce)):E("",!0),e("button",{onClick:y=>a.envoyerRelance(s),class:"btn btn-sm btn-outline-warning",title:"Envoyer relance"},[...t[18]||(t[18]=[e("i",{class:"fas fa-paper-plane"},null,-1)])],8,ue)]),_:1},8,["data","columns","pagination","update-route","onUpdate","onPageChange"])])])]),_:1})}const _e=T(U,[["render",me],["__scopeId","data-v-15f06ae1"]]);export{_e as default};
