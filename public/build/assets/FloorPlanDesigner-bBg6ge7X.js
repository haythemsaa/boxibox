import{c as d,a as t,d as m,F as b,j as y,t as h,i as p,h as c,N as f,l as g,p as M,g as x,m as T,v as B,o as a,n as k,r as _,f as D,b as S,x as L}from"./app-D3-luHWI.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const C={props:{emplacementId:{type:Number,required:!0},familles:{type:Array,default:()=>[]},initialFloorPlan:{type:Array,default:()=>[]},initialBoxes:{type:Array,default:()=>[]},initialEchelle:{type:Number,default:.05}},data(){return{currentTool:"pen",canvasWidth:1200,canvasHeight:800,strokeWidth:3,strokeColor:"#333333",isDashed:!1,floorPlanShapes:Array.isArray(this.initialFloorPlan)&&this.initialFloorPlan.length>0&&typeof this.initialFloorPlan[0]=="object"&&this.initialFloorPlan[0].points?[...this.initialFloorPlan]:this.initialFloorPlan.length>0?[{points:[...this.initialFloorPlan],color:"#333333",width:3,dashed:!1}]:[],currentPath:[],isDrawing:!1,tempPoint:null,drawingRect:null,selectedShapeIndex:null,editingPointIndex:null,draggingPoint:!1,editingShapeIndex:null,boxes:[...this.initialBoxes],selectedBox:null,boxSize:"medium",customBoxWidth:100,customBoxHeight:80,previewBox:null,nextBoxId:(this.initialBoxes.length>0?Math.max(...this.initialBoxes.map(i=>i.id||0)):0)+1,echelle:this.initialEchelle,measureLine:{start:null,end:null},measurementResult:null,draggedFamille:null,resizing:!1,resizeHandle:null,resizeStartX:0,resizeStartY:0,mouseX:0,mouseY:0}},computed:{totalSurface(){return this.boxes.reduce((i,e)=>i+parseFloat(e.surface||0),0).toFixed(2)}},methods:{getCursor(){return this.currentTool==="pen"||this.currentTool==="polygon"?"crosshair":this.currentTool==="box"?"copy":this.currentTool==="measure"?"crosshair":this.currentTool==="edit"?"move":this.currentTool==="rectangle"||this.currentTool==="lshape"?"crosshair":"default"},getToolName(){return{pen:"Stylo (dessin libre)",polygon:"Polygone",rectangle:"Rectangle",lshape:"Forme en L",box:"Placer Box",measure:"Mesure de distance",edit:"Éditer le plan",select:"Sélection"}[this.currentTool]},formatDistance(i){return i>=1?i.toFixed(2)+"m":(i*100).toFixed(0)+"cm"},handleMouseDown(i){const e=this.$refs.canvas.getBoundingClientRect(),n=i.clientX-e.left,r=i.clientY-e.top;this.currentTool==="pen"?(this.isDrawing=!0,this.currentPath=[{x:n,y:r}]):this.currentTool==="rectangle"&&(this.isDrawing=!0,this.drawingRect={startX:n,startY:r,endX:n,endY:r})},handleMouseMove(i){const e=this.$refs.canvas.getBoundingClientRect();if(this.mouseX=Math.round(i.clientX-e.left),this.mouseY=Math.round(i.clientY-e.top),this.draggingPoint&&this.editingShapeIndex!==null&&this.editingPointIndex!==null){this.floorPlanShapes[this.editingShapeIndex].points[this.editingPointIndex].x=this.mouseX,this.floorPlanShapes[this.editingShapeIndex].points[this.editingPointIndex].y=this.mouseY;return}if(this.currentTool==="pen"&&this.isDrawing)this.currentPath.push({x:this.mouseX,y:this.mouseY});else if(this.currentTool==="polygon"&&this.currentPath.length>0)this.tempPoint={x:this.mouseX,y:this.mouseY};else if(this.currentTool==="rectangle"&&this.isDrawing)this.drawingRect.endX=this.mouseX,this.drawingRect.endY=this.mouseY;else if(this.currentTool==="box"){const n=this.getBoxSize();this.previewBox={x:this.mouseX-n.width/2,y:this.mouseY-n.height/2,width:n.width,height:n.height}}else this.currentTool==="measure"&&this.measureLine.start&&!this.measureLine.end&&(this.tempPoint={x:this.mouseX,y:this.mouseY});this.resizing&&this.selectedBox&&this.handleResize(i)},handleMouseUp(){if(this.draggingPoint){this.draggingPoint=!1,this.editingPointIndex=null;return}if(this.currentTool==="pen"&&this.isDrawing)this.floorPlanShapes.push({points:[...this.currentPath],color:this.strokeColor,width:this.strokeWidth,dashed:this.isDashed}),this.currentPath=[],this.isDrawing=!1;else if(this.currentTool==="rectangle"&&this.isDrawing){const i=this.drawingRect,e=Math.min(i.startX,i.endX),n=Math.min(i.startY,i.endY),r=Math.max(i.startX,i.endX),s=Math.max(i.startY,i.endY);this.floorPlanShapes.push({points:[{x:e,y:n},{x:r,y:n},{x:r,y:s},{x:e,y:s},{x:e,y:n}],color:this.strokeColor,width:this.strokeWidth,dashed:this.isDashed}),this.drawingRect=null,this.isDrawing=!1}this.resizing=!1,this.resizeHandle=null},handleClick(i){if(this.currentTool==="measure"){const e=this.$refs.canvas.getBoundingClientRect(),n=i.clientX-e.left,r=i.clientY-e.top;if(!this.measureLine.start)this.measureLine.start={x:n,y:r},this.measureLine.end=null,this.measurementResult=null;else if(this.measureLine.end)this.measureLine.start=null,this.measureLine.end=null,this.measurementResult=null;else{this.measureLine.end={x:n,y:r};const s=this.measureLine.end.x-this.measureLine.start.x,o=this.measureLine.end.y-this.measureLine.start.y,u=Math.sqrt(s*s+o*o)*this.echelle;this.measurementResult=this.formatDistance(u)}return}if(this.currentTool==="polygon"){const e=this.$refs.canvas.getBoundingClientRect(),n=i.clientX-e.left,r=i.clientY-e.top;if(this.currentPath.length>0){const s=this.currentPath[this.currentPath.length-1];if(Math.sqrt(Math.pow(n-s.x,2)+Math.pow(r-s.y,2))<10&&this.currentPath.length>2){this.floorPlanShapes.push({points:[...this.currentPath,this.currentPath[0]],color:this.strokeColor,width:this.strokeWidth,dashed:this.isDashed}),this.currentPath=[],this.tempPoint=null;return}}this.currentPath.push({x:n,y:r})}else this.currentTool==="box"?this.placeBox():this.currentTool==="lshape"&&this.createLShape()},getPathD(i){if(i.length===0)return"";let e=`M ${i[0].x} ${i[0].y}`;for(let n=1;n<i.length;n++)e+=` L ${i[n].x} ${i[n].y}`;return e},removePoint(i){this.floorPlanPath.length>2&&this.floorPlanPath.splice(i,1)},clearPlan(){confirm("Êtes-vous sûr de vouloir effacer le plan ?")&&(this.floorPlanPath=[],this.currentPath=[],this.boxes=[],this.selectedBox=null)},getBoxSize(){return{small:{width:60,height:50},medium:{width:100,height:80},large:{width:140,height:100},xlarge:{width:180,height:120},custom:{width:this.customBoxWidth,height:this.customBoxHeight}}[this.boxSize]},placeBox(){const i=this.getBoxSize(),e={id:this.nextBoxId++,numero:`BOX-${this.nextBoxId-1}`,x:this.mouseX-i.width/2,y:this.mouseY-i.height/2,width:i.width,height:i.height,surface:(i.width*i.height/400).toFixed(2),prix_mensuel:50,statut:"libre"};this.boxes.push(e),this.selectedBox=e},createLShape(){const i=this.mouseX,e=this.mouseY;this.floorPlanPath=[{x:i,y:e},{x:i+300,y:e},{x:i+300,y:e+150},{x:i+150,y:e+150},{x:i+150,y:e+300},{x:i,y:e+300},{x:i,y:e}]},selectBox(i){(this.currentTool==="select"||this.currentTool==="box")&&(this.selectedBox=i)},deleteBox(i){if(confirm(`Supprimer ${i.numero} ?`)){const e=this.boxes.findIndex(n=>n.id===i.id);e>-1&&(this.boxes.splice(e,1),this.selectedBox=null)}},startResize(i,e,n){n.stopPropagation(),this.resizing=!0,this.resizeHandle=e,this.resizeStartX=n.clientX,this.resizeStartY=n.clientY,this.selectedBox=i},handleResize(i){if(!this.resizing||!this.selectedBox)return;const e=i.clientX-this.resizeStartX,n=i.clientY-this.resizeStartY,r=this.selectedBox;switch(this.resizeHandle){case"se":r.width=Math.max(30,r.width+e),r.height=Math.max(30,r.height+n);break;case"sw":r.width=Math.max(30,r.width-e),r.height=Math.max(30,r.height+n),r.x+=e;break;case"ne":r.width=Math.max(30,r.width+e),r.height=Math.max(30,r.height-n),r.y+=n;break;case"nw":r.width=Math.max(30,r.width-e),r.height=Math.max(30,r.height-n),r.x+=e,r.y+=n;break}this.resizeStartX=i.clientX,this.resizeStartY=i.clientY,r.surface=(r.width*r.height/400).toFixed(2)},getBoxColor(i){const e={libre:"rgba(25, 135, 84, 0.3)",occupe:"rgba(220, 53, 69, 0.3)",reserve:"rgba(255, 193, 7, 0.3)",maintenance:"rgba(13, 202, 240, 0.3)"};return e[i]||e.libre},getBoxStroke(i){const e={libre:"#198754",occupe:"#dc3545",reserve:"#ffc107",maintenance:"#0dcaf0"};return e[i]||e.libre},savePlan(){const i=Array.isArray(this.boxes)?this.boxes:[];this.$emit("save",{emplacement_id:this.emplacementId,floor_plan:this.floorPlanShapes,boxes:i,canvas_width:this.canvasWidth,canvas_height:this.canvasHeight,echelle:this.echelle})},clearPlan(){confirm("Êtes-vous sûr de vouloir effacer toutes les formes ?")&&(this.floorPlanShapes=[],this.currentPath=[],this.selectedShapeIndex=null,this.editingShapeIndex=null)},selectShape(i){this.selectedShapeIndex=i,this.currentTool==="edit"&&(this.editingShapeIndex=i)},deleteSelectedShape(){this.selectedShapeIndex!==null&&(this.floorPlanShapes.splice(this.selectedShapeIndex,1),this.selectedShapeIndex=null,this.editingShapeIndex=null)},handleDragStart(i,e){this.draggedFamille=e,i.dataTransfer.effectAllowed="copy"},handleDrop(i){if(!this.draggedFamille)return;const e=this.$refs.canvas.getBoundingClientRect(),n=i.clientX-e.left,r=i.clientY-e.top,s=(this.draggedFamille.surface_min+this.draggedFamille.surface_max)/2,o=1.25,l=Math.sqrt(s/o)/this.echelle,u=l*o,v={id:this.nextBoxId++,numero:`${this.draggedFamille.nom.substring(0,2).toUpperCase()}-${this.boxes.length+1}`,x:n-u/2,y:r-l/2,width:Math.round(u),height:Math.round(l),surface:s.toFixed(2),prix_mensuel:this.draggedFamille.prix_base||0,statut:"libre",famille_id:this.draggedFamille.id,famille_nom:this.draggedFamille.nom,is_from_db:!1};this.boxes.push(v),this.draggedFamille=null},selectBoxFromList(i){this.selectedBox=i,this.currentTool="select"},startDragPoint(i,e,n){this.editingShapeIndex=i,this.editingPointIndex=e,this.draggingPoint=!0,n.stopPropagation()},removePoint(i,e){this.floorPlanShapes[i].points.length>3&&this.floorPlanShapes[i].points.splice(e,1)}}},F={class:"floor-plan-drawer"},R={class:"row"},X={class:"col-md-3"},Y={class:"card mb-3"},I={class:"card-body p-2",style:{"max-height":"600px","overflow-y":"auto"}},U={class:"d-flex align-items-center justify-content-between mb-2"},V={class:"small text-primary"},E={class:"badge bg-info"},W=["onDragstart"],q={class:"d-flex align-items-center"},H={class:"flex-grow-1"},j={class:"small fw-bold"},A={class:"text-muted",style:{"font-size":"0.75rem"}},N={class:"card"},O={class:"card-header bg-success text-white"},G={class:"mb-0"},K={class:"card-body p-2",style:{"max-height":"300px","overflow-y":"auto"}},J={key:0,class:"text-muted text-center small py-3"},Q=["onClick"],Z={class:"d-flex justify-content-between align-items-center"},$={class:"small fw-bold"},ee={class:"text-muted",style:{"font-size":"0.7rem"}},te={class:"col-md-9"},se={class:"toolbar card mb-3"},le={class:"card-body py-2"},ie={class:"row align-items-center"},oe={class:"col-md-6"},ne={class:"btn-group",role:"group"},re={class:"col-md-2"},ae={class:"d-flex align-items-center gap-2"},de={class:"form-check form-check-inline small mt-1"},ue={class:"col-md-2"},ce={class:"d-flex align-items-center gap-2"},he={class:"col-md-2 text-end"},me={key:0,class:"row mt-2 pt-2 border-top"},pe={class:"col-md-12"},fe={class:"d-flex gap-3 align-items-center"},ge={class:"btn-group btn-group-sm",role:"group"},xe={key:0,class:"d-flex gap-2 align-items-center"},be={class:"drawing-area card"},ye={class:"card-body p-2"},ve={class:"d-flex justify-content-between align-items-center mb-2 px-2"},we={class:"d-flex align-items-center gap-3"},ke={class:"scale-indicator"},Pe={width:"120",height:"30"},Se={x:"60",y:"28","text-anchor":"middle","font-size":"11",fill:"#333"},Be={class:"text-muted"},ze={key:0,class:"alert alert-warning mb-0 py-1 px-2 small"},Me=["width","height"],Te=["d","fill","stroke","stroke-width","stroke-dasharray","onClick"],_e={key:0},De=["cx","cy","fill","onMousedown","onContextmenu"],Le=["d","stroke","stroke-width","stroke-dasharray"],Ce=["x1","y1","x2","y2"],Fe=["x","y","width","height","stroke","stroke-width"],Re=["x","y","width","height","fill","stroke","onClick"],Xe=["x","y"],Ye=["x","y"],Ie={key:0},Ue=["x","y","onMousedown"],Ve=["x","y","onMousedown"],Ee=["x","y","onMousedown"],We=["x","y","onMousedown"],qe={key:3},He=["x1","y1","x2","y2"],je=["cx","cy"],Ae=["cx","cy"],Ne=["x","y","width","height"],Oe={class:"info-bar mt-2 p-2 bg-light small"},Ge={class:"row"},Ke={class:"col-md-6"},Je={key:0,class:"text-info ms-2"},Qe={key:1,class:"text-warning ms-2"},Ze={class:"col-md-6 text-end"},$e={class:"badge bg-secondary"},et={class:"badge bg-primary ms-1"},tt={class:"badge bg-info ms-1"},st={key:0,class:"card mt-3"},lt={class:"card-header bg-primary text-white py-2"},it={class:"d-flex justify-content-between align-items-center"},ot={class:"mb-0"},nt={class:"card-body"},rt={class:"row"},at={class:"col-md-3"},dt={class:"col-md-2"},ut={class:"col-md-2"},ct={class:"col-md-2"},ht={class:"col-md-3"},mt={class:"row mt-2"},pt={class:"col-md-4"},ft={class:"col-md-4"},gt={class:"col-md-4"};function xt(i,e,n,r,s,o){return a(),d("div",F,[t("div",R,[t("div",X,[t("div",Y,[e[38]||(e[38]=t("div",{class:"card-header bg-primary text-white"},[t("h6",{class:"mb-0"},[t("i",{class:"fas fa-th-large me-2"}),m("Familles de Boxes ")])],-1)),t("div",I,[(a(!0),d(b,null,y(n.familles,l=>(a(),d("div",{key:l.id,class:"mb-3"},[t("div",U,[t("strong",V,h(l.nom),1),t("span",E,h(l.surface_min)+"-"+h(l.surface_max)+"m²",1)]),t("div",{class:"box-template p-2 mb-2 border rounded bg-light",draggable:"true",onDragstart:u=>o.handleDragStart(u,l),style:{cursor:"move"}},[t("div",q,[e[37]||(e[37]=t("i",{class:"fas fa-grip-vertical text-muted me-2"},null,-1)),t("div",H,[t("div",j,h(l.nom),1),t("div",A,h(l.surface_min)+"m² - "+h(l.prix_base)+"€/mois ",1)])])],40,W)]))),128))])]),t("div",N,[t("div",O,[t("h6",G,[e[39]||(e[39]=t("i",{class:"fas fa-boxes me-2"},null,-1)),m("Boxes Placées ("+h(s.boxes.length)+") ",1)])]),t("div",K,[s.boxes.length===0?(a(),d("div",J," Aucune box placée ")):p("",!0),(a(!0),d(b,null,y(s.boxes,l=>(a(),d("div",{key:l.id,class:k(["box-item p-2 mb-2 border rounded",{"border-primary bg-light":s.selectedBox?.id===l.id}]),onClick:u=>o.selectBoxFromList(l),style:{cursor:"pointer"}},[t("div",Z,[t("div",null,[t("div",$,h(l.numero),1),t("div",ee,h(l.surface)+"m² - "+h(l.prix_mensuel)+"€ ",1)]),t("span",{class:k(["badge",{"bg-success":l.statut==="libre","bg-danger":l.statut==="occupé","bg-warning":l.statut==="réservé","bg-info":l.statut==="maintenance"}])},h(l.statut),3)])],10,Q))),128))])])]),t("div",te,[t("div",se,[t("div",le,[t("div",ie,[t("div",oe,[t("div",ne,[c(t("input",{type:"radio",class:"btn-check",id:"tool-pen","onUpdate:modelValue":e[0]||(e[0]=l=>s.currentTool=l),value:"pen",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[40]||(e[40]=t("label",{class:"btn btn-outline-primary",for:"tool-pen",title:"Dessiner le plan à main levée"},[t("i",{class:"fas fa-pen me-1"}),m("Stylo ")],-1)),c(t("input",{type:"radio",class:"btn-check",id:"tool-polygon","onUpdate:modelValue":e[1]||(e[1]=l=>s.currentTool=l),value:"polygon",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[41]||(e[41]=t("label",{class:"btn btn-outline-primary",for:"tool-polygon",title:"Dessiner un polygone (cliquer pour ajouter des points)"},[t("i",{class:"fas fa-draw-polygon me-1"}),m("Polygone ")],-1)),c(t("input",{type:"radio",class:"btn-check",id:"tool-rect","onUpdate:modelValue":e[2]||(e[2]=l=>s.currentTool=l),value:"rectangle",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[42]||(e[42]=t("label",{class:"btn btn-outline-primary",for:"tool-rect",title:"Dessiner un rectangle"},[t("i",{class:"fas fa-square me-1"}),m("Rectangle ")],-1)),c(t("input",{type:"radio",class:"btn-check",id:"tool-lshape","onUpdate:modelValue":e[3]||(e[3]=l=>s.currentTool=l),value:"lshape",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[43]||(e[43]=t("label",{class:"btn btn-outline-primary",for:"tool-lshape",title:"Dessiner une forme en L"},[t("i",{class:"fas fa-vector-square me-1"}),m("Forme L ")],-1)),c(t("input",{type:"radio",class:"btn-check",id:"tool-box","onUpdate:modelValue":e[4]||(e[4]=l=>s.currentTool=l),value:"box",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[44]||(e[44]=t("label",{class:"btn btn-outline-success",for:"tool-box",title:"Placer une box"},[t("i",{class:"fas fa-cube me-1"}),m("Placer Box ")],-1)),c(t("input",{type:"radio",class:"btn-check",id:"tool-measure","onUpdate:modelValue":e[5]||(e[5]=l=>s.currentTool=l),value:"measure",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[45]||(e[45]=t("label",{class:"btn btn-outline-warning",for:"tool-measure",title:"Mesurer une distance"},[t("i",{class:"fas fa-ruler me-1"}),m("Mesure ")],-1)),c(t("input",{type:"radio",class:"btn-check",id:"tool-edit","onUpdate:modelValue":e[6]||(e[6]=l=>s.currentTool=l),value:"edit",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[46]||(e[46]=t("label",{class:"btn btn-outline-info",for:"tool-edit",title:"Éditer le plan"},[t("i",{class:"fas fa-edit me-1"}),m("Éditer Plan ")],-1)),c(t("input",{type:"radio",class:"btn-check",id:"tool-select","onUpdate:modelValue":e[7]||(e[7]=l=>s.currentTool=l),value:"select",autocomplete:"off"},null,512),[[f,s.currentTool]]),e[47]||(e[47]=t("label",{class:"btn btn-outline-secondary",for:"tool-select",title:"Sélectionner"},[t("i",{class:"fas fa-mouse-pointer me-1"}),m("Sélection ")],-1))])]),t("div",re,[t("div",ae,[e[48]||(e[48]=t("label",{class:"small mb-0"},"Trait:",-1)),c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.strokeWidth=l),type:"number",min:"1",max:"10",class:"form-control form-control-sm",style:{width:"50px"}},null,512),[[g,s.strokeWidth,void 0,{number:!0}]]),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.strokeColor=l),type:"color",class:"form-control form-control-sm",style:{width:"40px"},title:"Couleur"},null,512),[[g,s.strokeColor]])]),t("div",de,[c(t("input",{class:"form-check-input",type:"checkbox",id:"dashedLine","onUpdate:modelValue":e[10]||(e[10]=l=>s.isDashed=l)},null,512),[[M,s.isDashed]]),e[49]||(e[49]=t("label",{class:"form-check-label",for:"dashedLine"},"Pointillé",-1))])]),t("div",ue,[t("div",ce,[e[50]||(e[50]=t("label",{class:"small mb-0"},"Échelle:",-1)),c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>s.echelle=l),type:"number",step:"0.01",min:"0.01",max:"1",class:"form-control form-control-sm",style:{width:"60px"},title:"Mètres par pixel"},null,512),[[g,s.echelle,void 0,{number:!0}]]),e[51]||(e[51]=t("span",{class:"small text-muted"},"m/px",-1))])]),t("div",he,[s.selectedShapeIndex!==null?(a(),d("button",{key:0,onClick:e[12]||(e[12]=(...l)=>o.deleteSelectedShape&&o.deleteSelectedShape(...l)),class:"btn btn-sm btn-outline-warning me-1",title:"Supprimer la forme sélectionnée"},[...e[52]||(e[52]=[t("i",{class:"fas fa-trash"},null,-1)])])):p("",!0),t("button",{onClick:e[13]||(e[13]=(...l)=>o.clearPlan&&o.clearPlan(...l)),class:"btn btn-sm btn-outline-danger me-1",title:"Effacer toutes les formes"},[...e[53]||(e[53]=[t("i",{class:"fas fa-eraser"},null,-1)])]),t("button",{onClick:e[14]||(e[14]=(...l)=>o.savePlan&&o.savePlan(...l)),class:"btn btn-sm btn-success",title:"Sauvegarder"},[...e[54]||(e[54]=[t("i",{class:"fas fa-save me-1"},null,-1),m("Sauvegarder ",-1)])])])]),s.currentTool==="box"?(a(),d("div",me,[t("div",pe,[t("div",fe,[e[61]||(e[61]=t("span",{class:"small text-muted"},"Taille de la box:",-1)),t("div",ge,[c(t("input",{type:"radio",class:"btn-check",id:"size-small","onUpdate:modelValue":e[15]||(e[15]=l=>s.boxSize=l),value:"small",autocomplete:"off"},null,512),[[f,s.boxSize]]),e[55]||(e[55]=t("label",{class:"btn btn-outline-info",for:"size-small"}," Petit (60x50) ",-1)),c(t("input",{type:"radio",class:"btn-check",id:"size-medium","onUpdate:modelValue":e[16]||(e[16]=l=>s.boxSize=l),value:"medium",autocomplete:"off",checked:""},null,512),[[f,s.boxSize]]),e[56]||(e[56]=t("label",{class:"btn btn-outline-info",for:"size-medium"}," Moyen (100x80) ",-1)),c(t("input",{type:"radio",class:"btn-check",id:"size-large","onUpdate:modelValue":e[17]||(e[17]=l=>s.boxSize=l),value:"large",autocomplete:"off"},null,512),[[f,s.boxSize]]),e[57]||(e[57]=t("label",{class:"btn btn-outline-info",for:"size-large"}," Grand (140x100) ",-1)),c(t("input",{type:"radio",class:"btn-check",id:"size-xlarge","onUpdate:modelValue":e[18]||(e[18]=l=>s.boxSize=l),value:"xlarge",autocomplete:"off"},null,512),[[f,s.boxSize]]),e[58]||(e[58]=t("label",{class:"btn btn-outline-info",for:"size-xlarge"}," Très Grand (180x120) ",-1)),c(t("input",{type:"radio",class:"btn-check",id:"size-custom","onUpdate:modelValue":e[19]||(e[19]=l=>s.boxSize=l),value:"custom",autocomplete:"off"},null,512),[[f,s.boxSize]]),e[59]||(e[59]=t("label",{class:"btn btn-outline-info",for:"size-custom"}," Personnalisé ",-1))]),s.boxSize==="custom"?(a(),d("div",xe,[c(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>s.customBoxWidth=l),type:"number",min:"30",max:"300",class:"form-control form-control-sm",style:{width:"70px"},placeholder:"Largeur"},null,512),[[g,s.customBoxWidth,void 0,{number:!0}]]),e[60]||(e[60]=t("span",{class:"small"},"x",-1)),c(t("input",{"onUpdate:modelValue":e[21]||(e[21]=l=>s.customBoxHeight=l),type:"number",min:"30",max:"300",class:"form-control form-control-sm",style:{width:"70px"},placeholder:"Hauteur"},null,512),[[g,s.customBoxHeight,void 0,{number:!0}]])])):p("",!0)])])])):p("",!0)])]),t("div",be,[t("div",ye,[t("div",ve,[t("div",we,[t("div",ke,[(a(),d("svg",Pe,[e[62]||(e[62]=t("line",{x1:"10",y1:"15",x2:"110",y2:"15",stroke:"#333","stroke-width":"2"},null,-1)),e[63]||(e[63]=t("line",{x1:"10",y1:"10",x2:"10",y2:"20",stroke:"#333","stroke-width":"2"},null,-1)),e[64]||(e[64]=t("line",{x1:"110",y1:"10",x2:"110",y2:"20",stroke:"#333","stroke-width":"2"},null,-1)),t("text",Se,h(o.formatDistance(100*s.echelle)),1)]))]),t("small",Be,"1 pixel = "+h((s.echelle*100).toFixed(1))+" cm",1)]),s.measurementResult?(a(),d("div",ze,[e[65]||(e[65]=t("i",{class:"fas fa-ruler me-1"},null,-1)),e[66]||(e[66]=m(" Distance: ",-1)),t("strong",null,h(s.measurementResult),1)])):p("",!0)]),t("div",{class:"canvas-wrapper",onDragover:e[26]||(e[26]=x(()=>{},["prevent"])),onDrop:e[27]||(e[27]=(...l)=>o.handleDrop&&o.handleDrop(...l))},[(a(),d("svg",{ref:"canvas",class:"drawing-canvas",width:s.canvasWidth,height:s.canvasHeight,onMousedown:e[22]||(e[22]=(...l)=>o.handleMouseDown&&o.handleMouseDown(...l)),onMousemove:e[23]||(e[23]=(...l)=>o.handleMouseMove&&o.handleMouseMove(...l)),onMouseup:e[24]||(e[24]=(...l)=>o.handleMouseUp&&o.handleMouseUp(...l)),onClick:e[25]||(e[25]=(...l)=>o.handleClick&&o.handleClick(...l)),style:T({cursor:o.getCursor()})},[e[67]||(e[67]=t("defs",null,[t("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse"},[t("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"#e0e0e0","stroke-width":"0.5"})])],-1)),e[68]||(e[68]=t("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1)),(a(!0),d(b,null,y(s.floorPlanShapes,(l,u)=>(a(),d("g",{key:"shape-"+u},[t("path",{d:o.getPathD(l.points),fill:s.selectedShapeIndex===u?"rgba(255, 193, 7, 0.3)":"rgba(173, 216, 230, 0.2)",stroke:l.color||s.strokeColor,"stroke-width":l.width||s.strokeWidth,"stroke-dasharray":l.dashed?"10,5":"0","stroke-linejoin":"round","stroke-linecap":"round",onClick:v=>o.selectShape(u),class:k({"shape-selected":s.selectedShapeIndex===u}),style:{cursor:"pointer"}},null,10,Te),s.currentTool==="edit"&&s.editingShapeIndex===u?(a(),d("g",_e,[(a(!0),d(b,null,y(l.points,(v,w)=>(a(),d("circle",{key:"point-"+u+"-"+w,cx:v.x,cy:v.y,r:"6",fill:s.editingPointIndex===w?"#dc3545":"#0d6efd",stroke:"white","stroke-width":"2",class:"path-point editable",style:{cursor:"move"},onMousedown:x(P=>o.startDragPoint(u,w,P),["stop"]),onContextmenu:x(P=>o.removePoint(u,w),["prevent"])},null,40,De))),128))])):p("",!0)]))),128)),s.currentPath.length>0?(a(),d("path",{key:0,d:o.getPathD(s.currentPath),fill:"none",stroke:s.strokeColor,"stroke-width":s.strokeWidth,"stroke-dasharray":s.isDashed?"10,5":"0","stroke-linejoin":"round","stroke-linecap":"round",opacity:"0.7"},null,8,Le)):p("",!0),s.currentTool==="polygon"&&s.currentPath.length>0&&s.tempPoint?(a(),d("line",{key:1,x1:s.currentPath[s.currentPath.length-1].x,y1:s.currentPath[s.currentPath.length-1].y,x2:s.tempPoint.x,y2:s.tempPoint.y,stroke:"#0d6efd","stroke-width":"2","stroke-dasharray":"5,5"},null,8,Ce)):p("",!0),s.currentTool==="rectangle"&&s.drawingRect?(a(),d("rect",{key:2,x:Math.min(s.drawingRect.startX,s.drawingRect.endX),y:Math.min(s.drawingRect.startY,s.drawingRect.endY),width:Math.abs(s.drawingRect.endX-s.drawingRect.startX),height:Math.abs(s.drawingRect.endY-s.drawingRect.startY),fill:"rgba(173, 216, 230, 0.2)",stroke:s.strokeColor,"stroke-width":s.strokeWidth},null,8,Fe)):p("",!0),(a(!0),d(b,null,y(s.boxes,l=>(a(),d("g",{key:"box-"+l.id},[t("rect",{x:l.x,y:l.y,width:l.width,height:l.height,fill:o.getBoxColor(l.statut),stroke:o.getBoxStroke(l.statut),"stroke-width":"2",rx:"4",class:k(["box-rect",{selected:s.selectedBox?.id===l.id}]),onClick:x(u=>o.selectBox(l),["stop"])},null,10,Re),t("text",{x:l.x+l.width/2,y:l.y+l.height/2,"text-anchor":"middle","dominant-baseline":"middle",class:"box-label","font-size":"12","font-weight":"bold",fill:"#333"},h(l.numero),9,Xe),t("text",{x:l.x+l.width/2,y:l.y+l.height/2+14,"text-anchor":"middle","dominant-baseline":"middle","font-size":"10",fill:"#666"},h(l.surface)+"m² ",9,Ye),s.selectedBox?.id===l.id?(a(),d("g",Ie,[t("rect",{x:l.x-4,y:l.y-4,width:"8",height:"8",fill:"#0d6efd",stroke:"white",class:"resize-handle",style:{cursor:"nw-resize"},onMousedown:x(u=>o.startResize(l,"nw",u),["stop"])},null,40,Ue),t("rect",{x:l.x+l.width-4,y:l.y-4,width:"8",height:"8",fill:"#0d6efd",stroke:"white",class:"resize-handle",style:{cursor:"ne-resize"},onMousedown:x(u=>o.startResize(l,"ne",u),["stop"])},null,40,Ve),t("rect",{x:l.x-4,y:l.y+l.height-4,width:"8",height:"8",fill:"#0d6efd",stroke:"white",class:"resize-handle",style:{cursor:"sw-resize"},onMousedown:x(u=>o.startResize(l,"sw",u),["stop"])},null,40,Ee),t("rect",{x:l.x+l.width-4,y:l.y+l.height-4,width:"8",height:"8",fill:"#0d6efd",stroke:"white",class:"resize-handle",style:{cursor:"se-resize"},onMousedown:x(u=>o.startResize(l,"se",u),["stop"])},null,40,We)])):p("",!0)]))),128)),s.currentTool==="measure"?(a(),d("g",qe,[s.measureLine.start?(a(),d("line",{key:0,x1:s.measureLine.start.x,y1:s.measureLine.start.y,x2:s.measureLine.end?s.measureLine.end.x:s.tempPoint?s.tempPoint.x:s.measureLine.start.x,y2:s.measureLine.end?s.measureLine.end.y:s.tempPoint?s.tempPoint.y:s.measureLine.start.y,stroke:"#ff9800","stroke-width":"3","stroke-dasharray":"5,5"},null,8,He)):p("",!0),s.measureLine.start?(a(),d("circle",{key:1,cx:s.measureLine.start.x,cy:s.measureLine.start.y,r:"6",fill:"#ff9800",stroke:"white","stroke-width":"2"},null,8,je)):p("",!0),s.measureLine.end?(a(),d("circle",{key:2,cx:s.measureLine.end.x,cy:s.measureLine.end.y,r:"6",fill:"#ff9800",stroke:"white","stroke-width":"2"},null,8,Ae)):p("",!0)])):p("",!0),s.currentTool==="box"&&s.previewBox?(a(),d("rect",{key:4,x:s.previewBox.x,y:s.previewBox.y,width:s.previewBox.width,height:s.previewBox.height,fill:"rgba(25, 135, 84, 0.3)",stroke:"#198754","stroke-width":"2","stroke-dasharray":"5,5","pointer-events":"none"},null,8,Ne)):p("",!0)],44,Me))],32),t("div",Oe,[t("div",Ge,[t("div",Ke,[e[71]||(e[71]=t("strong",null,"Outil:",-1)),m(" "+h(o.getToolName())+" | ",1),e[72]||(e[72]=t("strong",null,"Position:",-1)),m(" "+h(s.mouseX)+", "+h(s.mouseY)+" ",1),s.currentTool==="polygon"&&s.currentPath.length>0?(a(),d("span",Je,[...e[69]||(e[69]=[t("i",{class:"fas fa-info-circle"},null,-1),m(" Double-clic pour terminer ",-1)])])):p("",!0),s.currentTool==="edit"?(a(),d("span",Qe,[...e[70]||(e[70]=[t("i",{class:"fas fa-info-circle"},null,-1),m(" Glissez les points | Clic droit pour supprimer ",-1)])])):p("",!0)]),t("div",Ze,[t("span",$e,h(s.floorPlanShapes.length)+" Forme(s)",1),t("span",et,h(s.boxes.length)+" Boxes",1),t("span",tt,"Surface: "+h(o.totalSurface)+"m²",1)])])])])]),s.selectedBox?(a(),d("div",st,[t("div",lt,[t("div",it,[t("h6",ot,[e[73]||(e[73]=t("i",{class:"fas fa-cog me-1"},null,-1)),m("Propriétés: "+h(s.selectedBox.numero),1)]),t("button",{onClick:e[28]||(e[28]=l=>o.deleteBox(s.selectedBox)),class:"btn btn-sm btn-danger"},[...e[74]||(e[74]=[t("i",{class:"fas fa-trash"},null,-1)])])])]),t("div",nt,[t("div",rt,[t("div",at,[e[75]||(e[75]=t("label",{class:"form-label small"},"Numéro",-1)),c(t("input",{"onUpdate:modelValue":e[29]||(e[29]=l=>s.selectedBox.numero=l),type:"text",class:"form-control form-control-sm"},null,512),[[g,s.selectedBox.numero]])]),t("div",dt,[e[76]||(e[76]=t("label",{class:"form-label small"},"X",-1)),c(t("input",{"onUpdate:modelValue":e[30]||(e[30]=l=>s.selectedBox.x=l),type:"number",class:"form-control form-control-sm"},null,512),[[g,s.selectedBox.x,void 0,{number:!0}]])]),t("div",ut,[e[77]||(e[77]=t("label",{class:"form-label small"},"Y",-1)),c(t("input",{"onUpdate:modelValue":e[31]||(e[31]=l=>s.selectedBox.y=l),type:"number",class:"form-control form-control-sm"},null,512),[[g,s.selectedBox.y,void 0,{number:!0}]])]),t("div",ct,[e[78]||(e[78]=t("label",{class:"form-label small"},"Largeur",-1)),c(t("input",{"onUpdate:modelValue":e[32]||(e[32]=l=>s.selectedBox.width=l),type:"number",class:"form-control form-control-sm"},null,512),[[g,s.selectedBox.width,void 0,{number:!0}]])]),t("div",ht,[e[79]||(e[79]=t("label",{class:"form-label small"},"Hauteur",-1)),c(t("input",{"onUpdate:modelValue":e[33]||(e[33]=l=>s.selectedBox.height=l),type:"number",class:"form-control form-control-sm"},null,512),[[g,s.selectedBox.height,void 0,{number:!0}]])])]),t("div",mt,[t("div",pt,[e[80]||(e[80]=t("label",{class:"form-label small"},"Surface (m²)",-1)),c(t("input",{"onUpdate:modelValue":e[34]||(e[34]=l=>s.selectedBox.surface=l),type:"number",step:"0.1",class:"form-control form-control-sm"},null,512),[[g,s.selectedBox.surface,void 0,{number:!0}]])]),t("div",ft,[e[81]||(e[81]=t("label",{class:"form-label small"},"Prix mensuel (€)",-1)),c(t("input",{"onUpdate:modelValue":e[35]||(e[35]=l=>s.selectedBox.prix_mensuel=l),type:"number",class:"form-control form-control-sm"},null,512),[[g,s.selectedBox.prix_mensuel,void 0,{number:!0}]])]),t("div",gt,[e[83]||(e[83]=t("label",{class:"form-label small"},"Statut",-1)),c(t("select",{"onUpdate:modelValue":e[36]||(e[36]=l=>s.selectedBox.statut=l),class:"form-select form-select-sm"},[...e[82]||(e[82]=[t("option",{value:"libre"},"Libre",-1),t("option",{value:"occupe"},"Occupé",-1),t("option",{value:"reserve"},"Réservé",-1),t("option",{value:"maintenance"},"Maintenance",-1)])],512),[[B,s.selectedBox.statut]])])])])])):p("",!0)])])])}const bt=z(C,[["render",xt],["__scopeId","data-v-4b101554"]]),yt={components:{FloorPlanDrawer:bt},props:{emplacements:{type:Array,required:!0},familles:{type:Array,required:!0},floorPlans:{type:Object,default:()=>({})},existingBoxes:{type:Object,default:()=>({})}},data(){return{selectedEmplacementId:this.emplacements[0]?.id||null,currentFloorPlan:[],currentBoxes:[],currentEchelle:.05,showSuccess:!1,planKey:0}},mounted(){this.selectedEmplacementId&&this.loadPlan()},methods:{loadPlan(){const i=this.floorPlans[this.selectedEmplacementId];i?(this.currentFloorPlan=i.floor_plan||[],this.currentEchelle=i.echelle||.05):(this.currentFloorPlan=[],this.currentEchelle=.05),this.currentBoxes=this.existingBoxes[this.selectedEmplacementId]||[],this.planKey++},handleSave(i){L.post(route("boxes.floorplan.save"),i,{preserveScroll:!0,onSuccess:e=>{this.showSuccess=!0,e.props.floorPlans&&(this.floorPlans=e.props.floorPlans),e.props.existingBoxes&&(this.existingBoxes=e.props.existingBoxes),this.loadPlan(),setTimeout(()=>{this.showSuccess=!1},3e3)},onError:e=>{alert("Erreur lors de la sauvegarde: "+JSON.stringify(e))}})}}},vt={class:"container-fluid py-4"},wt={class:"mb-4"},kt={class:"d-flex justify-content-between align-items-center"},Pt=["href"],St=["href"],Bt={class:"card mb-3"},zt={class:"card-body"},Mt={class:"row align-items-center"},Tt={class:"col-md-4"},_t=["value"],Dt={key:1,class:"alert alert-success alert-dismissible fade show position-fixed top-0 end-0 m-3",style:{"z-index":"9999"},role:"alert"};function Lt(i,e,n,r,s,o){const l=_("FloorPlanDrawer");return a(),d("div",vt,[t("div",wt,[t("div",kt,[e[5]||(e[5]=t("div",null,[t("h1",{class:"h3 mb-1"},[t("i",{class:"fas fa-pen-fancy me-2"}),m("Designer de Plan de Salle ")]),t("p",{class:"text-muted"},"Dessinez votre plan de salle et placez-y vos boxes de différentes tailles")],-1)),t("div",null,[t("a",{href:i.route("boxes.plan"),class:"btn btn-outline-secondary"},[...e[3]||(e[3]=[t("i",{class:"fas fa-eye me-1"},null,-1),m("Voir le plan ",-1)])],8,Pt),t("a",{href:i.route("boxes.index"),class:"btn btn-outline-primary ms-2"},[...e[4]||(e[4]=[t("i",{class:"fas fa-arrow-left me-1"},null,-1),m("Retour ",-1)])],8,St)])])]),t("div",Bt,[t("div",zt,[t("div",Mt,[t("div",Tt,[e[6]||(e[6]=t("label",{class:"form-label mb-1"},[t("i",{class:"fas fa-map-marker-alt me-1"}),m("Sélectionner l'emplacement ")],-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=u=>s.selectedEmplacementId=u),class:"form-select",onChange:e[1]||(e[1]=(...u)=>o.loadPlan&&o.loadPlan(...u))},[(a(!0),d(b,null,y(n.emplacements,u=>(a(),d("option",{key:u.id,value:u.id},h(u.nom),9,_t))),128))],544),[[B,s.selectedEmplacementId]])]),e[7]||(e[7]=S('<div class="col-md-8"><div class="alert alert-success mb-0"><div class="row"><div class="col-md-6"><strong><i class="fas fa-lightbulb me-1"></i>Instructions:</strong><ol class="mb-0 mt-2 small"><li><strong>Stylo:</strong> Dessinez le contour à main levée</li><li><strong>Polygone:</strong> Cliquez pour placer des points, double-clic pour terminer</li><li><strong>Rectangle/Forme L:</strong> Formes prédéfinies rapides</li></ol></div><div class="col-md-6"><strong><i class="fas fa-cube me-1"></i>Placer des boxes:</strong><ol class="mb-0 mt-2 small" start="4"><li>Sélectionnez &quot;Placer Box&quot;</li><li>Choisissez la taille (Petit, Moyen, Grand, Personnalisé)</li><li>Cliquez sur le plan pour placer la box</li><li>Redimensionnez avec les poignées bleues</li></ol></div></div></div></div>',1))])])]),s.selectedEmplacementId?(a(),D(l,{key:"plan-"+s.selectedEmplacementId+"-"+s.planKey,"emplacement-id":s.selectedEmplacementId,familles:n.familles,"initial-floor-plan":s.currentFloorPlan,"initial-boxes":s.currentBoxes,"initial-echelle":s.currentEchelle,onSave:o.handleSave},null,8,["emplacement-id","familles","initial-floor-plan","initial-boxes","initial-echelle","onSave"])):p("",!0),s.showSuccess?(a(),d("div",Dt,[e[8]||(e[8]=t("i",{class:"fas fa-check-circle me-2"},null,-1)),e[9]||(e[9]=m(" Plan sauvegardé avec succès ! ",-1)),t("button",{type:"button",class:"btn-close",onClick:e[2]||(e[2]=u=>s.showSuccess=!1)})])):p("",!0),e[10]||(e[10]=S('<div class="card mt-3"><div class="card-header"><h6 class="mb-0"><i class="fas fa-info-circle me-1"></i>Légende des statuts </h6></div><div class="card-body"><div class="row"><div class="col-md-3"><div class="d-flex align-items-center"><div style="width:30px;height:30px;background:rgba(25, 135, 84, 0.3);border:2px solid #198754;border-radius:4px;"></div><span class="ms-2">Libre</span></div></div><div class="col-md-3"><div class="d-flex align-items-center"><div style="width:30px;height:30px;background:rgba(220, 53, 69, 0.3);border:2px solid #dc3545;border-radius:4px;"></div><span class="ms-2">Occupé</span></div></div><div class="col-md-3"><div class="d-flex align-items-center"><div style="width:30px;height:30px;background:rgba(255, 193, 7, 0.3);border:2px solid #ffc107;border-radius:4px;"></div><span class="ms-2">Réservé</span></div></div><div class="col-md-3"><div class="d-flex align-items-center"><div style="width:30px;height:30px;background:rgba(13, 202, 240, 0.3);border:2px solid #0dcaf0;border-radius:4px;"></div><span class="ms-2">Maintenance</span></div></div></div></div></div>',1))])}const Xt=z(yt,[["render",Lt]]);export{Xt as default};
